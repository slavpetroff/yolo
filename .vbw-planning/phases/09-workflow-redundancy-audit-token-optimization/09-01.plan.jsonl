{"phase":"09","plan":"09-01","title":"Create shared lib/yolo-common.sh and consolidate route scripts","wave":1,"depends_on":[],"must_haves":["lib/yolo-common.sh with shared functions","scripts/route.sh replaces route-trivial/medium/high.sh","All existing route tests pass against new script"]}
{"id":"T1","title":"Create lib/yolo-common.sh with shared shell functions","file":"lib/yolo-common.sh","action":"create","desc":"Create shared library with: require_jq() for jq dependency check, parse_named_args() for --flag value arg parsing, json_output() for structured JSON output, run_with_timeout() wrapper (extracted from qa-gate scripts), acquire_lock/release_lock (extracted from dept-status.sh and qa-gate scripts). All functions must be sourceable via 'source lib/yolo-common.sh'. Include guard variable _YOLO_COMMON_LOADED to prevent double-source."}
{"id":"T2","title":"Create consolidated scripts/route.sh replacing 3 route scripts","file":"scripts/route.sh","action":"create","desc":"Create single parameterized route.sh that accepts --path trivial|medium|high (plus existing --phase-dir, --intent, --config, --analysis-json flags). Internally dispatches to route_trivial(), route_medium(), route_high() functions. Source lib/yolo-common.sh for require_jq and parse_named_args. Output format identical to existing scripts. Must handle all edge cases from route-trivial.sh (plan creation), route-medium.sh (architecture check), route-high.sh (multi-dept detection)."}
{"id":"T3","title":"Create tests for route.sh and lib/yolo-common.sh","file":"tests/unit/test-route-consolidated.bats","action":"create","desc":"Create bats test file covering: (1) route.sh --path trivial produces same JSON output as old route-trivial.sh, (2) route.sh --path medium produces same output, (3) route.sh --path high produces same output, (4) route.sh with missing --path errors, (5) route.sh with invalid --path errors, (6) lib/yolo-common.sh require_jq works, (7) lib/yolo-common.sh parse_named_args works. Use same test patterns as existing tests/unit/*.bats."}
{"id":"T4","title":"Delete deprecated route-trivial.sh, route-medium.sh, route-high.sh","file":"scripts/route-trivial.sh","action":"delete","desc":"Delete scripts/route-trivial.sh, scripts/route-medium.sh, scripts/route-high.sh. These are replaced by scripts/route.sh. Verify no other scripts source or call route-trivial/medium/high directly via grep before deletion. Note: go.md references will be updated in plan 09-06 (wave 2)."}
{"id":"T5","title":"Update references/naming-conventions.md for route.sh","file":"references/naming-conventions.md","action":"modify","desc":"Update naming-conventions.md to document the new consolidated route.sh pattern. If it lists route-trivial/medium/high as examples, replace with route.sh --path. Add a note about the lib/yolo-common.sh sourcing convention for shared scripts."}
