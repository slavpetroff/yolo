{"phase":"09","plan":"09-06","title":"YOLO_AGENT_MODE implementation, context budget enforcement, and go.md consolidation updates","wave":2,"depends_on":["09-01","09-04","09-05"],"must_haves":["go.md sets YOLO_AGENT_MODE before each workflow step agent spawn","compile-context.sh --measure invoked per agent spawn","Context budgets enforced with trim-to-budget logic","go.md route/qa-gate references updated to consolidated scripts"]}
{"id":"T1","title":"Update go.md: route references, qa-gate references, YOLO_AGENT_MODE, and --measure","file":"commands/go.md","action":"modify","desc":"Combined update to go.md: (1) Replace all route-trivial.sh/route-medium.sh/route-high.sh references with route.sh --path trivial|medium|high (from plan 09-01). (2) Replace qa-gate-post-task/plan/phase.sh references with qa-gate.sh --tier task|plan|phase (from plan 09-05). (3) Make YOLO_AGENT_MODE export/unset mandatory before/after each workflow step per the mapping table in step 3.5. (4) Change compile-context.sh invocations to always include --measure flag. (5) Add instruction to check --measure stderr for budget enforcement and log warnings when trimmed."}
{"id":"T2","title":"Update execute-protocol.md: consolidated script references and effort step-skip","file":"references/execute-protocol.md","action":"modify","desc":"Combined update to execute-protocol.md: (1) Replace qa-gate-post-task/plan/phase.sh references with qa-gate.sh --tier task|plan|phase (from plan 09-05). (2) Replace route-trivial/medium/high.sh references with route.sh --path (from plan 09-01). (3) Replace per-agent effort degradation language with step-skip language (from plan 09-04). (4) Add note: 'Effort level controls which steps execute, not how they execute.' (5) Update validate-plan.sh references to validate.sh --type plan (from plan 09-02)."}
{"id":"T3","title":"Implement trim-to-budget in compile-context.sh","file":"scripts/compile-context.sh","action":"modify","desc":"In compile-context.sh, after assembling the full context toon file, if --measure is active and actual size exceeds budget, trim the context to budget. Trimming strategy: (1) Remove optional sections (codebase files) first, (2) Truncate artifact JSONL to last N lines, (3) Remove previous phase context. Add budget from context-manifest.json lookup. Currently --measure only reports; this adds enforcement. Add a 'TRIMMED' marker in the measurement JSON output."}
{"id":"T4","title":"Validate context-manifest.json completeness","file":"config/context-manifest.json","action":"modify","desc":"Audit context-manifest.json against actual agent list. Fix known gaps: (1) analyze role has empty artifacts — add ['plan'] or remove role if deprecated, (2) integration-gate lists department_result which doesn't exist as artifact type — fix to match actual artifacts, (3) Ensure all fe-*/ux-* roles have proper includes pointing to base role. Remove qa-code, fe-qa-code, ux-qa-code entries (merged into qa per plan 09-03)."}
{"id":"T5","title":"Create context budget enforcement test","file":"tests/unit/test-context-budget.bats","action":"create","desc":"Create bats test verifying: (1) compile-context.sh --measure reports actual_tokens and budget_tokens, (2) when actual > budget, context is trimmed and TRIMMED marker appears, (3) trimmed context still contains required fields (phase goal, role-specific artifacts), (4) context-manifest.json has entries for all roles in agents/ directory. Use mock phase directory with large context to trigger trimming."}
