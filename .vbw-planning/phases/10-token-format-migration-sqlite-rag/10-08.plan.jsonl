{"phase":10,"plan":"10-08","title":"Update agent prompts to use DB query scripts","wave":2,"depends_on":["10-02","10-03","10-04"],"must_haves":["Dev agents call get-task.sh instead of Read for plan access","QA agents call get-summaries.sh instead of reading summary files","Lead agents call check-phase-status.sh for progress","Agent templates updated (affects all generated agents)","Backward compatible: agents check DB availability before using scripts"]}
{"id":"T1","title":"Update Dev agent templates to use DB scripts","spec":"Modify agents/templates/dev.md. In the execution protocol section, add [sqlite] conditional block: 'When DB is available (scripts/db/get-task.sh exists), use get-task.sh instead of Read for task retrieval. Pattern: result=$(bash ${CLAUDE_PLUGIN_ROOT}/scripts/db/get-task.sh <PLAN_ID> <TASK_ID>). On completion: bash ${CLAUDE_PLUGIN_ROOT}/scripts/db/complete-task.sh <TASK_ID> --plan <PLAN_ID> --files file1,file2 --summary \"description\". Fallback: Read plan.jsonl directly when DB unavailable.' Update self-claiming section: next-task.sh replaces manual task selection in teammate mode.","files":["agents/templates/dev.md"],"tests":["tests/static/agent-task-coordination.bats: dev template references get-task.sh, complete-task.sh, backward compatible fallback present"]}
{"id":"T2","title":"Update Lead and Senior agent templates to use DB scripts","spec":"Modify agents/templates/lead.md: Add DB-aware planning output — after writing plan.jsonl, also call insert-task.sh for each task to populate DB. Add check-phase-status.sh for progress monitoring. Modify agents/templates/senior.md: Add DB-aware code review — use next-review.sh to find tasks ready for review. Add search-decisions.sh for cross-phase decision consistency checks. Both templates get [sqlite] conditional blocks with file-based fallback.","files":["agents/templates/lead.md","agents/templates/senior.md"],"tests":["tests/static/agent-task-coordination.bats: lead template references insert-task.sh, senior references next-review.sh"]}
{"id":"T3","title":"Update QA and Tester agent templates to use DB scripts","spec":"Modify agents/templates/qa.md: Replace plan+summary file reads with get-summaries.sh --phase PHASE --status complete. Use search-gaps.sh to check for known issues before flagging duplicates. Modify agents/templates/tester.md: Use get-task.sh with --fields that include test_spec for test authoring. Both get [sqlite] blocks. QA-code variant (qa.md review mode): use get-summaries.sh --fields fm to get files_to_check list.","files":["agents/templates/qa.md","agents/templates/tester.md"],"tests":["tests/static/agent-task-coordination.bats: qa template references get-summaries.sh, tester references get-task.sh with test_spec"]}
{"id":"T4","title":"Update Scout, Critic, and Architect templates to use DB scripts","spec":"Modify agents/templates/scout.md (if exists, else agents/yolo-scout.md): Use search-research.sh for cross-phase duplicate check before researching. Use search-all.sh for comprehensive knowledge retrieval. Modify agents/yolo-critic.md: Use search-decisions.sh to review prior decisions. Modify agents/templates/architect.md: Use get-phase.sh --goals for phase metadata instead of ROADMAP.md read (key 95% savings). Use search-research.sh for relevant findings. All get [sqlite] blocks with fallback.","files":["agents/yolo-scout.md","agents/yolo-critic.md","agents/templates/architect.md"],"tests":["tests/static/agent-task-coordination.bats: scout references search-research.sh, architect references get-phase.sh"]}
{"id":"T5","title":"Regenerate all department agents from updated templates","spec":"Run scripts/regenerate-agents.sh to regenerate all 38 agents from the updated templates. Verify: (1) All fe-dev, ux-dev agents inherit DB script references from dev.md template, (2) All fe-qa, ux-qa agents inherit from qa.md template, (3) Department overlays (agents/overlays/*.json) do not conflict with DB script sections, (4) Generated agents maintain backward-compatible [sqlite]/[file] conditional blocks. Count references to DB scripts across all generated agents to verify propagation.","files":["agents/yolo-dev.md","agents/yolo-fe-dev.md","agents/yolo-ux-dev.md","agents/yolo-qa.md","agents/yolo-fe-qa.md","agents/yolo-ux-qa.md"],"tests":["tests/static/agent-task-coordination.bats: all dept agents reference DB scripts, backward compatible fallbacks present in all"]}
