{"phase":10,"plan":"10-07","title":"Wire SQLite into go.md and execute-protocol.md orchestration","wave":2,"depends_on":["10-01","10-03","10-04"],"must_haves":["go.md initializes DB at phase start","execute-protocol.md uses task queue for agent coordination","Task claiming replaces manual plan parsing","Phase status checks use check-phase-status.sh","Backward compatible when DB absent"]}
{"id":"T1","title":"Add DB initialization to go.md Execute mode","spec":"Modify commands/go.md Execute mode section. After 'Pre-Execution' step 2 (execute guards), add: 'Step 2.5: Initialize artifact store. Run: bash ${CLAUDE_PLUGIN_ROOT}/scripts/db/init-db.sh --planning-dir .vbw-planning. If exit 0, set db_available=true. If init-db.sh not found (pre-phase-10), set db_available=false and continue with file-based path. Import existing JSONL artifacts into DB: for each plan.jsonl and summary.jsonl in phase dir, run import-jsonl.sh.' This is the entry point that bootstraps the DB for each execution run.","files":["commands/go.md"],"tests":["tests/unit/db/go-integration.bats: DB created on execute, existing artifacts imported, backward compatible without init-db.sh"]}
{"id":"T2","title":"Wire task queue into execute-protocol.md Step 7 (Implementation)","spec":"Modify references/execute-protocol.md Step 7 section. Add [sqlite] block: When db_available=true, replace plan.jsonl parsing with task queue: (1) Lead calls insert-task.sh for each plan task during Step 4, (2) Dev calls next-task.sh to self-assign work instead of reading plan.jsonl, (3) Dev calls complete-task.sh after each task instead of writing summary.jsonl directly, (4) Senior calls next-review.sh to find completed tasks for Step 8. Add claim-task.sh as explicit alternative when Lead assigns specific tasks. Keep file-based path in [file] block for backward compatibility.","files":["references/execute-protocol.md"],"tests":["tests/static/protocol-11-step-refs.bats: task queue scripts referenced in Step 7, backward compatible file path preserved"]}
{"id":"T3","title":"Wire phase status into go.md status checks","spec":"Modify commands/go.md. In status display sections and progress tracking, add: When db_available=true, replace glob+read pattern with check-phase-status.sh. Specifically: (1) Progress percentage from check-phase-status.sh instead of counting summary files, (2) Plan completion from DB instead of file existence checks, (3) Task-level granularity (pending/in_progress/complete/blocked) that file-based system cannot provide. Update the phase-detect.sh integration point to use DB when available.","files":["commands/go.md"],"tests":["tests/static/protocol-11-step-refs.bats: check-phase-status.sh referenced in go.md, file fallback preserved"]}
{"id":"T4","title":"Wire artifact writes to DB in execute-protocol.md","spec":"Modify references/execute-protocol.md. At each step where artifacts are produced, add DB write alongside file write: (1) Step 1 Critic: after writing critique.jsonl, call import-jsonl.sh --type critique, (2) Step 2 Scout: after research.jsonl, call import-jsonl.sh --type research, (3) Step 3 Architect: decisions.jsonl via append-finding.sh, (4) Step 4 Lead: plan tasks via insert-task.sh, (5) Step 6 Dev: completion via complete-task.sh, (6) Steps 8-10: code-review, qa, security via append-finding.sh. Dual-write ensures both file and DB are current during migration.","files":["references/execute-protocol.md"],"tests":["tests/static/protocol-11-step-refs.bats: DB write calls present at each artifact-producing step"]}
{"id":"T5","title":"Add DB-aware error recovery to execute-protocol.md","spec":"Modify references/execute-protocol.md error recovery sections. When db_available=true: (1) On task failure, call release-task.sh to return task to pending with retry context (replaces gaps.jsonl retry_context pattern), (2) On agent crash, detect orphaned in_progress tasks via check-phase-status.sh (tasks in_progress for >timeout seconds), (3) On phase retry, use DB state to skip already-complete tasks (replaces summary.jsonl existence checks). Add escalation DB path: append-finding.sh --type escalation for escalation entries.","files":["references/execute-protocol.md"],"tests":["tests/static/protocol-11-step-refs.bats: release-task.sh referenced in error recovery, orphan detection documented"]}
