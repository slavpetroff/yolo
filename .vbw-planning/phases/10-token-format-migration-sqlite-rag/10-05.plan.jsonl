{"phase":10,"plan":"10-05","title":"FTS5 full-text search and research query scripts","wave":1,"depends_on":[],"must_haves":["search-research.sh returns relevant findings ranked by relevance","Cross-phase search works via research_archive table","FTS5 queries handle boolean operators (AND/OR/NOT)","search-decisions.sh supports agent and phase filtering","Results include relevance snippets"]}
{"id":"T1","title":"Create search-research.sh for full-text research lookup","spec":"Create scripts/db/search-research.sh. Usage: search-research.sh <QUERY> [--phase PHASE] [--conf LEVEL] [--limit N] [--db PATH]. Behavior: SELECT q, finding, conf, phase, dt FROM research_fts WHERE research_fts MATCH ? ORDER BY rank. --phase filters to specific phase. --conf filters by confidence level (high/medium/low). --limit caps results (default 10). Output TOON format: 'q: How to handle JWT?\\nfinding: Use RS256 with key rotation\\nconf: high\\nphase: 03'. Uses FTS5 snippet() function for highlighted matches. Also searches research_archive table for cross-phase results. Replaces the jq grep pattern in compile-context.sh research-archive lookup.","files":["scripts/db/search-research.sh"],"tests":["tests/unit/db/search-research.bats: finds matching research, filters by phase, filters by confidence, cross-phase search works, snippet highlighting"]}
{"id":"T2","title":"Create search-decisions.sh for decision lookup","spec":"Create scripts/db/search-decisions.sh. Usage: search-decisions.sh <QUERY> [--phase PHASE] [--agent AGENT] [--limit N] [--db PATH]. Behavior: SELECT dec, reason, agent, task, ts FROM decisions_fts WHERE decisions_fts MATCH ? ORDER BY rank. --agent filters by specific agent (e.g., 'architect', 'lead'). Output TOON format: 'agent: architect\\ndec: Use WAL mode for SQLite\\nreason: Concurrent reads needed\\ntask: T2'. Useful for cross-phase decision consistency checking.","files":["scripts/db/search-decisions.sh"],"tests":["tests/unit/db/search-decisions.bats: finds matching decisions, filters by agent, filters by phase, ranked by relevance"]}
{"id":"T3","title":"Create search-gaps.sh for gap/issue lookup","spec":"Create scripts/db/search-gaps.sh. Usage: search-gaps.sh <QUERY> [--phase PHASE] [--status STATUS] [--sev SEVERITY] [--db PATH]. Behavior: SELECT id, sev, desc, st, res FROM gaps_fts WHERE gaps_fts MATCH ? ORDER BY rank. --status filters (open/fixed/accepted). --sev filters (critical/major/minor). Output TOON format: 'id: G-03\\nsev: major\\ndesc: Missing error handling\\nst: open'. Used by QA and Debugger agents to check for known issues before re-investigating.","files":["scripts/db/search-gaps.sh"],"tests":["tests/unit/db/search-gaps.bats: finds matching gaps, filters by status, filters by severity, ranked results"]}
{"id":"T4","title":"Create import-research-archive.sh for cross-phase persistence","spec":"Create scripts/db/import-research-archive.sh. Usage: import-research-archive.sh [--file PATH] [--db PATH]. Behavior: Read research-archive.jsonl (project-level), INSERT each line into research_archive table + research_fts (with phase tag). Dedup: ON CONFLICT(q, finding) DO NOTHING. Also create export-research-archive.sh that dumps research_archive table back to JSONL (for backward compatibility). The import runs once during init-db.sh if archive file exists.","files":["scripts/db/import-research-archive.sh","scripts/db/export-research-archive.sh"],"tests":["tests/unit/db/import-research-archive.bats: imports archive entries, deduplicates, export matches import, FTS searchable after import"]}
{"id":"T5","title":"Create search-all.sh unified cross-artifact search","spec":"Create scripts/db/search-all.sh. Usage: search-all.sh <QUERY> [--phase PHASE] [--limit N] [--db PATH]. Behavior: Union query across research_fts, decisions_fts, gaps_fts. Searches all three FTS tables, returns unified results sorted by relevance. Output format: 'type: research\\nphase: 03\\ncontent: JWT RS256 key rotation pattern...'. Useful for Scout agent and cross-phase knowledge retrieval. Limit defaults to 20 across all types. This is the primary entry point for the RAG-style retrieval pattern.","files":["scripts/db/search-all.sh"],"tests":["tests/unit/db/search-all.bats: returns results from all tables, type tag correct, phase filter works, limit works"]}
