{"p":"07","n":"06","t":"Mode-filtered agent prompt generation","w":2,"d":["07-01"],"mh":{"tr":["generate-agent.sh supports --mode flag to emit only relevant sections","mode profiles define which sections each workflow step needs","30-50% token reduction per agent invocation"],"ar":["full agent prompt still available with --mode full"],"kl":["modes map to workflow steps: plan, implement, review, qa, test","section markers in templates enable filtering"]},"obj":"Implement T-2 (mode-filtered agent prompts) by extending the template system from 07-01 with section markers and a --mode flag on generate-agent.sh that emits only the sections relevant to the current workflow step, reducing per-invocation agent prompt tokens by 30-50%."}
{"id":"T1","tp":"modify","a":"Add section markers to agent templates (from 07-01) using <!-- mode:plan,implement --> style HTML comments that tag each section with the modes where it is relevant. Sections: hierarchy (all), persona (all), execution-protocol (implement,review), output-format (implement,qa), escalation (all), commit-discipline (implement), qa-checklist (qa,review).","f":["agents/templates/dev.md","agents/templates/senior.md","agents/templates/lead.md"],"v":"grep 'mode:' agents/templates/dev.md finds section markers","done":"3 key templates have mode markers on all major sections"}
{"id":"T2","tp":"modify","a":"Add section markers to remaining agent templates: architect, tester, qa, qa-code, security, documenter following same pattern as T1.","f":["agents/templates/architect.md","agents/templates/tester.md","agents/templates/qa.md","agents/templates/qa-code.md","agents/templates/security.md","agents/templates/documenter.md"],"v":"All 6 templates have mode markers","done":"All 9 agent templates have mode section markers"}
{"id":"T3","tp":"modify","a":"Extend scripts/generate-agent.sh (from 07-01) with --mode flag. When --mode is specified, filter output to include only sections whose mode marker includes the requested mode. When --mode is omitted or --mode full, emit all sections (backward compat).","f":["scripts/generate-agent.sh"],"v":"bash scripts/generate-agent.sh --role dev --dept backend --mode implement produces shorter output than --mode full; both validate as proper markdown","done":"generate-agent.sh --mode flag filters sections, reducing token count 30-50%"}
{"id":"T4","tp":"create","a":"Create config/mode-profiles.json defining which sections each workflow mode needs. Modes: plan (hierarchy, persona, decision-making), implement (all), review (hierarchy, persona, execution-protocol, qa-checklist), qa (hierarchy, persona, output-format, qa-checklist), test (hierarchy, persona, execution-protocol).","f":["config/mode-profiles.json"],"v":"jq '.modes.plan.sections' config/mode-profiles.json returns valid array","done":"mode-profiles.json defines section requirements for all workflow modes"}
{"id":"T5","tp":"create","a":"Add BATS tests verifying mode filtering: test that --mode plan produces fewer tokens than --mode full, test that --mode implement includes execution-protocol section, test that --mode review excludes commit-discipline section.","f":["tests/unit/generate-agent-modes.bats"],"v":"bats tests/unit/generate-agent-modes.bats passes","done":"Tests verify mode filtering reduces output and includes/excludes correct sections"}
