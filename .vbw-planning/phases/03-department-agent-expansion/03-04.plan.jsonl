{"p":"03","n":"04","t":"Context manifest system and compile-context.sh manifest support","w":1,"d":[],"mh":["context-manifest.json schema defines per-role file/field requirements","compile-context.sh reads manifests when present","Context packages per agent measurably smaller than current full-context approach","Manifest system backward compatible — compile-context.sh degrades to hardcoded roles when manifest absent","Each of 11 base roles + 6 new roles has a manifest entry"],"obj":"Create the context-manifest.json schema that defines exactly which files and fields each agent role needs, then update compile-context.sh to read manifests for token-budgeted context package generation. This replaces the hardcoded per-role case blocks with data-driven context scoping."}
{"id":"T1","tp":"create","a":"Create config/context-manifest.json — per-role context manifest. JSON structure: {roles: {role_name: {files: [glob_patterns], artifacts: [artifact_types], fields: {artifact_type: [field_names]}, budget: N, includes: [other_role_names]}}}. Define entries for all base roles: architect (files: [ROADMAP,REQUIREMENTS,codebase/*], artifacts: [critique,research], budget: 5000), lead (files: [architecture.toon,ROADMAP,REQUIREMENTS,STATE.md], artifacts: [decisions], budget: 3000), senior (files: [architecture.toon,PATTERNS.md], artifacts: [plan], fields: {plan: [id,a,f,done,spec,ts]}, budget: 4000), dev (artifacts: [plan], fields: {plan: [id,a,f,done,spec]}, budget: 2000), tester (artifacts: [plan], fields: {plan: [id,a,f,done,spec,ts]}, budget: 3000), qa (files: [success_criteria], artifacts: [plan], fields: {plan: [obj,mh]}, budget: 2000), qa-code (artifacts: [summary], fields: {summary: [fm]}, budget: 3000), security (artifacts: [summary], fields: {summary: [fm]}, budget: 3000), critic (files: [ROADMAP,REQUIREMENTS,PROJECT.md,codebase/*], artifacts: [research], budget: 4000), scout (files: [REQUIREMENTS,codebase/INDEX,ARCHITECTURE,PATTERNS], artifacts: [critique], fields: {critique: [id,q,sev]}, budget: 1000), owner (files: [REQUIREMENTS,success_criteria], artifacts: [department_result], budget: 3000), debugger (artifacts: [research,gaps], budget: 3000). Add new roles: documenter (artifacts: [summary,code-review], fields: {summary: [fm]}, budget: 2000), fe-security/ux-security (inherit from security with dept-specific budget).","f":["config/context-manifest.json"],"v":"jq '.roles.architect.budget' config/context-manifest.json returns 5000; jq '.roles.dev.fields.plan' config/context-manifest.json returns array with 'spec'; jq '.roles | keys | length' config/context-manifest.json returns >= 15","done":false}
{"id":"T2","tp":"modify","a":"Update scripts/compile-context.sh to support manifest-driven context compilation. Add new function get_manifest_config() that: (1) Checks if config/context-manifest.json exists; (2) If present, reads role entry via jq; (3) Returns manifest fields/artifacts/budget for the current BASE_ROLE; (4) If manifest absent, returns empty (triggers fallback to existing hardcoded case block). Modify the main case block: before each role's hardcoded logic, check if manifest data is available. If yes, use manifest-driven file selection and field filtering. If no, fall through to existing behavior unchanged. This ensures 100% backward compatibility.","f":["scripts/compile-context.sh"],"v":"grep -c 'context-manifest.json' scripts/compile-context.sh returns >= 1; grep -c 'get_manifest_config' scripts/compile-context.sh returns >= 2; existing role case blocks still present as fallback","done":false}
{"id":"T3","tp":"modify","a":"Update scripts/compile-context.sh get_budget() function to read budget from manifest when available. New logic: (1) If context-manifest.json exists AND role has entry: use manifest budget; (2) Otherwise: fall through to existing hardcoded case statement. This allows per-project budget tuning via manifest without code changes. Add new roles to hardcoded fallback: security variants (fe-security: 3000, ux-security: 2000), documenter variants (documenter: 2000, fe-documenter: 2000, ux-documenter: 2000).","f":["scripts/compile-context.sh"],"v":"grep -c 'fe-security' scripts/compile-context.sh returns >= 1; grep -c 'documenter' scripts/compile-context.sh returns >= 1","done":false}
{"id":"T4","tp":"modify","a":"Add new role cases to scripts/compile-context.sh for the 6 new roles. Add to the main case block: (1) fe-security and ux-security: same logic as security but with department-aware header and dept-specific dir_isolation paths; (2) documenter, fe-documenter, ux-documenter: new case that emits header + files_to_document (from summary.jsonl fm field) + code-review highlights + conventions. Each new role emits to .ctx-{ROLE}.toon. Update the BASE_ROLE extraction case to handle: documenter -> DEPT=backend, fe-documenter -> DEPT=fe, ux-documenter -> DEPT=ux.","f":["scripts/compile-context.sh"],"v":"grep -c 'documenter' scripts/compile-context.sh returns >= 3; grep -c 'fe-security' scripts/compile-context.sh returns >= 1; script still exits 0 for existing roles","done":false}
