{"p":"03","n":"07","t":"Wire Phase 3 agents into orchestration and update docs","w":2,"d":["03-01","03-02","03-03","03-04","03-05"],"mh":["execute-protocol.md updated with per-dept security and optional documenter step","go.md dispatches dept-specific security reviewers","Documenter spawning gated by config in go.md","Critique loop wired into go.md with confidence monitoring","CLAUDE.md reflects expanded agent roster and new decisions"],"obj":"Integrate all Phase 3 additions into the orchestration layer (go.md, execute-protocol.md) and update project documentation. Wire per-dept security dispatch, config-gated documenter spawning, and confidence-gated critique loop into the existing 11-step workflow."}
{"id":"T1","tp":"modify","a":"Update references/execute-protocol.md to reflect Phase 3 changes: (1) Step 1 (Critique): add confidence-gated multi-round critique. Entry gate: critique.enabled=true in config. Loop: call critique-loop.sh which runs Critic for max critique.max_rounds (default 3) rounds, exits early if cf >= critique.confidence_threshold (default 85). Exit gate: critique.jsonl exists with final cf score. Document round tracking via rd field; (2) Step 10 (Security): change from shared Security agent to per-department Security Reviewer. When backend active: spawn yolo-security (BE-scoped). When frontend active: spawn yolo-fe-security. When uiux active: spawn yolo-ux-security. Each dept security runs independently. FAIL from ANY dept = hard STOP; (3) Add new optional Step 8.5 (Documentation): after Code Review, before QA. Guard: documenter config != 'never'. If 'always': auto-spawn. If 'on_request': skip unless user requested. Spawn dept-specific documenter: yolo-documenter (BE), yolo-fe-documenter (FE), yolo-ux-documenter (UX). Produces docs.jsonl. Non-blocking — QA proceeds regardless of documenter status.","f":["references/execute-protocol.md"],"v":"grep -c 'critique-loop.sh' references/execute-protocol.md returns >= 1; grep -c 'per-department' references/execute-protocol.md returns >= 1; grep -c 'Step 8.5' references/execute-protocol.md returns >= 1","done":false}
{"id":"T2","tp":"modify","a":"Update commands/go.md to wire Phase 3 features into orchestration: (1) Critique step: replace direct Critic spawn with critique-loop.sh call. Pass --phase-dir, --config, --role (dept-aware: critic, fe-critic, ux-critic). Log confidence and rounds in status display; (2) Security step: replace single yolo-security spawn with dept-aware dispatch. Check departments config: for each active dept, spawn corresponding security reviewer (yolo-security for BE, yolo-fe-security for FE, yolo-ux-security for UX). In parallel when multiple depts active; (3) Documentation step: after code review, call resolve-documenter-gate.sh. If spawn=true, spawn dept-specific documenter. Non-blocking — proceed to QA immediately; (4) Status display updates: show critique confidence per round, show per-dept security status, show documenter gate decision.","f":["commands/go.md"],"v":"grep -c 'critique-loop.sh' commands/go.md returns >= 1; grep -c 'resolve-documenter-gate' commands/go.md returns >= 1; grep -c 'fe-security' commands/go.md returns >= 1","done":false}
{"id":"T3","tp":"config","a":"Add documenter configuration key to config/defaults.json: documenter (string, default 'on_request', valid values: 'on_request', 'always', 'never'). Place after the 'critique' object added in 03-03. This is the single config key that gates all 3 department documenter agents.","f":["config/defaults.json"],"v":"jq '.documenter' config/defaults.json returns 'on_request'","done":false}
{"id":"T4","tp":"docs","a":"Update CLAUDE.md to reflect Phase 3 changes: (1) Update Department Architecture table: Backend 9 agents (add security, documenter), Frontend 9 (add fe-security, fe-documenter), UI/UX 9 (add ux-security, ux-documenter), Shared 5 (note security now per-dept). Total ~36 agents; (2) Add key decisions: 'Per-department Security Reviewers with dept-scoped checks' (date, rationale: each dept has unique threat model), 'Config-gated Documenter (on_request/always/never)' (rationale: documentation is valuable but not always needed), 'Confidence-gated Critique Loop (3 rounds, 85 threshold)' (rationale: prevents runaway critique while ensuring quality), 'Lead absorbs Solution Q&A' (rationale: reduces agent count, Lead already owns delivery sign-off), 'Context manifests for token-budgeted context packages' (rationale: data-driven context scoping vs hardcoded); (3) Update 11-step workflow description to note optional Step 8.5 Documentation.","f":["CLAUDE.md"],"v":"grep -c 'Security Reviewer' CLAUDE.md returns >= 1; grep -c 'documenter' CLAUDE.md returns >= 1; grep -c '36' CLAUDE.md returns >= 1","done":false}
