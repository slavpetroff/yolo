{"p":11,"n":4,"t":"Remove dual-write guards from state-updater.sh and [sqlite]/[file] from execute-protocol.md","w":1,"d":[],"mh":["Zero dual-write conditional guards in state-updater.sh (DB writes are unconditional)","Zero [sqlite]/[file] markers in execute-protocol.md","Zero db_available references in execute-protocol.md","Dual-write comments replaced with 'DB write' (no 'dual' terminology)","state-updater.sh imports to DB unconditionally when DB path resolves"],"obj":"Remove dual-write guard conditionals from state-updater.sh (lines 345-372, 449-452) making DB imports unconditional. Remove all 14 [sqlite]/[file] conditional blocks from execute-protocol.md, keeping only the DB-only instructions. Remove 'when db_available=true' qualifiers throughout."}
{"id":"11-04-T1","tp":"refactor","a":"Make DB imports unconditional in state-updater.sh","f":["scripts/state-updater.sh"],"v":"grep -c 'Dual-write' scripts/state-updater.sh returns 0; grep -c 'db_available\\|DB_AVAILABLE' scripts/state-updater.sh returns 0","done":false,"spec":"state-updater.sh has 3 dual-write guard blocks: (1) Lines 345-354 (DB detection): Currently checks if _DB_FILE exists with if-guard. Change to: always derive _PLANNING_DIR and _DB_FILE from PHASE_DIR. Remove the existence check -- if DB does not exist, the import will fail silently (the || true already handles this). Remove comment '# --- Dual-write: detect DB for SQLite sync ---' and replace with '# --- DB sync ---'. (2) Lines 369-372 (plan import): Remove the conditional 'if [ -n \"${_DB_FILE:-}\" ] && [ -f \"${_DB_FILE:-}\" ]'. Make unconditional: bash \"$DB_IMPORT_SCRIPT\" --type plan --file \"$FILE_PATH\" --phase \"$(printf '%02d' \"$CACHED_PHASE_NUM\")\" --db \"$_DB_FILE\" >/dev/null 2>&1 || true. Keep || true for graceful degradation. Remove 'Dual-write:' comment prefix. (3) Lines 449-452 (summary import): Same treatment -- remove conditional, make unconditional import. Remove 'Dual-write:' comment prefix."}
{"id":"11-04-T2","tp":"refactor","a":"Remove [sqlite] dual-write blocks from execute-protocol.md Steps 1-4 (Critique, Research, Architecture, Planning)","f":["references/execute-protocol.md"],"v":"grep -c '\\[sqlite\\]' references/execute-protocol.md shows reduction; first 4 step blocks removed","done":false,"spec":"In execute-protocol.md: (1) Step 1 line 243 (critique dual-write): Remove the [sqlite] label and 'when db_available=true' qualifier. Make the import-jsonl.sh call unconditional. Remove the if-guard. Keep the bash command. Change comment from 'Dual-write to DB' to 'Write to DB'. (2) Step 2 (no [sqlite] blocks -- skip). (3) Step 3 lines 329-340 (decisions dual-write): Remove [sqlite] label. Remove if-guards around both import-decisions and import-gaps calls. Make unconditional. (4) Step 3 line 370 (crash recovery): Remove [sqlite] label and if-guard from DB-aware crash recovery. Remove line 390 [file] fallback entirely. The DB recovery path becomes the only path."}
{"id":"11-04-T3","tp":"refactor","a":"Remove [sqlite]/[file] blocks from execute-protocol.md Steps 5-8 (Design Review through Code Review)","f":["references/execute-protocol.md"],"v":"grep -c '\\[sqlite\\]\\|\\[file\\]' references/execute-protocol.md shows further reduction","done":false,"spec":"(1) Step 5 line 297 (summary dual-write): Remove [sqlite] label and if-guard. Make import-jsonl.sh --type summary unconditional. (2) Step 7 lines 507-541 (task queue ingestion + Dev task retrieval): Remove [sqlite] label from task queue ingestion. Make claim-task.sh and complete-task.sh unconditional. Remove the entire [file] block on line 541 ('File-based path when db_available=false...'). The DB task queue is the only path. (3) Error Recovery section lines 688-723: Remove [sqlite] label from DB-Aware Error Recovery. Make it the only error recovery path. Remove the [file] fallback block entirely (lines 723+)."}
{"id":"11-04-T4","tp":"refactor","a":"Remove [sqlite]/[file] blocks from execute-protocol.md Steps 9-11 (QA, Security, Sign-off)","f":["references/execute-protocol.md"],"v":"grep -c '\\[sqlite\\]\\|\\[file\\]' references/execute-protocol.md returns 0; grep -c 'db_available' references/execute-protocol.md returns 0","done":false,"spec":"(1) Step 9 line 810 (verification dual-write): Remove [sqlite] label and if-guard. Make import-jsonl.sh --type verification unconditional. (2) Step 9 line 862 (verification dual-write): Remove [sqlite] label and if-guard. Make unconditional. (3) Step 9 line 884 (qa-code dual-write): Remove [sqlite] label and if-guard. Make unconditional. (4) Step 10 line 987 (security findings dual-write): Remove [sqlite] label and if-guard. Make unconditional. After all removals, do a final sweep: grep for any remaining db_available, [sqlite], [file], 'when DB is available', 'Dual-write', 'File-based path' references and remove them. Change any remaining 'Dual-write to DB' comments to 'Write to DB'."}
