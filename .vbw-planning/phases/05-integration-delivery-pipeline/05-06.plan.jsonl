{"p":"05","n":"06","t":"Tests for integration gate, rejection paths, and delivery flow","w":2,"d":["05-01","05-02","05-03","05-04"],"mh":{"tr":["integration-gate.sh has BATS tests covering pass, fail, timeout scenarios","validate-config.sh tests cover new integration_gate and delivery config keys","Compile-context integration-gate role tested"],"ar":[],"kl":[]},"obj":"Add BATS test suites for integration-gate.sh, validate-config.sh new keys, and compile-context.sh integration-gate role. Cover happy path, failure modes, timeout, single-dept simplification, and patch/major config validation."}
{"id":"T1","tp":"create","a":"Create tests/unit/integration-gate.bats. Test cases: (1) gate passes when all active dept statuses are complete and cross-checks pass; (2) gate fails when a dept status file is missing; (3) gate fails when api-contracts.jsonl has status:proposed entries; (4) gate fails when design-handoff.jsonl has non-empty deferred list; (5) gate returns timeout JSON when timeout_seconds exceeded (mock with pre-set timestamps); (6) single-dept mode (only backend active) skips cross-dept checks; (7) gate output JSON has correct schema (gate, departments, cross_checks fields). Use test_helper/common-setup.bash pattern. Create fixture files in test setup (dept-status JSON, api-contracts, design-handoff).","f":["tests/unit/integration-gate.bats"],"v":"bats tests/unit/integration-gate.bats runs without syntax errors","done":"7+ test cases covering pass, fail, timeout, single-dept, schema validation"}
{"id":"T2","tp":"modify","a":"Add test cases to tests/unit/validate-config.bats for new config keys. New tests: (1) integration_gate.enabled accepts boolean; (2) integration_gate.timeout_seconds rejects non-number; (3) integration_gate.timeout_seconds rejects out-of-range (<60 or >3600); (4) po.default_rejection accepts 'patch' and 'major'; (5) po.default_rejection rejects invalid values; (6) delivery.mode accepts 'auto' and 'manual'; (7) delivery.present_to_user accepts boolean. Follow existing test pattern in the file — create temp config JSON, run validate-config.sh, check exit code and error output.","f":["tests/unit/validate-config.bats"],"v":"bats tests/unit/validate-config.bats runs without syntax errors","done":"7+ new test cases for integration_gate, po.default_rejection, delivery config validation"}
{"id":"T3","tp":"create","a":"Create tests/unit/compile-context-integration-gate.bats. Test cases: (1) integration-gate role produces .ctx-integration-gate.toon; (2) output includes department results when .dept-status-{dept}.json files exist; (3) output includes test results when test-results.jsonl exists; (4) output includes api-contracts when api-contracts.jsonl exists; (5) output excludes api-contracts when file missing (graceful degradation); (6) budget enforcement — output stays within 3000 token budget. Create fixture phase dir with mock artifacts in setup. Follow compile-context.bats pattern.","f":["tests/unit/compile-context-integration-gate.bats"],"v":"bats tests/unit/compile-context-integration-gate.bats runs without syntax errors","done":"6+ test cases covering context compilation for integration-gate role"}
{"id":"T4","tp":"create","a":"Create tests/unit/test-integration-delivery-flow.bats. Integration-level tests for the delivery pipeline: (1) patch config defaults to 'patch' when po.default_rejection not set; (2) integration-gate.sh JSON output parses correctly with jq (schema test); (3) validate-config.sh accepts full config with all new Phase 5 keys; (4) compile-context.sh integration-gate role exits 0 with minimal phase dir; (5) integration-gate.sh exits 1 when phase-dir does not exist. These are lightweight integration smoke tests confirming the pieces work together.","f":["tests/unit/test-integration-delivery-flow.bats"],"v":"bats tests/unit/test-integration-delivery-flow.bats runs without syntax errors","done":"5+ integration smoke tests confirming cross-component compatibility"}
