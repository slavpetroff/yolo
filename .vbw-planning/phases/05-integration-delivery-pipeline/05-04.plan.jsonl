{"p":"05","n":"04","t":"Delivery mode wiring in execute-protocol.md","w":1,"d":[],"mh":{"tr":["execute-protocol.md has Step 11.5 (Integration Gate) and Step 12 (PO Q&A + Delivery)","Patch path executes inline without re-running full pipeline","Major path triggers affected-dept-only re-run","User feedback loop from delivery back to PO"],"ar":[],"kl":[]},"obj":"Wire the Integration Gate (after Step 11 sign-off, before delivery) and PO Q&A + Delivery mode into execute-protocol.md. Add Step 11.5 (Integration Gate) and Step 12 (Delivery) with Patch/Major rejection handling and user feedback loop."}
{"id":"T1","tp":"modify","a":"Add Step 11.5: Integration Gate to references/execute-protocol.md. Insert between Step 11 (Sign-off) and the Output Format section. Guard: Skip if multi_dept=false (single dept has no cross-dept checks to run) AND integration_gate.enabled=false. Entry gate: verify .execution-state.json has steps.signoff.status='complete'. Protocol: (1) Run integration-gate.sh --phase-dir --config; (2) On gate=pass: proceed to Step 12; (3) On gate=fail: read failures, route to PO for verdict (Step 12 handles); (4) On gate=timeout: STOP with per-dept status report. Update execution state: step='integration_gate'. Exit gate: integration-gate-result.jsonl exists. Single-dept note: when multi_dept=false, step simplifies to test-results verification only (no api_contracts, design_sync, handoffs checks).","f":["references/execute-protocol.md"],"v":"grep -c 'Step 11.5' references/execute-protocol.md >= 1 && grep -c 'integration_gate' references/execute-protocol.md >= 2","done":"Step 11.5 added with guard, entry/exit gates, single-dept simplification"}
{"id":"T2","tp":"modify","a":"Add Step 12: PO Q&A + Delivery to references/execute-protocol.md. Insert after Step 11.5. Guard: Skip if po.enabled=false. Entry gate: integration-gate-result.jsonl exists OR steps.integration_gate.status='skipped'. Protocol: (1) Spawn PO Agent Mode 4 with integration-gate-result.jsonl + department_results + scope-document.json; (2) PO produces po_qa_verdict; (3) If verdict=approve: proceed to Delivery; (4) If verdict=patch: route patch_request to target dept Senior, Senior re-specs (max 2 tasks), Dev implements, re-run integration gate for specific check, loop back to PO Mode 4; (5) If verdict=major: trigger PO Mode 0 re-scope with affected_depts, after re-scope re-run affected dept pipelines only, loop back to Step 11.5; (6) Delivery: render PO user_presentation via AskUserQuestion, collect user feedback, if feedback requires changes route back to PO. Max 2 patch cycles, max 1 major cycle. Update execution state: step='delivery'. Exit gate: user approves delivery OR max cycles reached. Commit: chore(state): delivery complete phase {N}.","f":["references/execute-protocol.md"],"v":"grep -c 'Step 12' references/execute-protocol.md >= 2 && grep -c 'po_qa_verdict' references/execute-protocol.md >= 1","done":"Step 12 added with PO Q&A, Patch/Major paths, delivery rendering, user feedback loop"}
{"id":"T3","tp":"modify","a":"Update the Execution State Transitions table in references/execute-protocol.md to add rows for Step 11.5 and Step 12. Step 11.5: state.step='integration_gate', entry='steps.signoff complete', exit='integration-gate-result.jsonl', commit='chore(state): integration_gate complete phase {N}', skip='multi_dept=false AND integration_gate.enabled=false'. Step 12: state.step='delivery', entry='integration-gate-result.jsonl OR step 11.5 skipped', exit='.execution-state.json complete + user approval', commit='chore(state): delivery complete phase {N}', skip='po.enabled=false'. Also update the .execution-state.json schema in Step 4 to include integration_gate and delivery step entries.","f":["references/execute-protocol.md"],"v":"grep -c 'integration_gate' references/execute-protocol.md >= 3 && grep -c 'delivery' references/execute-protocol.md >= 3","done":"Transition table updated, execution state schema extended with new steps"}
{"id":"T4","tp":"modify","a":"Add user feedback loop documentation to references/execute-protocol.md Step 12. After delivery rendering subsection, add '### User Feedback Loop'. Protocol: (1) After AskUserQuestion renders PO output, user can respond with: 'Approve' (phase complete), 'Request changes' (specific feedback), 'Reject' (re-scope needed); (2) On 'Request changes': parse user feedback, send to PO as scope_change_assessment input (Mode 2), PO evaluates and produces ACCEPT/DEFER/REJECT recommendation; (3) On PO ACCEPT: route as patch (targeted fix to specific dept); (4) On PO DEFER: log to decisions.jsonl, proceed with delivery; (5) On PO REJECT: escalate to user with evidence for Major path decision; (6) Max 2 feedback rounds per delivery.","f":["references/execute-protocol.md"],"v":"grep -c 'User Feedback Loop' references/execute-protocol.md >= 1","done":"Feedback loop documented with 3 response types, PO routing, max rounds"}
