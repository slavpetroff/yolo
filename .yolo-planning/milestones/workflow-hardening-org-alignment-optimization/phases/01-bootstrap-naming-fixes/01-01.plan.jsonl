{"p": "01", "n": "01", "t": "Fix CLAUDE.md bootstrap override bug", "w": 1, "d": [], "mh": {"tr": ["bootstrap-claude.sh preserves all non-YOLO non-GSD sections verbatim", "bootstrap-claude.sh YOLO_SECTIONS array matches all sections generated by generate_yolo_sections()", "Content between top-level heading and first section header is not duplicated", "go.md ship mode step 8 calls bootstrap-claude.sh instead of inline regeneration"], "ar": [{"p": "scripts/bootstrap/bootstrap-claude.sh", "pv": "YOLO_SECTIONS array includes Department Architecture", "c": "grep 'Department Architecture' scripts/bootstrap/bootstrap-claude.sh succeeds"}, {"p": "tests/unit/bootstrap-claude.bats", "pv": "test file exists with preservation tests", "c": "bats tests/unit/bootstrap-claude.bats passes"}], "kl": [{"fr": "commands/go.md", "to": "scripts/bootstrap/bootstrap-claude.sh", "vi": "go.md ship mode step 8 references bootstrap-claude.sh for CLAUDE.md regeneration"}]}, "obj": "Fix silent CLAUDE.md content override by closing section-list gaps, eliminating content duplication, and unifying the regeneration code path (REQ-01)", "sk": ["commit"], "fm": ["scripts/bootstrap/bootstrap-claude.sh", "commands/go.md", "tests/unit/bootstrap-claude.bats"]}
{"id": "T1", "tp": "auto", "a": "Investigate and document all CLAUDE.md override scenarios: (1) YOLO_SECTIONS missing Department Architecture, (2) content between # heading and first ## duplicated on regeneration, (3) go.md ship step 8 inline regeneration vs bootstrap-claude.sh script. Write investigation findings to phase decisions.jsonl. REQ-01 root cause.", "f": ["scripts/bootstrap/bootstrap-claude.sh", "commands/go.md", ".yolo-planning/phases/01-bootstrap-naming-fixes/decisions.jsonl"], "v": "decisions.jsonl contains investigation findings with all three root causes documented", "done": "Investigation findings committed to decisions.jsonl", "spec": "INVESTIGATION TASK: Read three files, document four root causes in decisions.jsonl.\n\nROOT CAUSE 1 (YOLO_SECTIONS gap): Read scripts/bootstrap/bootstrap-claude.sh lines 22-31. The YOLO_SECTIONS array lists 7 sections: Active Context, YOLO Rules, Key Decisions, Installed Skills, Project Conventions, Commands, Plugin Isolation. But the project CLAUDE.md (root) has a '## Department Architecture' section (see CLAUDE.md line with Department Architecture table). This section is NOT in YOLO_SECTIONS, so the parser at lines 133-159 treats it as user content and duplicates it on regeneration. Document: section name, line numbers in bootstrap-claude.sh, line reference in CLAUDE.md.\n\nROOT CAUSE 2 (content duplication between heading and first ##): Read bootstrap-claude.sh lines 145-148. Lines 146-148 skip the top-level heading (# Project) and core value line (**Core value:**). But any OTHER lines between the # heading and the first ## section (e.g., blank lines, description text) are NOT skipped. They accumulate in NON_YOLO_CONTENT (line 155-157) because IN_MANAGED_SECTION starts as false (line 130). On regeneration, these lines appear BOTH in the preserved content AND in the regenerated header block (lines 162-173). Document: the variable state at line 130, the skip conditions at 146-151, and the gap.\n\nROOT CAUSE 3 (go.md archive step 8): Read commands/go.md line 411. The instruction reads: 'Regenerate CLAUDE.md: update Active Context, remove shipped refs. Preserve non-YOLO content -- only replace YOLO-managed sections, keep user\\'s own sections intact.' This is prose that the executing agent interprets freely. It does NOT call bootstrap-claude.sh. The agent may generate different sections, different ordering, or miss preservation logic. Document: exact line text, contrast with go.md B6 (line 179) which correctly calls bootstrap-claude.sh.\n\nROOT CAUSE 4 (init.md step 3.5 per C1): Read commands/init.md lines 219-232. Step 3.5 constructs CLAUDE.md inline with its own section list (Rules, State, Skills, Conventions, Commands, Plugin Isolation) that diverges from bootstrap-claude.sh generate_yolo_sections(). It does NOT call bootstrap-claude.sh. Brownfield handling uses '---' separator instead of section-aware merge. Document: section list differences, line numbers.\n\nOUTPUT: Append 4 entries to .yolo-planning/phases/01-bootstrap-naming-fixes/decisions.jsonl. Each entry follows schema: {\"ts\":\"2026-02-17T...\",\"agent\":\"dev\",\"task\":\"T1\",\"dec\":\"Root cause N: ...\",\"reason\":\"...\",\"alts\":[]}. Use ISO 8601 timestamps starting from 2026-02-17T10:00:00Z, incrementing by 1 second. Do NOT overwrite existing entries -- use the Edit tool to append after the last line.", "ts": "No automated tests for this investigation task. Verification is manual: read decisions.jsonl and confirm 4 root cause entries exist with agent='dev', task='T1', each documenting a distinct root cause with file paths and line numbers."}
{"id": "T2", "tp": "auto", "a": "Fix bootstrap-claude.sh: (1) Add '## Department Architecture' to YOLO_SECTIONS array, (2) Fix content-between-heading-and-first-section duplication by skipping lines before the first ## header that are not section headers, (3) Verify the YOLO_SECTIONS array exhaustively matches every ## header output by generate_yolo_sections(). REQ-01 fix.", "f": ["scripts/bootstrap/bootstrap-claude.sh"], "v": "YOLO_SECTIONS array has all sections from generate_yolo_sections(); running script with existing CLAUDE.md produces no duplicate content", "done": "bootstrap-claude.sh section list complete, no duplication on existing file preservation", "spec": "FILE: scripts/bootstrap/bootstrap-claude.sh (MODIFY). Six changes required:\n\nCHANGE 1 -- Add Department Architecture to YOLO_SECTIONS (line 23-31). Insert '\"## Department Architecture\"' into the YOLO_SECTIONS array AFTER '\"## Active Context\"' (line 24) and BEFORE '\"## YOLO Rules\"' (line 25). This matches the section order in the project CLAUDE.md. After this change, YOLO_SECTIONS has 8 entries: Active Context, Department Architecture, YOLO Rules, Key Decisions, Installed Skills, Project Conventions, Commands, Plugin Isolation.\n\nCHANGE 2 -- Add Department Architecture section to generate_yolo_sections() (lines 49-97). Insert after the Active Context section (after line 56, before '## YOLO Rules' on line 57) the following section:\n\n## Department Architecture\n\n26 agents across 4 departments. Enable/disable via `config/defaults.json` `departments` key.\n\n| Department | Agents | Prefix | Protocol File |\n|-----------|--------|--------|---------------|\n| Backend | architect, lead, senior, dev, tester, qa, qa-code | (none) | `references/departments/backend.toon` |\n| Frontend | fe-architect, fe-lead, fe-senior, fe-dev, fe-tester, fe-qa, fe-qa-code | `fe-` | `references/departments/frontend.toon` |\n| UI/UX | ux-architect, ux-lead, ux-senior, ux-dev, ux-tester, ux-qa, ux-qa-code | `ux-` | `references/departments/uiux.toon` |\n| Shared | owner, critic, scout, debugger, security | (none) | `references/departments/shared.toon` |\n\nThis ensures generate_yolo_sections() output matches YOLO_SECTIONS.\n\nCHANGE 3 -- Add startup self-verification (after line 31, before GSD_SECTIONS). Add a function verify_section_registry() that: (a) Captures generate_yolo_sections output into a variable: local generated; generated=$(generate_yolo_sections). (b) Extracts all ## headings from generated output: local gen_headers; gen_headers=$(echo \"$generated\" | grep -E '^## ' | sort). (c) Builds sorted YOLO_SECTIONS list: local reg_headers; reg_headers=$(printf '%s\\n' \"${YOLO_SECTIONS[@]}\" | sort). (d) Compares: if [[ \"$gen_headers\" != \"$reg_headers\" ]]; then echo \"FATAL: YOLO_SECTIONS registry does not match generate_yolo_sections() output\" >&2; echo \"Registry: $reg_headers\" >&2; echo \"Generated: $gen_headers\" >&2; exit 1; fi. Call verify_section_registry after the YOLO_SECTIONS and GSD_SECTIONS arrays are defined (after line 43), but ONLY when --verify flag is passed OR as an always-on check. Architecture says always verify at startup, so call it unconditionally after the arrays. Note: This function must be defined AFTER generate_yolo_sections (line 49-97) but called at script startup. Solution: move the verify call to after generate_yolo_sections is defined, i.e., after line 97. Add: verify_section_registry.\n\nCHANGE 4 -- Fix content duplication between heading and first section (lines 129-159). The bug: IN_MANAGED_SECTION starts as false (line 130), so any content before the first ## header (except # heading and **Core value:**) is captured as NON_YOLO_CONTENT. Fix: Add a BEFORE_FIRST_SECTION=true flag (line 131). In the while loop, when we encounter the first line matching ^## (line 135 or 141), set BEFORE_FIRST_SECTION=false. While BEFORE_FIRST_SECTION=true, skip all lines (they are the heading block which we regenerate). Specifically, replace line 155 condition from: if [[ \"$IN_MANAGED_SECTION\" == false ]]; then -- to: if [[ \"$IN_MANAGED_SECTION\" == false ]] && [[ \"$BEFORE_FIRST_SECTION\" == false ]]; then. This ensures content before the first ## is never captured as user content.\n\nCHANGE 5 -- Add code-block-awareness to parser (C9). In the while-read loop (line 133), add IN_CODE_BLOCK=false before the loop (at line 132). At the start of each iteration (after 'while IFS= read -r line'), add: if [[ \"$line\" =~ ^\\`\\`\\` ]]; then if [[ \"$IN_CODE_BLOCK\" == false ]]; then IN_CODE_BLOCK=true; else IN_CODE_BLOCK=false; fi; fi. Then wrap ALL heading detection logic (lines 135-148) in: if [[ \"$IN_CODE_BLOCK\" == false ]]; then ... fi. This prevents lines like '## Example' inside code blocks from being treated as section headers.\n\nCHANGE 6 -- Add collision detection (C6, D7). After the while loop ends (after line 159), before writing output (line 162), add collision scan: if [[ \"$FOUND_NON_YOLO\" == true ]]; then while IFS= read -r preserved_line; do for header in \"${YOLO_SECTIONS[@]}\"; do if [[ \"$preserved_line\" == \"$header\" ]]; then echo \"WARNING: User section '$header' collides with YOLO-managed section. User content under this heading will be replaced.\" >&2; fi; done; done <<< \"$NON_YOLO_CONTENT\"; fi.\n\nCHANGE 7 -- Add --minimal flag support (C1, for init.md). Parse flags from args: after EXISTING_PATH=\"${4:-}\" (line 20), add MINIMAL=false and VERIFY_ONLY=false. Then loop over all args: for arg in \"$@\"; do case \"$arg\" in --minimal) MINIMAL=true;; --verify) VERIFY_ONLY=true;; esac; done. If VERIFY_ONLY=true, call verify_section_registry and exit 0. For --minimal, create a generate_minimal_sections() function that outputs ONLY: ## YOLO Rules (same content), ## Project Conventions (same), ## Commands (same), ## Plugin Isolation (same). Then in the output blocks (lines 162-183), replace generate_yolo_sections calls with: if [[ \"$MINIMAL\" == true ]]; then generate_minimal_sections; else generate_yolo_sections; fi. Update the usage comment at lines 4-10 to document the new flags.\n\nIMPORTANT: The --minimal and --verify flags can appear anywhere in the argument list. The positional args OUTPUT_PATH, PROJECT_NAME, CORE_VALUE must still be the first 3 args. EXISTING_PATH is the 4th positional arg if it does not start with --. Update the arg parsing: shift through positional args first (lines 12-20 already handle this), then handle flags. For robustness, change the flag parsing to: filter out --flags from $4 onward. If $4 starts with --, it is a flag not EXISTING_PATH.\n\nVerify the final script with: bash scripts/bootstrap/bootstrap-claude.sh --verify (should exit 0). Then: bash scripts/bootstrap/bootstrap-claude.sh /tmp/test.md \"Test\" \"Value\" (fresh file, should have 8 YOLO sections). Then: bash scripts/bootstrap/bootstrap-claude.sh /tmp/test.md \"Test\" \"Value\" /tmp/test.md (in-place, should not duplicate content).", "ts": "Tests are in T4. Key verification for this task: (1) grep -c 'Department Architecture' scripts/bootstrap/bootstrap-claude.sh >= 2 (array entry + section output). (2) Run with --verify exits 0. (3) Generate fresh file, count ## headers = 8. (4) Regenerate in-place, diff shows only timestamp-like changes (no duplication)."}
{"id": "T3", "tp": "auto", "a": "Fix go.md ship mode step 8: replace inline CLAUDE.md regeneration instruction with explicit bootstrap-claude.sh call pattern. Ensure it passes existing CLAUDE.md as 4th arg for preservation. REQ-01 code path unification.", "f": ["commands/go.md"], "v": "go.md step 8 references bootstrap-claude.sh with 4-arg pattern", "done": "go.md ship mode uses bootstrap-claude.sh for CLAUDE.md regeneration", "spec": "FILE: commands/go.md (MODIFY). Single change at line 411.\n\nCURRENT LINE 411: '8. Regenerate CLAUDE.md: update Active Context, remove shipped refs. Preserve non-YOLO content -- only replace YOLO-managed sections, keep user\\'s own sections intact.'\n\nREPLACE WITH (multi-line, same indentation as surrounding numbered items):\n'8. Regenerate CLAUDE.md via bootstrap-claude.sh:\\n   ```\\n   bash ${CLAUDE_PLUGIN_ROOT}/scripts/bootstrap/bootstrap-claude.sh CLAUDE.md \"$PROJECT_NAME\" \"$CORE_VALUE\" CLAUDE.md\\n   ```\\n   Script handles section replacement and user content preservation. After regeneration, update Active Context section via Edit tool: set **Work:** to next milestone name (if any) or \"No active milestone\", set **Last shipped:** to archived milestone name with metrics (phases, plans, tasks, commits, tests).'\n\nADDITIONAL CONTEXT: This matches the pattern already used at go.md line 179 (B6 Bootstrap step) which calls bootstrap-claude.sh. The 4th arg CLAUDE.md is the same file as the 1st arg -- this is the in-place regeneration pattern (same file for input and output). The post-script Edit for Active Context is necessary because bootstrap-claude.sh generates a default Active Context ('No active milestone') that needs to be updated with the actual archive results.\n\nIMPORTANT: Also fix init.md step 3.5 (lines 219-232) as part of this task per C1/D2. Replace the entire content of step 3.5 with an instruction to call bootstrap-claude.sh --minimal.\n\nFILE: commands/init.md (MODIFY). Replace lines 219-232 (the entire Step 3.5 section body after the heading). Keep the heading '### Step 3.5: Generate bootstrap CLAUDE.md' on line 219.\n\nCURRENT CONTENT (lines 220-232): Describes inline CLAUDE.md generation with brownfield handling via '---' separator, YOLO sections list, new file template, existing file append, 40-line limit.\n\nREPLACE BODY (lines 220-232) WITH:\n'\\nGenerate initial CLAUDE.md with YOLO bootstrap sections using the central script.\\n\\n**Brownfield handling:** If root `CLAUDE.md` exists, pass it as 4th arg for section preservation.\\n\\n```\\nif [ -f CLAUDE.md ]; then\\n  bash ${CLAUDE_PLUGIN_ROOT}/scripts/bootstrap/bootstrap-claude.sh CLAUDE.md \"$PROJECT_NAME\" \"$CORE_VALUE\" CLAUDE.md --minimal\\nelse\\n  bash ${CLAUDE_PLUGIN_ROOT}/scripts/bootstrap/bootstrap-claude.sh CLAUDE.md \"$PROJECT_NAME\" \"$CORE_VALUE\" --minimal\\nfi\\n```\\n\\nThe `--minimal` flag generates only init-appropriate sections (YOLO Rules, Project Conventions, Commands, Plugin Isolation) since no project context exists yet. Active Context, Key Decisions, Department Architecture, and Installed Skills are added later by `/yolo:go` bootstrap mode (B6) which calls bootstrap-claude.sh without `--minimal`.\\n\\nDisplay `check-mark CLAUDE.md (created)` or `check-mark CLAUDE.md (YOLO sections merged with existing)`.'\n\nNote: Use actual Unicode check-mark symbol in the display instructions, matching existing init.md patterns.\n\nVERIFICATION: After both edits, search go.md for 'bootstrap-claude.sh' -- should appear at line 179 (B6) and at new line ~411 (step 8). Search init.md for 'bootstrap-claude.sh' -- should appear in step 3.5. Neither file should contain inline CLAUDE.md section generation.", "ts": "No automated tests for markdown command file changes. Manual verification: (1) grep 'bootstrap-claude.sh' commands/go.md returns 2+ matches (B6 and step 8). (2) grep 'bootstrap-claude.sh.*--minimal' commands/init.md returns 1+ match. (3) init.md step 3.5 no longer contains '---' separator append pattern. (4) go.md step 8 no longer contains 'Preserve non-YOLO content' prose."}
{"id": "T4", "tp": "auto", "a": "Write tests/unit/bootstrap-claude.bats: (1) test fresh generation produces valid CLAUDE.md, (2) test with existing file preserves non-YOLO sections, (3) test Department Architecture section not duplicated, (4) test content between heading and first section not duplicated, (5) test GSD sections stripped. REQ-01 verification.", "f": ["tests/unit/bootstrap-claude.bats"], "v": "bats tests/unit/bootstrap-claude.bats passes all 5+ test cases", "done": "Bootstrap CLAUDE.md tests written and passing", "spec": "FILE: tests/unit/bootstrap/bootstrap-claude.bats (MODIFY -- file exists at this path with 7 existing tests). Add NEW test cases AFTER the existing tests (after line 133). Do NOT modify or remove existing tests.\n\nNEW TEST 1 -- Department Architecture section present:\n@test \"generates Department Architecture section in fresh file\" {\n  bash \"$SUT\" \"$TEST_WORKDIR/CLAUDE.md\" \"TestApp\" \"Core value\"\n  run cat \"$TEST_WORKDIR/CLAUDE.md\"\n  assert_output --partial \"## Department Architecture\"\n  assert_output --partial \"26 agents across 4 departments\"\n}\n\nNEW TEST 2 -- Department Architecture not duplicated on regeneration:\n@test \"Department Architecture not duplicated when regenerating existing file\" {\n  # Create file with Department Architecture section\n  cat > \"$TEST_WORKDIR/existing.md\" <<'EOF'\n# MyProject\n\n**Core value:** Build things\n\n## Department Architecture\n\n26 agents across 4 departments.\n\n## Active Context\n\n**Work:** Some milestone\n\n## YOLO Rules\n\n- Rule one\nEOF\n  bash \"$SUT\" \"$TEST_WORKDIR/CLAUDE.md\" \"MyProject\" \"Build things\" \"$TEST_WORKDIR/existing.md\"\n  local count\n  count=$(grep -c '## Department Architecture' \"$TEST_WORKDIR/CLAUDE.md\")\n  [ \"$count\" -eq 1 ]\n}\n\nNEW TEST 3 -- Content between heading and first section not duplicated:\n@test \"content between heading and first ## is not duplicated\" {\n  cat > \"$TEST_WORKDIR/existing.md\" <<'EOF'\n# MyProject\n\n**Core value:** Build things\n\nThis is a description line that appears before any ## section.\nAnother description line.\n\n## Custom Section\n\nCustom content here.\n\n## Active Context\n\n**Work:** Old work\nEOF\n  bash \"$SUT\" \"$TEST_WORKDIR/CLAUDE.md\" \"MyProject\" \"Build things\" \"$TEST_WORKDIR/existing.md\"\n  local desc_count\n  desc_count=$(grep -c 'This is a description line' \"$TEST_WORKDIR/CLAUDE.md\")\n  [ \"$desc_count\" -eq 0 ]\n}\nNote: The description lines between # heading and first ## should NOT appear in output. The heading block is fully regenerated by the script (# heading + **Core value:**). Any other content in that block is discarded to prevent duplication.\n\nNEW TEST 4 -- In-place regeneration (same file for input and output, per C11):\n@test \"in-place regeneration: same file for OUTPUT_PATH and EXISTING_PATH\" {\n  bash \"$SUT\" \"$TEST_WORKDIR/CLAUDE.md\" \"First\" \"First value\"\n  # Add custom section to the generated file\n  echo -e '\\n## My Custom\\n\\nKeep this.' >> \"$TEST_WORKDIR/CLAUDE.md\"\n  # Regenerate in-place\n  bash \"$SUT\" \"$TEST_WORKDIR/CLAUDE.md\" \"Second\" \"Second value\" \"$TEST_WORKDIR/CLAUDE.md\"\n  run cat \"$TEST_WORKDIR/CLAUDE.md\"\n  assert_output --partial \"# Second\"\n  assert_output --partial \"**Core value:** Second value\"\n  assert_output --partial \"## My Custom\"\n  assert_output --partial \"Keep this.\"\n  # Verify no corruption -- YOLO sections present exactly once\n  local ac_count\n  ac_count=$(grep -c '## Active Context' \"$TEST_WORKDIR/CLAUDE.md\")\n  [ \"$ac_count\" -eq 1 ]\n}\n\nNEW TEST 5 -- Code block content not treated as heading (C9):\n@test \"code block with ## header is not treated as section boundary\" {\n  cat > \"$TEST_WORKDIR/existing.md\" <<'TESTEOF'\n# Project\n\n**Core value:** Value\n\n## My Docs\n\nHere is an example:\n\n```markdown\n## This Is Not A Real Section\n\nContent inside code block.\n```\n\nMore docs after the code block.\n\n## Active Context\n\n**Work:** Old\nTESTEOF\n  bash \"$SUT\" \"$TEST_WORKDIR/CLAUDE.md\" \"Project\" \"Value\" \"$TEST_WORKDIR/existing.md\"\n  run cat \"$TEST_WORKDIR/CLAUDE.md\"\n  assert_output --partial \"## My Docs\"\n  assert_output --partial \"## This Is Not A Real Section\"\n  assert_output --partial \"Content inside code block.\"\n  assert_output --partial \"More docs after the code block.\"\n}\n\nNEW TEST 6 -- Collision warning on stderr (C6):\n@test \"warns on stderr when user section name collides with YOLO section\" {\n  cat > \"$TEST_WORKDIR/existing.md\" <<'EOF'\n# Project\n\n**Core value:** Value\n\n## Active Context\n\nUser wrote their own Active Context section.\n\n## My Section\n\nSafe content.\nEOF\n  run bash \"$SUT\" \"$TEST_WORKDIR/CLAUDE.md\" \"Project\" \"Value\" \"$TEST_WORKDIR/existing.md\"\n  # Note: collision warning goes to stderr. The 'run' command captures both stdout and stderr.\n  # Actually, 'run' only captures stdout by default. To capture stderr, redirect:\n  # Use: run bash -c '... 2>&1' to merge stderr into stdout for assertion.\n  run bash -c \"bash '$SUT' '$TEST_WORKDIR/CLAUDE.md' 'Project' 'Value' '$TEST_WORKDIR/existing.md' 2>&1\"\n  # The collision warning should NOT appear because Active Context is a managed section,\n  # and managed sections are stripped before collision detection. Only truly user-created\n  # sections that happen to match YOLO names would trigger a warning.\n  # Actually, the parser strips managed sections (line 135-137), so Active Context content\n  # never makes it to NON_YOLO_CONTENT. The collision warning fires on NON_YOLO_CONTENT\n  # sections that match YOLO_SECTIONS names.\n  # For a real collision, a user would need to have a ## section with a YOLO name that\n  # the script does NOT yet know about. Since we just added all sections, the only way\n  # to test is to have a section that matches after stripping. This test verifies no\n  # false-positive warning on normal operation.\n  refute_output --partial \"WARNING:\"\n}\n\nNEW TEST 7 -- --minimal flag produces reduced section set:\n@test \"--minimal flag generates only bootstrap-appropriate sections\" {\n  bash \"$SUT\" \"$TEST_WORKDIR/CLAUDE.md\" \"InitProject\" \"Init value\" --minimal\n  run cat \"$TEST_WORKDIR/CLAUDE.md\"\n  # Present in minimal:\n  assert_output --partial \"## YOLO Rules\"\n  assert_output --partial \"## Project Conventions\"\n  assert_output --partial \"## Commands\"\n  assert_output --partial \"## Plugin Isolation\"\n  # NOT present in minimal:\n  refute_output --partial \"## Active Context\"\n  refute_output --partial \"## Key Decisions\"\n  refute_output --partial \"## Department Architecture\"\n  refute_output --partial \"## Installed Skills\"\n}\n\nNEW TEST 8 -- --verify flag exits 0 on valid registry:\n@test \"--verify flag validates section registry and exits 0\" {\n  run bash \"$SUT\" /dev/null \"Test\" \"Value\" --verify\n  assert_success\n}\n\nNEW TEST 9 -- Section count is exactly 8 in fresh full generation:\n@test \"fresh file has exactly 8 YOLO sections\" {\n  bash \"$SUT\" \"$TEST_WORKDIR/CLAUDE.md\" \"Test\" \"Value\"\n  local section_count\n  section_count=$(grep -c '^## ' \"$TEST_WORKDIR/CLAUDE.md\")\n  [ \"$section_count\" -eq 8 ]\n}\n\nTOTAL: 9 new tests + 7 existing = 16 tests. Run: bats tests/unit/bootstrap/bootstrap-claude.bats -- all 16 must pass.", "ts": "This IS the test task. The file tests/unit/bootstrap/bootstrap-claude.bats is the deliverable. Verify by running: bats tests/unit/bootstrap/bootstrap-claude.bats. All 16 tests (7 existing + 9 new) must pass. Key coverage: (1) Department Architecture present, (2) no duplication on regen, (3) heading-block content not duplicated, (4) in-place same-file regen, (5) code block awareness, (6) no false-positive collision warning, (7) --minimal reduced sections, (8) --verify validation, (9) section count = 8."}
