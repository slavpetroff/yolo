{"p":"03","n":"03","t":"R&D handoff protocol and change management loops","w":2,"d":["03-01"],"xd":[{"p":"02","n":"01","a":".yolo-planning/phases/02-r-d-research-flow-context-optimization/02-01.summary.jsonl","r":"Phase 2 plan 01 established the Scout research step in execute-protocol -- this plan formalizes the handoff protocol around it"}],"mh":{"tr":["R&D handoff protocol covers Critic->Scout->Architect pipeline end-to-end","Change management section exists in execute-protocol.md","Senior<->Dev revision cycle is documented with max cycles and escalation"],"ar":[{"p":"references/rnd-handoff-protocol.md","pv":"file exists","c":"Contains sections: Pipeline Overview, Critic Output Format, Scout Research Directives, Architect Consumption, Handoff Artifacts, Failure Modes"},{"p":"references/execute-protocol.md","pv":"file exists","c":"Contains Change Management section documenting Senior<->Dev revision cycle and escalation triggers"}],"kl":[{"fr":"rnd-handoff-protocol.md pipeline","to":"execute-protocol.md Steps 1-3","vi":"Protocol references execute-protocol step numbers"},{"fr":"execute-protocol.md change management","to":"agents/yolo-senior.md Code Review","vi":"Revision cycle rules match Senior code review protocol"}]},"obj":"Formalize the R&D->Architect handoff as a standalone protocol document and add change management loops (Senior<->Dev revision cycle) to execute-protocol.md (REQ-05)","sk":["commit"],"fm":["references/rnd-handoff-protocol.md","references/execute-protocol.md","references/company-hierarchy.md"],"auto":true}
{"id":"T1","tp":"auto","a":"Create references/rnd-handoff-protocol.md formalizing the Critic->Scout->Architect pipeline (REQ-05). Document: pipeline overview (3-step R&D flow), Critic output format and filtering (critical/major to Scout), Scout research directive generation, Architect consumption of research.jsonl (mode-aware: pre-critic, post-critic, standalone), handoff artifact schemas, failure modes (Scout finds nothing, conflicting sources, Critic has no findings). Reference execute-protocol Steps 1-3.","f":["references/rnd-handoff-protocol.md"],"v":"File exists with all required sections","done":"R&D handoff protocol committed","spec":"## T1: Create R&D Handoff Protocol\n\n### Context (D3, C5, R3, R4, R9, I2)\nPer D3, formalize the Critic->Scout->Architect pipeline AND the Architect->Lead stage-gate handoff. Per R9, use the stage-gate model (Go/Recycle/Kill) for Architect->Lead. Per R4, define completeness checklist.\n\n### File to Create\n`references/rnd-handoff-protocol.md`\n\n### Structure\n\n```markdown\n# R&D Handoff Protocol\n\nFormalizes the Critic->Scout->Architect pipeline (Steps 1-3) and the Architect->Lead stage-gate handoff (Step 3->4). Referenced by execute-protocol.md.\n\n## Pipeline Overview\n\n```\nStep 1: Critic → critique.jsonl (gap analysis)\n   │ critical/major findings\n   ▼\nStep 2: Scout → research.jsonl (targeted research)\n   │ all findings (pre-critic + post-critic)\n   ▼\nStep 3: Architect → architecture.toon (system design)\n   │ stage-gate\n   ▼\nStep 4: Lead → plan.jsonl (task decomposition)\n```\n\n## Step 1: Critic Output\n\nCritic produces critique.jsonl with findings. Each finding has:\n- `id`: C1, C2, etc.\n- `sev`: critical, major, minor\n- `st`: open (initially)\n\n**Filtering for Scout:** Only critical and major findings feed into Scout research directives. Minor findings are advisory and do not generate research tasks.\n\n## Step 2: Scout Research Directives\n\nFor each critical/major finding from critique.jsonl, the orchestrator (go.md) generates a research directive:\n- `directive`: Research question derived from the critique finding\n- `brief_for`: Critique ID (e.g., C1) linking research back to the finding\n\nScout produces research.jsonl entries with:\n- `mode: \"post-critic\"` -- targeted research for specific critique findings\n- `addresses: [\"C1\"]` -- links back to critique IDs\n- `conf: \"high\" | \"medium\" | \"low\"` -- confidence in finding\n\n**Pre-existing research:** research.jsonl may already contain `mode: \"pre-critic\"` entries from earlier research runs. These coexist with post-critic entries (append mode).\n\n**Failure modes:**\n- Scout finds nothing: Entry with `finding: \"No relevant information found\"` and `conf: \"low\"`. Architect proceeds with available information.\n- Conflicting sources: Scout reports both positions with evidence. Architect makes the decision.\n\n## Step 3: Architect Consumption\n\nArchitect reads research.jsonl and processes entries by mode:\n1. `post-critic` (high priority): Targeted findings linked to critique. Use `brief_for` to cross-reference critique ID. High-confidence findings carry more weight.\n2. `pre-critic` (context): General best-practices research. Use as background.\n3. `standalone` (reference): Research from /yolo:research. General reference.\n\nArchitect addresses each critique finding (updates `st` field in critique.jsonl).\n\n## Architect->Lead Stage-Gate (Go/Recycle/Kill)\n\n### Entry Criteria (architecture.toon must contain)\n\nBefore Lead can plan against architecture.toon, it must meet this completeness checklist:\n1. **tech_decisions**: At least one decision with rationale and alternatives\n2. **components**: All requirements mapped to components\n3. **integration_points**: Integration points defined between components\n4. **risks**: Risks identified with impact and mitigation\n5. **critique_disposition**: Every critique finding has a disposition (addressed/deferred/rejected)\n\n### Gate Review\n\nLead validates architecture.toon completeness at Step 4 entry:\n1. Read architecture.toon\n2. Check completeness criteria above\n3. Make gate decision:\n   - **Go**: All criteria met. Proceed to planning.\n   - **Recycle**: Criteria incomplete. Escalate to Architect with specific gaps. Architect reworks and resubmits.\n   - **Kill**: Architecture reveals phase should be deferred. Escalate to Architect -> User for scope decision.\n\n### Feedback Loop\n\nIf Lead discovers architecture.toon incomplete DURING planning (after initial Go):\n1. Lead escalates to Architect via `escalation` schema with specific gaps\n2. Architect addresses gaps, updates architecture.toon\n3. Lead re-validates and continues planning\n4. This does NOT restart the full gate -- it is a targeted rework.\n\n## Handoff Artifact Summary\n\n| Step | From | To | Artifact | Schema |\n|------|------|-----|----------|--------|\n| 1->2 | Critic | Scout (via orchestrator) | critique.jsonl (critical/major only) | See references/artifact-formats.md |\n| 2->3 | Scout | Architect | research.jsonl (append mode) | See references/artifact-formats.md |\n| 3->4 | Architect | Lead | architecture.toon | See references/artifact-formats.md |\n\n## Failure Modes\n\n| Scenario | Handling |\n|----------|----------|\n| Critic has no findings | Skip Scout (Step 2 guard: turbo). Architect proceeds without research. |\n| Scout finds nothing useful | Architect proceeds with available info. Low-confidence entries noted. |\n| Conflicting research sources | Scout reports both. Architect decides in tech_decisions with rationale. |\n| Architecture incomplete at gate | Lead sends Recycle. Architect reworks specific gaps. |\n| Architecture reveals scope problem | Lead sends Kill. Architect escalates to User for scope decision. |\n```\n\n### Verification\n- File exists: `[ -f references/rnd-handoff-protocol.md ]`\n- Contains required sections: grep for 'Pipeline Overview', 'Critic Output', 'Scout Research', 'Architect Consumption', 'Stage-Gate', 'Failure Modes' -- all must match\n- Contains Go/Recycle/Kill: `grep -c 'Go.*Recycle.*Kill\\|Recycle\\|Kill' references/rnd-handoff-protocol.md` returns >= 1\n- Contains completeness checklist: `grep -c 'tech_decisions' references/rnd-handoff-protocol.md` returns >= 1\n\n### Commit\n`docs(03-company-org-alignment-review-patterns): R&D handoff protocol`","ts":""}
{"id":"T2","tp":"auto","a":"Update execute-protocol.md Step 3 exit gate and Step 4 entry gate for stage-gate model. Add Change Management section documenting the Senior<->Dev revision cycle: code review triggers change request, Dev fixes per exact instructions, max 2 cycles before Lead escalation, Minor/Major classification, Phase 4 metric hooks. Add cross-references to company-hierarchy.md Code Review Chain.","f":["references/execute-protocol.md"],"td":["T1"],"v":"execute-protocol.md contains updated gates and Change Management section","done":"Execute protocol updated with stage-gate and change management","spec":"## T2: Update Execute Protocol with Stage-Gate and Change Management\n\n### Context (D3, D4, C5, C7, R5, R6, R7, R10, I2, I3)\nPer D3, update Step 3 exit gate and Step 4 entry gate for stage-gate model. Per D4, add Change Management section with Minor/Major classification and Phase 4 hooks.\n\n### File to Modify\n`references/execute-protocol.md`\n\n### Change 1: Update Step 3 Exit Gate (line ~196)\n\nLocate the current Step 3 EXIT GATE text:\n```\n6. **EXIT GATE:** Artifact: `architecture.toon` (non-empty). State: `steps.architecture = complete`. Commit: `chore(state): architecture complete phase {N}`.\n```\n\nReplace with:\n```\n6. **EXIT GATE:** Artifact: `architecture.toon` (non-empty, meets completeness criteria per references/rnd-handoff-protocol.md ## Architect->Lead Stage-Gate). Completeness: tech_decisions present, components defined, integration_points specified, risks documented, critique_disposition complete. State: `steps.architecture = complete`. Commit: `chore(state): architecture complete phase {N}`.\n```\n\n### Change 2: Update Step 4 Entry Gate (line ~200)\n\nLocate the current Step 4 ENTRY GATE text:\n```\n**ENTRY GATE:** Verify `{phase-dir}/architecture.toon` exists OR `steps.architecture.status` is `\"skipped\"` in `.execution-state.json`. If neither: STOP \"Step 3 artifact missing — architecture.toon not found. Run step 3 first.\"\n```\n\nReplace with:\n```\n**ENTRY GATE:** Verify `{phase-dir}/architecture.toon` exists OR `steps.architecture.status` is `\"skipped\"` in `.execution-state.json`. If neither: STOP \"Step 3 artifact missing — architecture.toon not found. Run step 3 first.\"\n\n**Stage-gate validation (per references/rnd-handoff-protocol.md):** Lead validates architecture.toon completeness:\n1. tech_decisions section exists with at least one decision\n2. components section exists with at least one component\n3. risks section exists\n4. If critique.jsonl exists: all findings have `st` != `\"open\"` (all addressed/deferred/rejected)\n\nGate decision:\n- **Go**: All criteria met. Proceed to planning.\n- **Recycle**: Criteria incomplete. Escalate to Architect with specific gaps via `escalation` schema. STOP until Architect resubmits.\n- **Kill**: Phase should be deferred. Escalate to Architect -> User.\n```\n\n### Change 3: Add Change Management Section\n\nInsert a new `## Change Management` section AFTER the `## Execution State Transitions` section (after line ~607) and BEFORE `## Multi-Department Execution` (line ~611).\n\nAdd:\n```markdown\n## Change Management\n\nFormalizes the Senior-Dev revision cycle and classification system. Referenced by agents/yolo-senior.md and agents/yolo-dev.md.\n\n### Senior-Dev Revision Cycle\n\nWhen Senior's code review requests changes (Step 8):\n1. Senior classifies findings as **Minor** or **Major**:\n   - **Minor**: Nits, style, naming, formatting. Does not affect logic or architecture.\n   - **Major**: Logic errors, missing error handling, architecture violations, security issues.\n2. Senior sends `code_review_changes` to Dev with exact fix instructions.\n3. Dev fixes per instructions precisely -- no creative interpretation.\n4. Dev recommits and Senior re-reviews (cycle 2).\n\n### Cycle Limits and Escalation\n\n- **Cycle 1 (Minor only)**: If ALL findings are Minor (nits), Senior auto-approves after Dev fixes. No cycle 2 needed.\n- **Cycle 1 (Major findings)**: Dev fixes, Senior re-reviews in cycle 2.\n- **Cycle 2 (still failing)**: Senior escalates to Lead via `escalation` schema.\n- **Lead decision**: Accept with known issues (mark as accepted_risk in code-review.jsonl) OR escalate to Architect for design change.\n\n### Collaborative Relationship (per R7)\n\nSenior-Dev relationship is collaborative, not gatekeeping:\n- Senior sends suggestions and exact fix instructions\n- Dev retains decision power within spec boundaries\n- If Dev disagrees with a finding: Dev documents rationale and Senior considers it\n- Senior can override only on Major findings with documented reasoning\n\n### Phase 4 Metric Collection Hooks\n\nThe following metrics are collected at each review cycle for Phase 4 continuous QA instrumentation:\n- `cycle_count`: Number of review cycles for this plan (1 or 2)\n- `finding_severity_distribution`: Count of critical/major/minor/nit findings per cycle\n- `time_per_cycle`: Timestamp delta between code_review_changes sent and Dev recommit\n- `escalation_triggered`: Boolean -- did cycle 2 trigger Lead escalation?\n\nPhase 4 can instrument at these hook points without modifying Phase 3 artifacts. Hooks are observation points (metric recording), not control points (decision gates).\n\nSee @references/company-hierarchy.md ## Code Review Chain for the escalation path.\nSee @references/rnd-handoff-protocol.md for the R&D pipeline handoff.\n```\n\n### Change 4: Update Enforcement Contract Table\n\nIn the `## Execution State Transitions` table, update the Step 3 row's Exit Artifact to reference the completeness criteria:\n\nChange:\n```\n| 3. Architecture | `architecture` | `research.jsonl` OR step 2 skipped | `architecture.toon` | `docs({phase}): architecture design` | architecture.toon exists |\n```\nTo:\n```\n| 3. Architecture | `architecture` | `research.jsonl` OR step 2 skipped | `architecture.toon` (completeness validated per rnd-handoff-protocol.md) | `docs({phase}): architecture design` | architecture.toon exists |\n```\n\n### Verification\n- `grep -c 'completeness criteria' references/execute-protocol.md` returns >= 1\n- `grep -c 'Stage-gate validation' references/execute-protocol.md` returns 1\n- `grep -c '## Change Management' references/execute-protocol.md` returns 1\n- `grep -c 'Minor.*Major' references/execute-protocol.md` returns >= 1\n- `grep -c 'Phase 4 Metric' references/execute-protocol.md` returns >= 1\n- `grep -c 'cycle_count' references/execute-protocol.md` returns >= 1\n\n### Commit\n`docs(03-company-org-alignment-review-patterns): execute protocol stage-gate and change management`","ts":""}
{"id":"T3","tp":"auto","a":"Update references/company-hierarchy.md to cross-reference the new R&D handoff protocol and change management sections (REQ-05). Add R&D Pipeline subsection under Team Structure referencing rnd-handoff-protocol.md. Update Code Review Chain to reference execute-protocol.md Change Management section and add Minor/Major classification. Ensure consistency between the two documents.","f":["references/company-hierarchy.md"],"td":["T2"],"v":"company-hierarchy.md references rnd-handoff-protocol.md and change management","done":"Company hierarchy updated with cross-references","spec":"## T3: Update Company Hierarchy with R&D and Change Management Cross-References\n\n### Context (D3, D4, I3)\nPer D3/D4, update company-hierarchy.md to cross-reference the new protocol docs.\n\n### File to Modify\n`references/company-hierarchy.md`\n\n### Change 1: Add R&D Pipeline Subsection\n\nInsert a new `### R&D Pipeline` subsection inside `## Team Structure` section, AFTER the `### Quality Team` subsection (after line ~36).\n\nAdd:\n```markdown\n### R&D Pipeline\nAgents: Critic, Scout, Architect\nActive during: Critique (Step 1), Research (Step 2), Architecture (Step 3)\nHandoff: critique.jsonl (critical/major) -> Scout research directives -> research.jsonl -> Architect\nStage-gate: Architect->Lead handoff uses Go/Recycle/Kill model. See @references/rnd-handoff-protocol.md.\n```\n\n### Change 2: Update Code Review Chain\n\nLocate the existing Code Review Chain section (around line 100-106):\n```\n### Code Review Chain\n\n```\nSenior: changes_requested → Dev fixes per exact instructions\nCycle 2 fail              → Senior escalates to Lead\nLead decides              → Accept with known issues OR escalate to Architect\n```\n```\n\nReplace with:\n```markdown\n### Code Review Chain\n\n```\nSenior: changes_requested → classify as Minor or Major\nMinor only (nits/style)   → Dev fixes → auto-approve (no cycle 2)\nMajor findings            → Dev fixes → Senior re-reviews (cycle 2)\nCycle 2 fail              → Senior escalates to Lead\nLead decides              → Accept with known issues OR escalate to Architect\n```\n\n**Change classification (per D4):**\n- **Minor**: Nits, style, naming, formatting. Auto-approve after cycle 1 fix if only minor findings.\n- **Major**: Logic errors, missing error handling, architecture violations. Require cycle 2 re-review.\n\n**Collaborative relationship**: Senior sends suggestions; Dev retains decision power within spec. Dev can document rationale for disagreement on findings.\n\n**Phase 4 hooks**: Metric collection points (cycle_count, finding_severity_distribution, time_per_cycle, escalation_triggered) defined for Phase 4 continuous QA instrumentation.\n\nSee @references/execute-protocol.md ## Change Management for full protocol.\n```\n\n### Verification\n- `grep -c 'R&D Pipeline' references/company-hierarchy.md` returns 1\n- `grep -c 'rnd-handoff-protocol.md' references/company-hierarchy.md` returns >= 1\n- `grep -c 'Minor.*Major\\|Minor only' references/company-hierarchy.md` returns >= 1\n- `grep -c 'Phase 4 hooks' references/company-hierarchy.md` returns >= 1\n- `grep -c 'Change Management' references/company-hierarchy.md` returns >= 1\n\n### Commit\n`docs(03-company-org-alignment-review-patterns): company hierarchy R&D and change management`","ts":""}
{"id":"T4","tp":"auto","a":"Update yolo-senior.md and yolo-dev.md to reference the formalized change management loops (REQ-05). Senior Code Review mode should reference the max-cycle escalation rules explicitly with Minor/Major classification. Dev should reference the collaborative revision process. Add Change Management subsection to both agents.","f":["agents/yolo-senior.md","agents/yolo-dev.md"],"td":["T3"],"v":"Both agent files contain change management references","done":"Agent prompts updated with change management references","spec":"## T4: Update Senior and Dev Agent Prompts with Change Management\n\n### Context (D4, I3, R5, R6, R7)\nPer D4, update yolo-senior.md and yolo-dev.md to reference the formalized change management loops.\n\n### File 1: `agents/yolo-senior.md`\n\n#### Change 1: Update Review Cycles Section\n\nLocate the existing `### Review Cycles` section (around line 57-58):\n```\n### Review Cycles\nMax 2 review-fix cycles per plan. If still failing after cycle 2 → escalate to Lead. Approve with nits: mark nits as `sev: \"nit\"`, still approve. TDD failure is a blocking finding (cannot approve with failing tests).\n```\n\nReplace with:\n```markdown\n### Review Cycles\n\nMax 2 review-fix cycles per plan. Classification per @references/execute-protocol.md ## Change Management:\n\n- **Minor findings** (nits, style, naming): If ALL findings are Minor, auto-approve after cycle 1 fix. Mark nits as `sev: \"nit\"`.\n- **Major findings** (logic, error handling, architecture): Require cycle 2 re-review after Dev fixes.\n- **Cycle 2 fail**: Escalate to Lead via `escalation` schema.\n- **TDD failure**: Blocking finding (cannot approve with failing tests), classified as Major.\n\n**Collaborative approach (per R7):** Send suggestions and exact fix instructions. Dev retains decision power within spec boundaries. If Dev disagrees with a finding, consider their documented rationale before overriding.\n\n**Phase 4 metric hooks:** Record cycle_count, finding_severity_distribution, time_per_cycle, escalation_triggered for each review. Phase 4 instruments at these points.\n```\n\n### File 2: `agents/yolo-dev.md`\n\n#### Change 1: Add Change Management Subsection\n\nInsert a new `## Change Management` section AFTER the `## Escalation Table` section (after line ~75) and BEFORE the `## Communication` section (line ~78).\n\nAdd:\n```markdown\n## Change Management\n\nWhen Senior requests changes via `code_review_changes` schema:\n\n1. **Read finding classifications**: Each finding is Minor (nit, style) or Major (logic, error handling).\n2. **Fix per exact instructions**: Follow Senior's fix instructions precisely. No creative interpretation.\n3. **Collaborative revision**: If you disagree with a finding, document your rationale in the commit message. Senior will consider it. But default to following instructions.\n4. **Recommit**: Stage fixes individually, commit with descriptive message referencing the review cycle.\n5. **Cycle limits**: Max 2 cycles. After cycle 2, Senior escalates to Lead -- this is normal process, not a failure.\n\nSee @references/execute-protocol.md ## Change Management for full protocol.\n```\n\n### Verification\n- `grep -c 'Minor findings' agents/yolo-senior.md` returns >= 1\n- `grep -c 'Major findings' agents/yolo-senior.md` returns >= 1\n- `grep -c 'Phase 4 metric' agents/yolo-senior.md` returns >= 1\n- `grep -c '## Change Management' agents/yolo-dev.md` returns 1\n- `grep -c 'Collaborative revision' agents/yolo-dev.md` returns >= 1\n- Both files still have valid frontmatter (first line is `---`)\n\n### Commit\n`docs(03-company-org-alignment-review-patterns): agent change management sections`","ts":""}
