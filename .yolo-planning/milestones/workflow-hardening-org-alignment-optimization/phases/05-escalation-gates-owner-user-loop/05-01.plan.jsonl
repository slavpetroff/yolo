{"p": "05", "n": "01", "t": "Escalation schemas and timeout config", "w": 1, "d": [], "mh": {"tr": ["escalation_resolution schema has type discriminator and required fields", "escalation_timeout config defaults exist in defaults.json"], "ar": [{"f": "references/handoff-schemas.md", "contains": "escalation_resolution"}, {"f": "config/defaults.json", "contains": "escalation_timeout"}], "kl": [{"from": "references/handoff-schemas.md", "to": "agents/yolo-lead.md", "rel": "Lead consumes escalation_resolution to route decisions downward"}, {"from": "config/defaults.json", "to": "references/execute-protocol.md", "rel": "timeout config referenced in escalation handling"}]}, "obj": "Define the missing escalation_resolution handoff schema and escalation timeout configuration so the round-trip has a structured message format and timed fallback", "sk": ["commit"]}
{"id": "T1", "a": "Add escalation_resolution schema to references/handoff-schemas.md. Fields: type=escalation_resolution, original_escalation (ref to escalation that triggered this), decision (user's choice), rationale (why), action_items (array of specific instructions for downstream agents), resolved_by (user|owner|architect). Place after the existing escalation schema section. REQ-09.", "f": ["references/handoff-schemas.md"], "v": "grep -q 'escalation_resolution' references/handoff-schemas.md", "done": "escalation_resolution schema documented with type discriminator, all fields defined, example JSON provided", "tp": "docs", "spec": "File: references/handoff-schemas.md\n\nPlacement: Insert a new ## section IMMEDIATELY AFTER the existing `## \\`escalation\\`` section (which ends at approximately line 242 with the closing ```). Insert BEFORE the `## \\`agent_health_event\\`` section.\n\nAdd the following content (copy exactly, preserving the format pattern of existing schemas):\n\n## `escalation_resolution` (Resolver -> Down the chain)\n\nResolution for a previously-escalated blocker. Flows DOWNWARD only (never upward). Sent by the agent that resolved the escalation (User via go.md, Owner, Architect, or Lead) back down through the chain to unblock the originating agent.\n\n```json\n{\n  \"type\": \"escalation_resolution\",\n  \"original_escalation\": \"ESC-01-02-T3\",\n  \"decision\": \"Use library A with caching layer\",\n  \"rationale\": \"Library A has better long-term support and the caching layer addresses the performance concern\",\n  \"action_items\": [\n    \"Update spec for T3 to use library A import path\",\n    \"Add caching middleware before the API call\",\n    \"Update error handling to cover library A exceptions\"\n  ],\n  \"resolved_by\": \"user\"\n}\n```\n\nField definitions (add as a paragraph below the code block):\n- `original_escalation`: References the `id` field from the escalation entry in .execution-state.json (e.g., \"ESC-01-02-T3\" = phase-plan-task)\n- `decision`: The concrete choice made by the resolver\n- `rationale`: Why this decision was made (for audit trail and downstream understanding)\n- `action_items`: Array of specific instructions that Senior translates into Dev-actionable code_review_changes\n- `resolved_by`: Who made the decision: \"user\" | \"owner\" | \"architect\" | \"lead\"\n- Direction: Always downward (resolver to originator). Never sent upward.\n\nDo NOT modify any existing sections. Do NOT change the --- separator or Cross-Department Schemas section. Only INSERT this new section.", "ts": ""}
{"id": "T2", "a": "Add escalation_timeout_warning schema to references/handoff-schemas.md. This is sent by Lead to Owner/Architect when a blocker has been pending for longer than the configured timeout. Fields: type=escalation_timeout_warning, original_escalation (ref), elapsed_seconds, agent_blocked (who is waiting), recommended_action. REQ-08.", "f": ["references/handoff-schemas.md"], "v": "grep -q 'escalation_timeout_warning' references/handoff-schemas.md", "done": "escalation_timeout_warning schema documented with example JSON", "tp": "docs", "spec": "File: references/handoff-schemas.md\n\nPlacement: Insert a new ## section IMMEDIATELY AFTER the `## \\`escalation_resolution\\`` section added by T1. Insert BEFORE `## \\`agent_health_event\\``.\n\nAdd the following content:\n\n## `escalation_timeout_warning` (Lead -> Architect/Owner)\n\nSent by Lead when an escalation has been pending longer than the configured `escalation.timeout_seconds` (default 300s). Triggers auto-escalation to the next level in the chain.\n\n```json\n{\n  \"type\": \"escalation_timeout_warning\",\n  \"original_escalation\": \"ESC-01-02-T3\",\n  \"elapsed_seconds\": 312,\n  \"current_level\": \"lead\",\n  \"agent_blocked\": \"dev-1 (task 01-02/T3)\",\n  \"recommended_action\": \"Escalate to Architect for design-level decision on library choice\"\n}\n```\n\nField definitions (add as paragraph below code block):\n- `original_escalation`: References the escalation id in .execution-state.json\n- `elapsed_seconds`: Time since `last_escalated_at` in the escalation entry\n- `current_level`: The level where escalation is currently stalled (\"senior\" | \"lead\" | \"architect\")\n- `agent_blocked`: Human-readable description of who is waiting (agent name + task ref)\n- `recommended_action`: What the timeout handler recommends as next step\n\nNote: This schema is produced by check-escalation-timeout.sh (Plan 05-04) and consumed by the orchestrator for auto-escalation routing. The escalation entry's `level` field is updated when auto-escalation fires.\n\nDo NOT modify any existing sections. Only INSERT this new section.", "ts": ""}
{"id": "T3", "a": "Add escalation_timeout section to config/defaults.json under a new escalation key. Fields: escalation.timeout_seconds (default 300 = 5 minutes), escalation.auto_owner_on_timeout (default true -- if timeout fires, auto-involve Owner/go.md), escalation.max_round_trips (default 2 -- max times the same blocker can bounce). REQ-08.", "f": ["config/defaults.json"], "v": "jq '.escalation.timeout_seconds' config/defaults.json | grep -q 300", "done": "escalation config section exists in defaults.json with timeout_seconds=300, auto_owner_on_timeout=true, max_round_trips=2", "tp": "feat", "spec": "File: config/defaults.json\n\nRead the current file first. Add a new top-level key \"escalation\" to the JSON object. Place it AFTER the \"qa_gates\" key (last current key before the closing brace). The new key and its value:\n\n  \"escalation\": {\n    \"timeout_seconds\": 300,\n    \"auto_owner_on_timeout\": true,\n    \"max_round_trips\": 2\n  }\n\nIMPORTANT: Add a comma after the closing brace of the \"qa_gates\" object (if not already present) before adding the \"escalation\" key. The result must be valid JSON (verify with jq).\n\nField semantics:\n- timeout_seconds (300): Seconds before an escalation at one level auto-escalates to the next. Applied per-level, not per-escalation. check-escalation-timeout.sh reads this value.\n- auto_owner_on_timeout (true): When an escalation times out at the Architect level, automatically involve Owner/go.md to present to the user. If false, Architect must manually escalate.\n- max_round_trips (2): Maximum times the same blocker (identified by escalation id) can bounce between levels before forcing resolution at the current level or hard-stopping.\n\nDo NOT change any existing keys. Preserve exact formatting (2-space indent). After edit, verify valid JSON: jq empty config/defaults.json.", "ts": ""}
