{"id":"C1","mode":"post-critic","findings":["04-03 T1 adds qa_gates with 5 fields (post_task, post_plan, post_phase, timeout_seconds, failure_threshold)","04-10 T1 also adds qa_gates with 3 fields only (post_task, post_plan, post_phase)","Schemas conflict: 04-10 simpler version would overwrite 04-03 richer schema","04-10 depends on 04-06/07/08 but NOT 04-03, execution order unpredictable","config/defaults.json already has qa_gates structure to build on"],"recommendation":"Remove config/defaults.json write from 04-10 T1. Make 04-10 depend on 04-03. Let 04-03 T1 be sole source of truth for qa_gates schema in defaults.json."}
{"id":"C2","mode":"post-critic","findings":["decisions.jsonl D3: Explicit decision for separate scripts rather than multi-mode","04-05 T1 proposes --level dispatch to qa-gate.sh (multi-mode approach)","04-06/07 create three separate scripts per decision","Direct contradiction: 04-05 contradicts decisions.jsonl D3 design"],"recommendation":"Remove T2 and T3 from 04-05 (duplicate gate logic). Keep T1 partial (config reading) and T4 (config.md). Three separate scripts from 04-06/07 are canonical per decisions.jsonl D3. Do NOT add --level to hook-registered qa-gate.sh."}
{"id":"C3","mode":"post-critic","findings":["04-06 T1 produces JSON to stdout only, no persistent storage","artifact-formats.md phase directory structure does not define qa-gate result files","04-09 QA agents would read prior post-task gate JSONs but no file path defined","Codebase pattern precedent: .dept-status-{dept}.json shows {operation}-results pattern"],"recommendation":"Define storage path: {phase-dir}/.qa-gate-results.jsonl (append-mode). Update 04-06 T1 to persist results with flock-based serialization. Document in artifact-formats.md."}
{"id":"C4","mode":"post-critic","findings":["test-summary.sh has no --scope/--filter flags to limit tests","04-06 T2 proposes --scope flag but test-summary.sh does not support filtering","Full suite: ~1919 tests across 99 files","No timeout enforcement in test-summary.sh","04-08 protocol integration does not specify --scope usage"],"recommendation":"Add --scope support to test-summary.sh accepting file patterns. Enforce 30-60s timeout in post-task gate. Specify --scope as default in 04-08 Step 7 integration."}
{"id":"C6","mode":"post-critic","findings":["qa-gate.sh registered as Notification hook in hooks.json","hook-wrapper.sh passes stdin only, no CLI arguments","04-05 T1 proposes --level flag but hook system cannot pass it","Three separate scripts from 04-06/07 have no hook registration, can accept flags"],"recommendation":"Keep hook-registered qa-gate.sh unchanged (stdin-only structural check). Use separate scripts from 04-06/07 for workflow gates. Do NOT add --level to qa-gate.sh."}
{"id":"C7","mode":"post-critic","findings":["Teammate mode: up to 5 parallel Devs trigger concurrent post-task gates","No locking mechanism in 04-06 gate result writes","Established pattern: git-commit-serialized.sh uses flock + mkdir fallback with 5 retries","dept-status.sh uses identical flock+mkdir strategy","Concurrent appends to shared result file would corrupt data"],"recommendation":"Adopt flock+mkdir serialization for gate result writes. Either per-task result files or single results file with serialized writes. Reference git-commit-serialized.sh for proven pattern."}
{"id":"C9","mode":"post-critic","findings":["04-03 T5 creates validate-config.sh with no call site","Zero references to validate-config.sh in codebase","session-start.sh reads config but performs no validation","config.md has no validation step on write path","Pattern: validate-plan.sh called in execute-protocol.md Pre-Execution"],"recommendation":"Add call site: session-start.sh after config load with fail-soft behavior (warn only). Alternatively config.md write path or execute-protocol.md Pre-Execution."}
