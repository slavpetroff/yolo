{"id":"C-01","severity":"critical","category":"gap","finding":"No fallback for undetectable project types. detect-stack.sh returns empty for unrecognized projects. Without a default/generic type, generate-department-toons.sh has no input.","recommendation":"Define a 'generic' 7th type in project-types.json. Classification must guarantee exactly one type returned, never null.","st":"addressed"}
{"id":"C-02","severity":"critical","category":"gap","finding":"Backward compatibility unaddressed. 15 agent files hardcode @references/departments/{dept}.toon. Tests assert static file paths. Generated TOONs need clear placement strategy.","recommendation":"Architecture must decide: (a) overwrite static files, (b) new location + compile-context.sh resolution, or (c) update agent references. Most important decision for this phase.","st":"addressed"}
{"id":"C-03","severity":"major","category":"risk","finding":"compile-context.sh (559 lines) never reads department TOON content. Plan 01-03 implies injecting dept protocol into compiled context, expanding scope and risking token budget blowouts (dev=2000, qa=2000).","recommendation":"Measure dept TOON sizes (~400-525 tokens each). Decide: include full content or just @path reference. Recalculate token budgets if including content.","st":"addressed"}
{"id":"C-04","severity":"major","category":"assumption","finding":"6 project types assumed orthogonal. Next.js is both web-app + api-service. Monorepos contain mixed types. No priority rules for disambiguation.","recommendation":"Define explicit priority rules. Monorepo detection first, then mobile > web > api > cli > library for non-monorepos.","st":"addressed"}
{"id":"C-05","severity":"major","category":"gap","finding":"REQ-07 UX mapping requires fundamentally different dept protocols per type. CLI UX (help text, error formatting) shares nothing with web UX (design tokens, wireframes). Template substitution insufficient.","recommendation":"Draft UX conventions for each type explicitly. Consider disabling UX dept for some types rather than force-fitting.","st":"addressed"}
{"id":"C-06","severity":"major","category":"risk","finding":"TOON refresh trigger conditions undefined. When does type change mid-milestone? Committed vs ephemeral TOONs?","recommendation":"Decide: committed or ephemeral. Ephemeral (regenerate in session-start.sh) is simpler and consistent with .ctx-{role}.toon pattern.","st":"addressed"}
{"id":"C-07","severity":"major","category":"gap","finding":"detect-stack.sh has no TYPE classification heuristics. Only detects technologies. Needs new signals: bin/ for CLI, src/lib.rs for library, routes/ for API, ios/ for mobile.","recommendation":"Create project-types.json SEPARATE from stack-mappings.json. Each type has its own 'detect' array with structural patterns.","st":"addressed"}
{"id":"C-08","severity":"major","category":"edge-case","finding":"Monorepo handling underspecified. Multi-type sub-projects with single repo config. No per-workspace concept exists.","recommendation":"For monorepo: detect dominant sub-type or prompt user. Simplest: use dominant type. Don't auto-enable multi-dept.","st":"addressed"}
{"id":"C-09","severity":"minor","category":"edge-case","finding":"YOLO project itself returns minimal from detect-stack.sh. May need 'shell-project' or 'plugin' category.","recommendation":"Run detect-stack.sh on YOLO now as test case. Consider bash-heavy detection patterns.","st":"addressed"}
{"id":"C-10","severity":"minor","category":"improvement","finding":"generate-department-toons.sh and infer-project-context.sh operate on overlapping data. Risk of duplicated detection logic.","recommendation":"Chain: detect-stack.sh -> project_type -> generate-department-toons.sh. Don't re-analyze independently.","st":"addressed"}
{"id":"C-11","severity":"minor","category":"risk","finding":"Performance: TOON generation must fit within session-start.sh <200ms or compile-context.sh budgets.","recommendation":"Cache output. Only regenerate on config change. Add performance test.","st":"addressed"}
{"id":"C-12","severity":"minor","category":"gap","finding":"No TOON schema validation. Generated TOONs with wrong section names would silently fail.","recommendation":"Add BATS test checking required sections (roster, conventions, workflow).","st":"addressed"}
{"id":"C-13","severity":"minor","category":"improvement","finding":"Split TOONs into structural layer (static, project-independent: roster, hierarchy, workflow) and conventions layer (generated, project-specific: focus, testing, tooling).","recommendation":"Structural stays in references/departments/. Conventions generated per type. compile-context.sh merges both.","st":"addressed"}
