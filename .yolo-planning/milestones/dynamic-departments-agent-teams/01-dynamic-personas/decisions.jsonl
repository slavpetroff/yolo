{"ts":"2026-02-16T00:00:00Z","agent":"lead","task":"planning","dec":"Decompose phase into 4 plans across 3 waves","reason":"Wave 1: config + templates can build in parallel (no file overlap). Wave 2: compile-context integration depends on both. Wave 3: end-to-end validation depends on all prior work.","alts":["3 plans (merge config+templates into one large plan)","5 plans (split UX mapping into its own plan)"]}
{"ts":"2026-02-16T00:00:00Z","agent":"lead","task":"planning","dec":"Templates stored in config/department-templates/ not references/departments/","reason":"references/ contains the current static TOONs that serve as defaults. Templates go in config/ because they are configuration-driven inputs to generation, matching the config/ convention for stack-mappings.json and project-types.json.","alts":["templates/ directory","references/templates/"]}
{"ts":"2026-02-16T00:00:00Z","agent":"lead","task":"planning","dec":"Generated TOONs written to .yolo-planning/departments/ not references/departments/","reason":"references/ is committed, version-controlled source of truth for static defaults. Generated TOONs are per-project output, belong in .yolo-planning/ alongside other generated artifacts. This preserves backward compatibility: if generation has not run, compile-context.sh falls back to references/ static files.","alts":["overwrite references/departments/ in place","generate to a temp directory"]}
{"ts":"2026-02-16T00:00:00Z","agent":"lead","task":"planning","dec":"Include refresh mechanism via stack-hash comparison","reason":"01-CONTEXT.md specifies hybrid generation: generate at init, refresh if stack detection changes. Hash comparison avoids unnecessary regeneration while detecting when new frameworks are added to the project.","alts":["always regenerate","timestamp-based staleness check"]}
{"ts":"2026-02-16T00:00:00Z","agent":"architect","task":"architecture","dec":"Two-layer TOON model: static structural + generated conventions (D1, addresses C-02, C-13)","reason":"Static references/departments/*.toon preserved for roster, hierarchy, workflow (structural). Generated .yolo-planning/departments/*.toon contains only conventions/focus sections. compile-context.sh merges both layers. 15 agent @-references unchanged. Zero agent file modifications in Phase 1.","alts":["Overwrite static files in-place","Update 15 agent references to point to generated files","Single generated file replacing static entirely"]}
{"ts":"2026-02-16T00:00:00Z","agent":"architect","task":"architecture","dec":"7th generic type as guaranteed fallback (D2, addresses C-01)","reason":"Classification must never return null. Generic type has score 0 and lowest priority. Any project, even empty, gets valid conventions (minimal, no framework assumptions). Downstream scripts always receive exactly one type.","alts":["Error on undetectable — breaks pipeline","Prompt user — adds interactive dependency"]}
{"ts":"2026-02-16T00:00:00Z","agent":"architect","task":"architecture","dec":"Priority-ordered scoring for type classification (D3, addresses C-04)","reason":"Weighted signal scoring with tie-breaking priority: monorepo > mobile-app > web-app > api-service > cli-tool > library > generic. Handles Next.js (both web-app + api-service) by giving web framework signals higher weight than API route signals.","alts":["First-match ordering — fragile","Return multiple types — downstream expects exactly one","User prompt for ambiguous — adds interactivity"]}
{"ts":"2026-02-16T00:00:00Z","agent":"architect","task":"architecture","dec":"Separate project-types.json from stack-mappings.json (D4, addresses C-07, C-10)","reason":"Type classification uses structural filesystem signals (routes/, src/lib.rs, ios/). Stack detection uses dependency/config signals. Different concerns. detect-stack.sh reads both. generate-department-toons.sh chains from detect-stack.sh output, no duplication.","alts":["Merge into stack-mappings.json — conflates type vs technology","Inline in detect-stack.sh — not extensible by users"]}
{"ts":"2026-02-16T00:00:00Z","agent":"architect","task":"architecture","dec":"UX conventions as full replacement blocks per type (D5, addresses C-05)","reason":"CLI UX (help text, error formatting, man pages) shares no structure with web UX (design tokens, wireframes, responsive breakpoints). Template variable substitution cannot bridge this structural gap. Each type defines a complete ux_conventions block in project-types.json.","alts":["Template variables {{UX_FOCUS}} — insufficient for structural differences","Separate UX template file per type — 6 files, maintenance burden"]}
{"ts":"2026-02-16T00:00:00Z","agent":"architect","task":"architecture","dec":"Generated TOONs ephemeral, not committed (D6, addresses C-06)","reason":"Consistent with .ctx-{role}.toon pattern and artifact-formats.md convention. Refresh via stack-hash comparison. No merge conflicts, no stale committed state. Regenerate on demand or when hash differs.","alts":["Committed — merge conflicts, stale state","Session-start hook — adds latency to every session"]}
{"ts":"2026-02-16T00:00:00Z","agent":"architect","task":"architecture","dec":"Monorepo uses dominant sub-type (D7, addresses C-08)","reason":"Per-workspace TOON generation requires workspace-aware compile-context.sh — too complex for Phase 1. Dominant type (most workspaces of one type) is pragmatic. Full type list stored in output for future use.","alts":["Per-workspace generation — Phase 1 scope exceeded","Prompt user — adds interactivity"]}
{"ts":"2026-02-16T00:00:00Z","agent":"architect","task":"architecture","dec":"Only conventions sections injected into role context, not full TOON (addresses C-03)","reason":"Full dept TOONs are ~400-525 tokens each. Injecting full content into dev (budget 2000) or qa-code (budget 3000) risks blowout. Conventions section alone is ~100-150 tokens. Structural sections (roster, workflow) read by agents via @-reference only when needed.","alts":["Inject full TOON content — budget risk","Path reference only — loses the dynamic benefit of generated conventions"]}
{"ts":"2026-02-16T12:00:00Z","agent":"senior","task":"01-01-01","dec":"Signal weights: framework-specific 7-9, structural 2-5, to ensure framework detection wins over ambiguous directory signals","reason":"A project with both src/lib.rs (library w:8) and routes/ (api-service w:4) should classify as library. Weight differential prevents misclassification from low-confidence structural signals. Addresses R3 from architecture.","alts":["Equal weights with priority-only disambiguation","Binary match/no-match without weights"]}
{"ts":"2026-02-16T12:00:00Z","agent":"senior","task":"01-02-01","dec":"Templates contain ONLY conventions sections, not full TOON structure","reason":"Architecture D1 mandates two-layer model: structural stays in references/departments/*.toon. Templates in config/department-templates/ define only the generated conventions layer. Prevents structural drift between templates and static files (addresses R5).","alts":["Full TOON templates including roster/workflow — creates structural duplication","Inline conventions in project-types.json — reduces readability"]}
{"ts":"2026-02-16T12:00:00Z","agent":"senior","task":"01-02-02","dec":"Use awk for template rendering instead of sed s/// substitution","reason":"Risk R1 identifies special characters in convention values breaking sed substitution. awk gsub() handles slashes, quotes, and pipes safely. Multi-line blocks (UX focus areas) rendered via temp files or heredoc insertion, not sed.","alts":["sed with alternate delimiters (s|pattern|replacement|)","envsubst — not available on all systems without gettext"]}
{"ts":"2026-02-16T12:00:00Z","agent":"senior","task":"01-03-02","dec":"Inject dept_conventions into 4 roles only: dev, senior, tester, qa-code","reason":"These roles do implementation, design review, test authoring, and code QA — all need project-specific technology conventions. Other roles (architect, lead, qa, security, critic) operate at higher abstraction or have tight budgets. Addresses C-03 budget concern.","alts":["Inject into all roles — budget risk for dev (2000) and qa (2000)","Inject into dev only — senior needs conventions for code review"]}
{"ts":"2026-02-16T12:00:00Z","agent":"senior","task":"01-04-03","dec":"Use YOLO-like fixture instead of actual project root for self-tests","reason":"Running generate-department-toons.sh against $PROJECT_ROOT would write to the real .yolo-planning/departments/ directory, polluting the working tree. A fixture with the same directory structure (scripts/, agents/, config/, no package.json) produces identical classification results in isolation.","alts":["Run against actual $PROJECT_ROOT with cleanup — fragile, may affect other tests","Skip self-test entirely — misses C-09 validation"]}
