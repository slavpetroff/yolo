---
phase: 2
plan: 04
title: "Rust Offload Inventory & Schema Fix"
wave: 1
depends_on: []
must_haves:
  - REQ-06
---

# Plan 04: Rust Offload Inventory & Schema Fix

Catalogue all Rust offload candidates found during the audit into a structured findings report, and fix the missing `scout_findings` schema in handoff-schemas.md.

## Task 1: Write RUST-OFFLOAD-CANDIDATES.md findings report

**Description:** Create a comprehensive inventory of all Markdown patterns that should be replaced by Rust CLI commands. Write to `.yolo-planning/phases/02-markdown-token-audit/RUST-OFFLOAD-CANDIDATES.md`.

For each candidate, document:
- **Current location:** File and line range where the pattern exists
- **Pattern:** Brief description of what the inline code does
- **Proposed command:** `yolo <command-name>` with arguments
- **Estimated savings:** Token count reduction (HIGH/MEDIUM/LOW)
- **Priority:** P0 (do first) / P1 (do after P0) / P2 (nice to have)
- **Complexity:** Simple (wrapper) / Medium (logic) / Complex (new subsystem)

Candidates to catalogue (from research findings):

**P0 - Highest Impact:**
1. `yolo update-exec-state` -- Replace 8x execution-state jq update patterns in execute-protocol (inline jq + tmp-mv dance). Subsumes log-event calls.
2. `yolo spawn-params` -- Replace paired `resolve-model` + `resolve-turns` blocks in 7+ files (execute-protocol, debug.md, fix.md, verify spawns). Single call returns model + maxTurns + effort as JSON.
3. Plugin root resolution -- Replace 118-char shell expression (`${CLAUDE_PLUGIN_ROOT:-$(ls -1d ...)}`) in 17/23 command files with `yolo plugin-root` or env var guarantee.

**P1 - High Impact:**
4. `yolo config-set` -- Replace 8x jq-tmp-mv config update pattern in config.md.
5. `yolo diff-findings` -- Replace delta findings jq in execute-protocol L135-156 (review loop).
6. `yolo size-codebase` -- Replace codebase size + tier selection logic in map.md.
7. `yolo detect-scenario` -- Replace scenario detection logic in init.md Step 5.
8. `yolo estimate-cost` -- Replace model cost calculation (2x) in config.md.
9. `yolo config-list-flags` -- Replace feature flags listing in config.md.

**P2 - Medium Impact:**
10. `yolo status-economy` -- Replace status.md multi-jq reads with single structured output.
11. `yolo release-audit` -- Replace release.md pre-release checklist queries.

**Files:** `.yolo-planning/phases/02-markdown-token-audit/RUST-OFFLOAD-CANDIDATES.md` (NEW)

**Commit:** `docs(2-04): write Rust offload candidates inventory`

**Verification:** File exists with all 11 candidates. Each has location, pattern, proposed command, savings, priority, complexity fields.

## Task 2: Add missing scout_findings schema to handoff-schemas.md

**Description:** The `scout_findings` message type is referenced in execute-protocol Step 3 teammate communication table (L474: "findings (scout_findings)") but has no schema definition in `references/handoff-schemas.md`. Add the missing schema.

The `scout_findings` payload should follow the existing schema patterns:
```json
{
  "topic": "Research topic or question",
  "findings": [
    {
      "source": "URL or file path",
      "insight": "Key finding text",
      "confidence": "high|medium|low"
    }
  ],
  "recommendations": ["Actionable next step 1", "Actionable next step 2"]
}
```

Add it after the `approval_response` schema, before the `shutdown_request` schema. Also add `scout_findings` to the Role Authorization Matrix table with: Allowed Senders = `scout`, Typical Receivers = `lead, architect`.

**Files:** `references/handoff-schemas.md`

**Commit:** `fix(2-04): add missing scout_findings schema to handoff-schemas.md`

**Verification:** `grep 'scout_findings' references/handoff-schemas.md` returns matches. Schema has envelope type, payload fields, and Role Authorization Matrix entry.
