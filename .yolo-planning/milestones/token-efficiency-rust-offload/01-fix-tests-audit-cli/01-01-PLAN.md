---
phase: 1
plan: 1
title: "Fix 3 failing bats tests"
wave: 1
depends_on: []
must_haves:
  - "All 728+ tests pass (0 failures)"
---

# Plan 1: Fix 3 Failing Bats Tests

## Task 1: Fix validate-commit.bats Bash-tool assertions (tests #1 and #2)

**Files:** `tests/validate-commit.bats`

**Action:** The two Bash-tool tests assert `exit 2` + `"cannot extract file path"`, but the Rust security_filter explicitly skips Bash tools (`security_filter.rs:23`: `if tool_name == "Bash" { return Ok(HookOutput::empty()); }`), returning exit 0 with empty stdout. Update both tests:
- Test "PreToolUse blocks Bash tool input (commit commands included)" (line 15): change `[ "$status" -eq 2 ]` to `[ "$status" -eq 0 ]` and change the output assertion to `[[ "$output" != *"permissionDecision"* ]]` (no deny payload).
- Test "PreToolUse blocks Bash tool input for non-commit commands" (line 21): same fix â€” assert exit 0 and no deny payload.
- Update test names to reflect pass-through behavior (e.g., "PreToolUse passes Bash tool through (no file path validation)").

**Acceptance:** `bats tests/validate-commit.bats` passes all 4 tests with 0 failures.

## Task 2: Fix vibe-mode-split.bats frontmatter assertion (test #6)

**Files:** `commands/vibe.md`

**Action:** Test "vibe-mode-split: router contains frontmatter with yolo:vibe" (line 57) does `head -8 "$VIBE_ROUTER" | grep -q "name: yolo:vibe"` but `commands/vibe.md` frontmatter lacks the `name` field. Add `name: yolo:vibe` to the YAML frontmatter block (after the `---` opener, before `description`).

**Acceptance:** `bats tests/vibe-mode-split.bats` passes all 9 tests with 0 failures.

## Task 3: Run full test suite and confirm green

**Files:** none (verification only)

**Action:** Run the full bats suite: `bats tests/unit/ tests/static/ tests/containment/ tests/integration/ tests/perf/` (avoid `--recursive` per conventions). Confirm 728+ tests, 0 failures.

**Acceptance:** Full suite green. If any other tests fail, fix them in this task (scope: test-only changes, no new features).
