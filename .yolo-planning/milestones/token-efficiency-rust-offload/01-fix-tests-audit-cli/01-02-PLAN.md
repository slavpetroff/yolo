---
phase: 1
plan: 2
title: "Audit Rust CLI vs MD-side deterministic operations"
wave: 1
depends_on: []
must_haves:
  - "Every deterministic operation mapped to Rust command or flagged as needs-new-command"
---

# Plan 2: Audit Rust CLI vs MD-Side Deterministic Operations

## Task 1: Inventory all Rust CLI commands and their flags

**Files:** `yolo-mcp-server/src/cli/router.rs`, `yolo-mcp-server/src/commands/*.rs`

**Action:** Extract from `router.rs` the complete list of 59 CLI subcommands. For each, document: command name, accepted arguments/flags, what it computes. Use the `from_arg` match arms and `execute` function signatures. Output a structured table in the audit document.

**Acceptance:** Table covers all 59 commands with args and purpose.

## Task 2: Inventory all MD-side deterministic operations

**Files:** `commands/*.md` (23 files), `skills/vibe-modes/*.md`, `skills/execute-protocol/SKILL.md`

**Action:** Scan every markdown command file for inline deterministic operations: shell backticks (`` `!`...`` ``), arithmetic, glob counting, git commands, jq/sed/grep pipelines, path resolution, frontmatter extraction. For each, document: which MD file, what operation, whether it is purely deterministic (no LLM needed). Cross-reference against the research findings (6 known gaps).

**Acceptance:** Every inline deterministic operation catalogued with source file and line reference.

## Task 3: Produce gap analysis audit document

**Files:** `.yolo-planning/milestones/token-efficiency-rust-offload/01-fix-tests-audit-cli/01-AUDIT.md` (new)

**Action:** Combine Tasks 1 and 2 into a single audit document with three sections:
1. **Covered**: Deterministic operations that already have a Rust CLI equivalent (command name + flags).
2. **Needs Enhancement**: Existing Rust commands that need new flags to cover MD-side operations (e.g., `resolve-model --with-cost`, `phase-detect --suggest-route`, `detect-stack --brownfield`).
3. **Needs New Command**: Deterministic operations with no Rust equivalent at all (e.g., cost calculation, brownfield detection, git state checks, plugin root resolution, frontmatter extraction).

Each entry in sections 2 and 3 should include: operation description, source MD file, estimated complexity (S/M/L), and suggested Rust command/flag name.

**Acceptance:** Audit document exists with all three sections populated. Every deterministic operation from Task 2 appears in exactly one section.
