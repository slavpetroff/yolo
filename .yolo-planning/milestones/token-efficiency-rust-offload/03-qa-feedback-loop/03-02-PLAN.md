---
phase: "03"
plan: "02"
title: "Update QA agent protocol with Remediation Classification"
wave: 1
depends_on: []
must_haves:
  - "QA agent has Remediation Classification section mapping commands to fixable_by categories"
  - "QA report format includes failed_checks[].fixable_by field"
  - "QA agent documents scoped remediation output for Dev consumption"
  - "Cache efficiency notes for execution Tier 2 sharing"
---
# Plan 03-02: QA agent protocol update

## Context
The QA agent (`agents/yolo-qa.md`) needs protocol additions to participate in the automated
QA feedback loop. It needs a Remediation Classification section that maps command failures to
fixable_by categories, and an updated report format that the loop orchestration can parse.

## Tasks

### Task 1: Add Remediation Classification section to QA agent
Read `agents/yolo-qa.md`. Add a new `## Remediation Classification` section after the existing
Report Format section:

```markdown
## Remediation Classification

After running verification commands, classify each failure for loop routing:

| Command | Failure Type | fixable_by | Remediation |
|---------|-------------|------------|-------------|
| commit-lint | Format violation | dev | Dev rewrites commit message |
| diff-against-plan | Undeclared/missing files | dev | Dev updates SUMMARY.md files_modified |
| verify-plan-completion | Missing frontmatter/sections | dev | Dev fixes SUMMARY.md structure |
| verify-plan-completion | Task count mismatch | architect | Plan needs revision — HARD STOP |
| validate-requirements | Unverified must_have | dev | Dev adds evidence to SUMMARY.md |
| check-regression | Test count change | manual | Human review required — HARD STOP |

**Routing rules:**
- If ANY check returns `fixable_by: "architect"` → report HARD STOP (plan-level issue)
- If ANY check returns `fixable_by: "manual"` → report HARD STOP (human intervention)
- If ALL failures are `fixable_by: "dev"` → report remediation-eligible

The `fixable_by` field comes directly from each Rust command's JSON output — the QA agent
reads it, does not compute it.
```

**File:** `agents/yolo-qa.md`
**Commit:** `feat(03-02): add Remediation Classification to QA agent`

### Task 2: Update QA report format for loop consumption
In `agents/yolo-qa.md`, update the Report Format section to include structured failure data:

Update the report to include `fixable_by` per check and a `remediation_eligible` boolean:

```markdown
## Report Format

```
QA REPORT:
passed: true|false
remediation_eligible: true|false
checks:
- name: verify-plan-completion | status: pass | fixable_by: none
- name: commit-lint | status: fail | fixable_by: dev | detail: "2 violations"
- name: diff-against-plan | status: pass | fixable_by: none
- name: validate-requirements | status: fail | fixable_by: dev | detail: "1 unverified"
- name: check-regression | status: pass | fixable_by: manual
hard_stop_reasons: []
dev_fixable_failures:
- cmd: commit-lint | detail: "Hash abc123: missing type prefix" | suggested_fix: "feat(scope): description"
- cmd: validate-requirements | detail: "Unverified: thing works" | suggested_fix: "Add evidence to SUMMARY"
```

- `remediation_eligible: true` when all failures are dev-fixable
- `hard_stop_reasons` lists architect/manual failures that block auto-remediation
- `dev_fixable_failures` provides scoped context for Dev subagent
```

**File:** `agents/yolo-qa.md`
**Commit:** `feat(03-02): update QA report format for feedback loop consumption`

### Task 3: Add cache efficiency notes and loop behavior documentation
Add to `agents/yolo-qa.md`:

```markdown
## Feedback Loop Behavior

When invoked in a QA feedback loop (cycle > 1):

1. **Delta re-run:** Only re-run checks that failed in the previous cycle
   - Skip checks that already passed (they won't regress from Dev's scoped fixes)
   - This reduces token cost and API calls per loop iteration
2. **Report delta:** Compare current failures against previous cycle
   - Note which failures were RESOLVED by Dev's fixes
   - Flag any NEW failures introduced by Dev's remediation commits
3. **Cache efficiency:** QA and Dev share "execution" Tier 2 cache
   - Cache stays warm between loop iterations (no recompilation)
   - Only re-read changed files (SUMMARY.md, commit log)
```

**File:** `agents/yolo-qa.md`
**Commit:** `feat(03-02): add feedback loop behavior and cache notes to QA agent`

### Task 4: Verify consistency with Step 3d and cross-references
Review the updated QA agent against execute-protocol Step 3d:
- QA report format matches what Step 3d loop logic expects to parse
- fixable_by categories consistent between QA agent classification table and Rust command outputs
- Dev remediation context fields match what Step 3d generates for Dev subagent
- Verify QA agent is in "execution" family in `config/model-profiles.json`

No file changes expected — verification only. Fix if inconsistencies found.

**File:** cross-reference verification (agents/yolo-qa.md, skills/execute-protocol/SKILL.md, config/model-profiles.json)
**Commit:** `fix(03-02): resolve QA loop consistency issues` (only if fixes needed)
