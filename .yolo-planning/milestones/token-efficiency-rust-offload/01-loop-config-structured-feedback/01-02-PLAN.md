---
phase: "01"
plan: "02"
title: "Add fixable_by classification to all QA commands and bats tests"
wave: 1
depends_on: []
must_haves:
  - "All 5 QA commands include fixable_by field in failure outputs"
  - "fixable_by values are dev, architect, or manual"
  - "Bats tests verify fixable_by field presence"
  - "All existing tests pass"
---

# Plan 02: Add fixable_by Classification to QA Commands and Bats Tests

## Goal

Enhance all 5 QA verification commands to include a `fixable_by` field ("dev"|"architect"|"manual") in their failure outputs, enabling the QA feedback loop to automatically route remediation. Add bats tests for the new fields.

## Tasks

### Task 1: Add fixable_by to verify_plan_completion.rs and commit_lint.rs

**Files:** `yolo-mcp-server/src/commands/verify_plan_completion.rs`, `yolo-mcp-server/src/commands/commit_lint.rs`

**Read both files first.**

**verify_plan_completion.rs:** For each `checks.push(json!({...}))` where status is "fail", add `fixable_by`:
- `frontmatter_fields` fail → `"fixable_by": "dev"` (Dev can update SUMMARY.md)
- `task_count_match` fail → `"fixable_by": "architect"` (plan needs revision)
- `completion_match` fail → `"fixable_by": "dev"` (Dev can complete remaining tasks)
- `commit_hashes` fail → `"fixable_by": "dev"` (Dev can add proper commit hashes)
- `body_sections` fail → `"fixable_by": "dev"` (Dev can add missing sections to SUMMARY)

For "pass" status checks, add `"fixable_by": "none"`.

**commit_lint.rs:** For each violation in the violations array, add:
- `"fixable_by": "dev"` (Dev can amend commit messages)
- `"suggested_fix": format!("Rewrite as: {{type}}({{scope}}): {{description}}")`

**Verification:** `cargo build` succeeds.

### Task 2: Add fixable_by to check_regression.rs and diff_against_plan.rs

**Files:** `yolo-mcp-server/src/commands/check_regression.rs`, `yolo-mcp-server/src/commands/diff_against_plan.rs`

**Read both files first.**

**check_regression.rs:** This command currently always returns `ok: true`. Add a `fixable_by` field to the top-level response:
- `"fixable_by": "manual"` — regression analysis requires human judgment
- If regression count > 0: also add `"regression_note": "Test count decreased — verify intentional"`

**diff_against_plan.rs:** Add `fixable_by` to the response when there are undeclared or missing files:
- `undeclared` files (in git but not in SUMMARY) → `"fixable_by": "dev"` (Dev updates SUMMARY.md)
- `missing` files (in SUMMARY but not in git) → `"fixable_by": "dev"` (Dev commits missing files or updates SUMMARY)
- When ok=true: `"fixable_by": "none"`

**Verification:** `cargo build` succeeds.

### Task 3: Add fixable_by to validate_requirements.rs

**Files:** `yolo-mcp-server/src/commands/validate_requirements.rs`

**Read the file first.** For each requirement in the requirements array:
- `status: "verified"` → `"fixable_by": "none"`
- `status: "unverified"` → `"fixable_by": "dev"` (Dev can add evidence to SUMMARY or ensure code includes the requirement)

Also add a top-level `fixable_by` field:
- If all verified: `"fixable_by": "none"`
- If some unverified: `"fixable_by": "dev"`

**Verification:** `cargo build` succeeds.

### Task 4: Update unit tests and add bats tests for fixable_by

**Files:** Inline tests in each command file, `tests/qa-commands.bats`

**Inline Rust tests:** For each command's existing tests, verify the output includes `fixable_by` field with expected values.

**Bats tests (qa-commands.bats):** Update existing tests to check for fixable_by:
1. `verify-plan-completion passes for valid summary` — check `fixable_by` is "none" on pass
2. `verify-plan-completion fails for missing fields` — check output contains `fixable_by`
3. `validate-requirements checks must_haves` — check requirements array items have `fixable_by`
4. `check-regression reports test counts` — check `fixable_by` field exists

**Verification:** `cargo test -p yolo-mcp-server` passes. `bats tests/qa-commands.bats` passes.

### Task 5: Build, install, and commit

**Actions:**
1. `cargo build --release` from `yolo-mcp-server/`
2. `cp target/release/yolo "$HOME/.cargo/bin/yolo"`
3. Run `bats tests/qa-commands.bats` to verify

**Commits:**
- `feat(01-02): add fixable_by to verify-plan-completion and commit-lint`
- `feat(01-02): add fixable_by to check-regression and diff-against-plan`
- `feat(01-02): add fixable_by to validate-requirements`
- `test(01-02): update bats and unit tests for fixable_by fields`
