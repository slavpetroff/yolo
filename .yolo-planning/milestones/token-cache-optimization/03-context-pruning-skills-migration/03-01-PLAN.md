---
phase: 3
plan: 01
title: Create skill infrastructure and migrate execute-protocol
wave: 1
depends_on: []
must_haves:
  - skills/ directory with SKILL.md template structure
  - execute-protocol migrated from references/ to skills/execute-protocol/SKILL.md
  - vibe.md Execute mode updated to reference skill instead of direct file read
  - compile-context skill bundling path resolves project-local skills/ directory
---

# Plan 01: Create Skill Infrastructure and Migrate Execute-Protocol

## Background

The project has `skills_used` in PLAN.md frontmatter and compile-context already supports skill bundling from `~/.claude/skills/`. However, no project-local skills exist. Protocol references like execute-protocol.md (547 lines) are always-available via `references/` but only loaded on-demand by specific commands. Moving them to skills makes them load only when needed, reducing baseline context.

The execute-protocol is the single largest reference file (547 lines) and is only used by vibe.md Execute mode. It is the highest-value migration target.

## Tasks

### Task 1: Create skills directory structure

**Description:** Create `skills/` directory at project root with a README explaining the skills convention. Create `skills/execute-protocol/` subdirectory.

**Files:**
- `skills/execute-protocol/` (new directory)

**Acceptance criteria:**
- `skills/execute-protocol/` directory exists
- Structure follows Claude Code skills convention (SKILL.md as the entry point)

### Task 2: Migrate execute-protocol.md to skill

**Description:** Move `references/execute-protocol.md` content into `skills/execute-protocol/SKILL.md` with proper SKILL.md frontmatter. The frontmatter should include: name, description, and any metadata needed for compile-context to bundle it. Keep the original `references/execute-protocol.md` as a thin redirect that says "This protocol has been migrated to `skills/execute-protocol/SKILL.md`" so any existing `@` references or Read calls get redirected.

**Files:**
- `skills/execute-protocol/SKILL.md` (new)
- `references/execute-protocol.md` (modify to redirect stub)

**Acceptance criteria:**
- `skills/execute-protocol/SKILL.md` contains full protocol content with SKILL.md frontmatter
- `references/execute-protocol.md` is a 3-5 line redirect stub
- No content loss from the migration

### Task 3: Update vibe.md Execute mode to use skill path

**Description:** In `commands/vibe.md`, the Execute mode section says `Read ${CLAUDE_PLUGIN_ROOT}/references/execute-protocol.md and follow its instructions.` Update this to read from the new skill location: `Read ${CLAUDE_PLUGIN_ROOT}/skills/execute-protocol/SKILL.md`. Also update the references in the execute-protocol section that mention the old path.

**Files:**
- `commands/vibe.md` (modify Execute mode section)

**Acceptance criteria:**
- vibe.md Execute mode references `skills/execute-protocol/SKILL.md` instead of `references/execute-protocol.md`
- No other vibe.md sections affected
- Protocol is still loaded on-demand (only in Execute mode)

### Task 4: Update compile-context to resolve project-local skills

**Description:** The execute-protocol references say compile-context reads `skills_used` from plan frontmatter and bundles SKILL.md content. Currently this resolves from `~/.claude/skills/`. Update the execute-protocol SKILL.md documentation (the "skill bundling" paragraph) to also document resolution from `${CLAUDE_PLUGIN_ROOT}/skills/{name}/SKILL.md` as a project-local skill path. This ensures plans with `skills_used: [execute-protocol]` can resolve the project-local skill.

**Files:**
- `skills/execute-protocol/SKILL.md` (update skill bundling paragraph if it contains resolution docs)

**Acceptance criteria:**
- Skill resolution path documented: project-local `skills/` checked before global `~/.claude/skills/`
- SKILL.md skill bundling paragraph updated to reflect both resolution paths
