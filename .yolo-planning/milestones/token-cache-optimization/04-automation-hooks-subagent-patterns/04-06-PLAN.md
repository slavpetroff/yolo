---
phase: 4
plan: 06
title: "Subagent patterns documentation and full suite verification"
wave: 2
depends_on: [01, 02, 03, 04]
must_haves:
  - Agent definitions updated with subagent isolation guidelines
  - Research/map/discuss commands documented to use subagents
  - Full test suite passes (685+ tests, 0 failures)
  - ROADMAP.md Phase 4 marked complete
---

# Plan 06: Subagent Patterns Documentation and Final Verification

## Background

Phase 4 requires documenting subagent isolation patterns — when to use subagents vs inline processing, how research operations should protect the main context window. The current agent definitions (`agents/yolo-*.md`) have no subagent guidance.

Additionally, this plan runs the full test suite to verify all repairs from plans 01-04 and new tests from plan 05 pass together.

## Tasks

### Task 1: Document subagent isolation patterns in agent definitions

**Description:** Add a "## Subagent Usage" section to each agent definition that needs it:

- `agents/yolo-lead.md`: Document that Lead should use Task tool (subagent) for research operations (codebase mapping, dependency analysis) to protect planning context. Inline processing preferred for plan writing (needs full context).
- `agents/yolo-dev.md`: Document that Dev should use MCP tools (run_test_suite) inline, not spawn sub-agents. Research is done before Dev is spawned (by Lead/Architect).
- `agents/yolo-architect.md`: Document that Architect should use subagents for deep codebase exploration (Explore subagent) but keep design decisions in main context.
- `agents/yolo-debugger.md`: Document inline debugging preferred (needs full error context). Subagents only for searching distant codepaths.

Pattern guidance for all agents:
- **Use subagent when:** Research exceeds 3 queries, exploring unfamiliar code areas, codebase mapping
- **Use inline when:** Direct file modifications, test execution, plan writing, commit operations
- **Context protection rule:** Never load more than 2 full file reads in main context during research — delegate to subagent

**Files:**
- `agents/yolo-lead.md`
- `agents/yolo-dev.md`
- `agents/yolo-architect.md`
- `agents/yolo-debugger.md`

**Acceptance criteria:**
- Each agent has a "## Subagent Usage" section with clear guidance
- Guidance is specific to the agent's role (not generic copy-paste)
- No existing sections removed or modified

### Task 2: Update commands that should use subagents

**Description:** Update command definitions to indicate subagent usage:

- `commands/vibe.md` Research mode: Add note that research operations use Task tool with Explore subagent
- `commands/vibe.md` Map/Discuss modes: Add note about subagent isolation for codebase exploration

This is documentation/instruction changes in the command markdown files, not code changes.

**Files:**
- `commands/vibe.md`

**Acceptance criteria:**
- Research mode references subagent usage for deep exploration
- Map/Discuss modes reference subagent isolation
- Execute mode unchanged (Dev agents run inline)

### Task 3: Run full test suite and fix any remaining failures

**Description:** Run `bats tests/` and verify 0 failures across all test files. If any tests still fail after plans 01-04 are complete:
1. Categorize the failures
2. Fix inline (this is the cleanup pass)
3. Document any tests that were intentionally removed or skipped with reasons

Expected: 685+ tests (569 repaired + 116 already passing + ~10 new from plan 05).

**Files:**
- Any test files with remaining failures

**Acceptance criteria:**
- `bats tests/` exits 0
- All test files report 0 failures
- No tests skipped without documented reason

### Task 4: Update ROADMAP.md and write phase summary

**Description:** Mark Phase 4 as complete in ROADMAP.md. Write `04-SUMMARY.md` for the phase directory with:
- Test repair stats (how many tests fixed, root causes)
- New hooks added
- Subagent patterns documented
- Any deviations from the plan

**Files:**
- `.yolo-planning/ROADMAP.md`
- `.yolo-planning/phases/04-automation-hooks-subagent-patterns/04-SUMMARY.md`

**Acceptance criteria:**
- ROADMAP Phase 4 row shows Complete with correct plan/task/commit counts
- Summary captures key metrics and decisions
