{"p":"02-02","n":"Hook Adaptations for Team-Aware Tracking","t":4,"w":1,"d":[],"mh":{"tr":["agent-start.sh tracks team membership alongside agent name","validate-dept-spawn.sh validates team context (not just agent name)","validate-send-message.sh permits intra-team messages and cross-team Lead-to-Lead","Hooks degrade gracefully when team context is absent (backward compat)"],"ar":[{"p":"scripts/agent-start.sh","pv":"New version writes .active-agent with team_id field when team context available","c":"Writes JSON {agent, team_id, dept} to .active-agent when in team mode"},{"p":"scripts/validate-send-message.sh","pv":"Permits Lead-to-Lead cross-department SendMessage without warning","c":"Updated communication rules for team coordination"},{"p":"hooks/hooks.json","pv":"jq '.hooks.PostToolUse | length' hooks/hooks.json returns updated count","c":"hooks.json updated with TeamStart/TeamStop if applicable"}],"kl":[{"fr":"scripts/agent-start.sh","to":"scripts/validate-send-message.sh","vi":"validate-send-message reads .active-agent written by agent-start to determine team context"},{"fr":"hooks/hooks.json","to":"scripts/agent-start.sh","vi":"hooks.json routes SubagentStart to agent-start.sh"}]},"obj":"Update existing hooks (agent-start, agent-stop, validate-dept-spawn, validate-send-message) to be team-aware while maintaining backward compatibility with single-agent Task tool spawning.","sk":["commit"],"fm":["scripts/agent-start.sh","scripts/agent-stop.sh","scripts/validate-dept-spawn.sh","scripts/validate-send-message.sh","hooks/hooks.json","tests/unit/agent-start-teams.bats","tests/unit/validate-send-message-teams.bats"]}
{"id":"02-02-01","n":"Update agent-start.sh for team-aware tracking","f":["scripts/agent-start.sh","scripts/agent-stop.sh"],"d":[],"ac":["agent-start.sh writes JSON to .active-agent when team context is available in input","JSON format: {agent: 'yolo-dev', team_id: 'T1', dept: 'backend'}","Falls back to plain text agent name when no team context (backward compat)","agent-stop.sh clears .active-agent (unchanged behavior)","Both scripts remain fail-open (exit 0 always)"]}
{"id":"02-02-02","n":"Update validate-dept-spawn.sh for team validation","f":["scripts/validate-dept-spawn.sh"],"d":["02-02-01"],"ac":["validate-dept-spawn.sh reads team context from SubagentStart input when available","Warns when agent spawned outside its department team","Permits agents spawned as part of a valid team (team_id present and matches department)","Falls back to name-based validation when no team context (backward compat)","Still cannot block (SubagentStart is observe-only) -- warnings only"]}
{"id":"02-02-03","n":"Update validate-send-message.sh for team coordination","f":["scripts/validate-send-message.sh"],"d":["02-02-01"],"ac":["validate-send-message.sh allows Lead-to-Lead direct messages for handoff coordination","New rule: if sender is a Lead and recipient is a Lead, allow cross-department (handoff pattern)","New rule: if message type is shutdown_request or shutdown_response, allow any direction","Reads .active-agent JSON for team context when available","Falls back to plain-text .active-agent parsing (backward compat)","hooks/hooks.json updated if any new matchers needed"]}
{"id":"02-02-04","n":"Write team-aware hook tests","f":["tests/unit/agent-start-teams.bats","tests/unit/validate-send-message-teams.bats"],"d":["02-02-01","02-02-02","02-02-03"],"ac":["tests/unit/agent-start-teams.bats has minimum 6 tests","Tests cover: team context writes JSON, no team context writes plain text, agent-stop clears file, JSON parsing by downstream scripts, invalid input graceful degradation, non-yolo agent skip","tests/unit/validate-send-message-teams.bats has minimum 8 tests","Tests cover: Lead-to-Lead cross-dept allowed, shutdown messages allowed, intra-team allowed, cross-dept non-lead warned, backward compat (plain text .active-agent), owner-to-lead allowed, same-dept still allowed, shared agent still allowed","All tests pass with bats"]}
