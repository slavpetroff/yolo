{"p":"02-02","n":"Hook and State Adaptations","t":3,"w":1,"d":[],"mh":{"tr":["agent-start.sh writes .dept-status-{dept}.json via dept-status.sh when a department Lead starts","agent-start.sh detects department from agent_type prefix (fe-=frontend, ux-=uiux, no prefix=backend)","state-updater.sh writes .phase-orchestration.json alongside .execution-state.json when multi_dept=true","Single-dept mode (no dept prefix) has zero behavioral change in both hooks"],"ar":[{"p":"scripts/agent-start.sh","pv":"echo '{\"agent_type\":\"yolo-fe-lead\"}' | bash scripts/agent-start.sh creates .dept-status-frontend.json in planning dir","c":"Department Lead detection triggers status file creation via dept-status.sh"},{"p":"scripts/state-updater.sh","pv":"When .phase-orchestration.json exists, state-updater updates department step progress in it","c":"Multi-dept state tracking alongside existing .execution-state.json updates"}],"kl":[{"fr":"scripts/agent-start.sh","to":"scripts/dept-status.sh","vi":"agent-start calls dept-status.sh --action write when dept Lead detected"},{"fr":"scripts/state-updater.sh","to":".phase-orchestration.json","vi":"state-updater writes per-department progress to orchestration file when multi_dept=true"}]},"obj":"Adapt 2 existing hooks (agent-start.sh, state-updater.sh) to support multi-department tracking while preserving backward compatibility for single-department mode.","sk":["commit"],"fm":["scripts/agent-start.sh","scripts/state-updater.sh","tests/unit/agent-start.bats","tests/unit/state-updater.bats"]}
{"id":"02-02-01","n":"Update agent-start.sh for department status tracking","f":["scripts/agent-start.sh"],"d":[],"ac":["agent-start.sh detects department from agent_type prefix: yolo-fe-* -> frontend, yolo-ux-* -> uiux, yolo-{lead|architect|senior|dev|tester|qa|qa-code} -> backend","When agent_type is a department Lead (yolo-lead, yolo-fe-lead, yolo-ux-lead): calls dept-status.sh to write initial status","dept-status.sh called with: --dept {detected_dept} --phase-dir {active_phase_dir} --action write --status running --step planning","Phase dir resolved from .execution-state.json or latest phase directory","Non-Lead agents (yolo-dev, yolo-senior etc) do NOT trigger dept-status writes","Existing .active-agent write behavior unchanged","Graceful degradation: if dept-status.sh not found or fails, exit 0 (fail-open)","Still exit 0 always (SubagentStart hook is observe-only)"]}
{"id":"02-02-02","n":"Update state-updater.sh for multi-dept orchestration state","f":["scripts/state-updater.sh"],"d":[],"ac":["state-updater.sh checks for .phase-orchestration.json existence in phase dir","When .phase-orchestration.json exists: updates department status and step on summary/plan writes","On summary write: updates departments.{dept}.status and departments.{dept}.step in .phase-orchestration.json","Department detected from plan file prefix (fe-* -> frontend, ux-* -> uiux, standard -> backend)","Gate status updates: when all departments show complete, updates gates.all-depts.status to passed","When .phase-orchestration.json does NOT exist: zero change to existing behavior","Uses jq for all JSON manipulation","Existing .execution-state.json, STATE.md, ROADMAP.md, state.json updates unchanged","Backward compatible: single-dept projects never have .phase-orchestration.json so hit no new code paths"]}
{"id":"02-02-03","n":"Write hook adaptation tests","f":["tests/unit/agent-start.bats","tests/unit/state-updater.bats"],"d":["02-02-01","02-02-02"],"ac":["tests/unit/agent-start.bats extended with minimum 5 new tests for dept tracking: fe-lead triggers frontend dept-status, ux-lead triggers uiux dept-status, lead triggers backend dept-status, non-lead agents skip dept-status, missing dept-status.sh degrades gracefully","tests/unit/state-updater.bats extended with minimum 4 new tests for multi-dept: summary write updates .phase-orchestration.json department step, all depts complete triggers gate update, missing .phase-orchestration.json has no effect, existing .execution-state.json update still works","New tests coexist with existing tests (extend the file, do not replace)","All tests pass with bats including pre-existing tests"]}
