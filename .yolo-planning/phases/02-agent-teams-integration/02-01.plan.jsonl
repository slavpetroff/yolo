{"p":"02-01","n":"Department Coordination Scripts","t":4,"w":1,"d":[],"mh":{"tr":["dept-orchestrate.sh outputs JSON spawn plan from resolve-departments.sh output","dept-status.sh performs atomic read/write of .dept-status-{dept}.json using flock with mkdir fallback","dept-gate.sh validates handoff gate conditions (sentinel files + artifact checks) with configurable timeout","dept-cleanup.sh removes only YOLO coordination files (.dept-status-*, .handoff-*, .dept-lock-*, .phase-orchestration.json)","All scripts are no-ops or exit cleanly when multi_dept=false"],"ar":[{"p":"scripts/dept-orchestrate.sh","pv":"bash scripts/dept-orchestrate.sh .yolo-planning/config.json .yolo-planning/phases/02-test/ outputs valid JSON with waves array","c":"Outputs JSON spawn plan with waves, depts per wave, gate names, and timeout"},{"p":"scripts/dept-status.sh","pv":"bash scripts/dept-status.sh --dept backend --phase-dir /tmp/test --action write --status running --step planning creates .dept-status-backend.json","c":"Atomic JSON write with flock locking and read-back verification"},{"p":"scripts/dept-gate.sh","pv":"bash scripts/dept-gate.sh --gate ux-complete --phase-dir /tmp/test --timeout 1 exits 0 or 1","c":"Gate checker with 3 exit codes: 0=satisfied, 1=timeout, 2=failure"},{"p":"scripts/dept-cleanup.sh","pv":"bash scripts/dept-cleanup.sh --phase-dir /tmp/test --reason complete removes coordination files only","c":"Safe cleanup that never touches user artifacts or plan/summary files"}],"kl":[{"fr":"scripts/resolve-departments.sh","to":"scripts/dept-orchestrate.sh","vi":"dept-orchestrate consumes resolve-departments output to build spawn plan"},{"fr":"scripts/dept-status.sh","to":"scripts/dept-gate.sh","vi":"dept-gate reads .dept-status-{dept}.json files written by dept-status"},{"fr":"scripts/dept-gate.sh","to":"scripts/dept-cleanup.sh","vi":"dept-cleanup removes files created/checked by dept-gate and dept-status"}]},"obj":"Create 4 new coordination scripts that implement file-based multi-department orchestration: spawn plan generation, atomic status tracking, handoff gate validation, and cleanup.","sk":["commit"],"fm":["scripts/dept-orchestrate.sh","scripts/dept-status.sh","scripts/dept-gate.sh","scripts/dept-cleanup.sh","tests/unit/dept-orchestrate.bats","tests/unit/dept-status.bats","tests/unit/dept-gate.bats","tests/unit/dept-cleanup.bats"]}
{"id":"02-01-01","n":"Create dept-orchestrate.sh","f":["scripts/dept-orchestrate.sh"],"d":[],"ac":["scripts/dept-orchestrate.sh exists and is executable","Accepts config_path and phase_dir as positional args","Calls resolve-departments.sh internally and parses its output","Outputs JSON: {waves:[{id:N,depts:[...],gate:string}],timeout_minutes:N}","For parallel workflow with UX+FE+BE: wave 1=[uiux] gate=handoff-ux-complete, wave 2=[frontend,backend] gate=all-depts-complete","For parallel without UX: wave 1=[frontend,backend] gate=all-depts-complete","For sequential: one dept per wave with per-dept gates","For backend_only: single wave=[backend] gate=all-depts-complete","When multi_dept=false: outputs {waves:[{id:1,depts:[\"backend\"],gate:\"all-depts-complete\"}],timeout_minutes:30}","Uses set -euo pipefail, jq for JSON output","Exits 0 on success, 1 on invalid args"]}
{"id":"02-01-02","n":"Create dept-status.sh","f":["scripts/dept-status.sh"],"d":[],"ac":["scripts/dept-status.sh exists and is executable","Accepts --dept, --phase-dir, --action (read|write), --status, --step, --error flags","Write action: creates/updates .dept-status-{dept}.json with flock on .dept-lock-{dept}","flock fallback: uses mkdir-based locking when flock unavailable (macOS compat)","JSON schema: {dept,status,step,started_at,updated_at,plans_complete,plans_total,error}","Read action: outputs current status JSON to stdout, exits 1 if file missing","Write action: sets started_at on first write, updates updated_at on every write","Accepts --plans-complete and --plans-total optional flags for progress tracking","Uses set -euo pipefail, jq for JSON manipulation","Exits 0 on success, 1 on missing file (read), 2 on lock timeout"]}
{"id":"02-01-03","n":"Create dept-gate.sh and dept-cleanup.sh","f":["scripts/dept-gate.sh","scripts/dept-cleanup.sh"],"d":[],"ac":["scripts/dept-gate.sh exists and is executable","Accepts --gate (ux-complete|api-contract|all-depts), --phase-dir, --timeout (seconds, default 1800)","Gate ux-complete: checks .handoff-ux-complete exists + design-handoff.jsonl valid + design-tokens.jsonl exists + component-specs.jsonl valid","Gate api-contract: checks api-contracts.jsonl exists with at least one status=agreed entry","Gate all-depts: checks every .dept-status-{dept}.json has status=complete + at least one summary.jsonl per dept","Polling loop: checks gate condition, sleeps 0.5s, checks timeout","Exit codes: 0=gate satisfied, 1=timeout, 2=validation failure","scripts/dept-cleanup.sh exists and is executable","Accepts --phase-dir and --reason (complete|failure|timeout)","Removes: .dept-status-*.json, .handoff-*, .dept-lock-*, .phase-orchestration.json from phase-dir","Never removes: *.plan.jsonl, *.summary.jsonl, *.toon, *.md, or any non-coordination file","Outputs list of removed files to stdout","Uses set -euo pipefail","Both exit 0 on success"]}
{"id":"02-01-04","n":"Write coordination script tests","f":["tests/unit/dept-orchestrate.bats","tests/unit/dept-status.bats","tests/unit/dept-gate.bats","tests/unit/dept-cleanup.bats"],"d":["02-01-01","02-01-02","02-01-03"],"ac":["tests/unit/dept-orchestrate.bats has minimum 6 tests: parallel 3-dept output, parallel no-UX output, sequential output, backend-only output, JSON validity check, missing config graceful handling","tests/unit/dept-status.bats has minimum 6 tests: write creates file, read returns JSON, lock prevents concurrent writes, started_at set once, updated_at updates, missing file read exits 1","tests/unit/dept-gate.bats has minimum 6 tests: ux-complete gate passes with all artifacts, ux-complete fails without sentinel, all-depts passes when all complete, timeout exits 1, api-contract passes with agreed entry, validation failure exits 2","tests/unit/dept-cleanup.bats has minimum 4 tests: removes coordination files, preserves plan files, preserves summary files, handles empty dir gracefully","All tests use BATS test helpers (bats-support, bats-assert, bats-file)","All tests pass with bats"]}
