{"p":"02-03","n":"Protocol and Documentation Updates","t":4,"w":2,"d":["02-01","02-02"],"mh":{"tr":["execute-protocol.md Multi-Department Execution section documents background Task subagent spawning, polling loops, and gate mechanics","multi-dept-protocol.md Phase Execution replaces placeholder parallelism with concrete file-based coordination mechanism","cross-team-protocol.md handoff gates reference dept-gate.sh with exact file paths and validation commands","company-hierarchy.md notes background Task subagent approach for parallel execution","All protocol docs preserve single-dept Task tool path unchanged","No references to spawnTeam, SendMessage, or Teammate API in coordination context"],"ar":[{"p":"references/execute-protocol.md","pv":"grep -c 'dept-orchestrate.sh' references/execute-protocol.md returns at least 1","c":"execute-protocol references dept-orchestrate.sh for spawn plan generation"},{"p":"references/multi-dept-protocol.md","pv":"grep -c 'dept-status' references/multi-dept-protocol.md returns at least 2","c":"multi-dept-protocol references dept-status.sh for status tracking and dept-status-{dept}.json files"},{"p":"references/cross-team-protocol.md","pv":"grep -c 'dept-gate.sh' references/cross-team-protocol.md returns at least 3","c":"cross-team-protocol references dept-gate.sh for each of the 3 handoff gates"},{"p":"references/company-hierarchy.md","pv":"grep -c 'background Task subagent' references/company-hierarchy.md returns at least 1","c":"company-hierarchy documents background Task subagent approach"}],"kl":[{"fr":"references/execute-protocol.md","to":"scripts/dept-orchestrate.sh","vi":"execute-protocol instructs go.md to call dept-orchestrate.sh for spawn plan"},{"fr":"references/multi-dept-protocol.md","to":"references/cross-team-protocol.md","vi":"multi-dept dispatch references cross-team handoff gates for file-based coordination"},{"fr":"references/execute-protocol.md","to":"scripts/dept-cleanup.sh","vi":"execute-protocol instructs cleanup on phase completion or failure"}]},"obj":"Update 4 protocol and documentation files to replace placeholder parallelism and Teammate API references with concrete file-based coordination using background Task subagents, sentinel files, and the new coordination scripts.","sk":["commit"],"fm":["references/execute-protocol.md","references/multi-dept-protocol.md","references/cross-team-protocol.md","references/company-hierarchy.md","tests/static/protocol-file-coord-refs.bats"]}
{"id":"02-03-01","n":"Update execute-protocol.md for file-based orchestration","f":["references/execute-protocol.md"],"d":[],"ac":["Multi-Department Execution section expanded with inline orchestration instructions","Documents: dept-orchestrate.sh call to get spawn plan JSON","Documents: spawn department Leads as background Task subagents (run_in_background=true)","Documents: polling loop pattern (while + sleep 0.5 + file existence check + timeout guard)","Documents: dept-gate.sh invocation for each handoff gate","Documents: dept-cleanup.sh call on completion or failure","Documents: .phase-orchestration.json creation and schema","Step 10 Sign-off updated: includes dept-cleanup.sh call for multi-dept cleanup","Execution State Transitions table: notes .phase-orchestration.json as additional state file when multi_dept=true","Existing single-dept Task tool path preserved verbatim, no changes to Steps 1-10 for single-dept","REQ-03 mapped in orchestration section"]}
{"id":"02-03-02","n":"Update multi-dept-protocol.md for concrete mechanism","f":["references/multi-dept-protocol.md"],"d":["02-03-01"],"ac":["Phase Execution section: replaces 'Run in PARALLEL' with concrete background Task subagent mechanism","New section: Coordination Files -- lists all file types (.dept-status-{dept}.json, .handoff-*, .dept-lock-*, .phase-orchestration.json) with schemas","New section: Polling Mechanism -- documents interval (500ms), timeout (configurable), error handling","New section: Cleanup -- when and what dept-cleanup.sh removes","Per-Department 10-Step Execution: each dept Lead spawned as background Task subagent, runs foreground Task subagents internally","Integration QA section: uses dept-gate.sh --gate all-depts to verify all departments complete","Owner Sign-off: references dept-cleanup.sh for post-phase cleanup","Removes any references to spawnTeam or SendMessage for coordination purposes"]}
{"id":"02-03-03","n":"Update cross-team-protocol.md and company-hierarchy.md","f":["references/cross-team-protocol.md","references/company-hierarchy.md"],"d":["02-03-01"],"ac":["cross-team-protocol.md Gate 1 (UX -> FE+BE): references dept-gate.sh --gate ux-complete with exact validation commands","cross-team-protocol.md Gate 2 (FE <-> BE API Contract): references dept-gate.sh --gate api-contract","cross-team-protocol.md Gate 3 (Integration QA): references dept-gate.sh --gate all-depts","Each gate documents: sentinel file path, validation checks, timeout, failure handling","Gate validation bash examples updated to use dept-gate.sh instead of direct jq checks","company-hierarchy.md Multi-Department Structure section: adds note that parallel execution uses background Task subagents (run_in_background=true), not Teammate API","company-hierarchy.md: notes coordination via file-based gates (.dept-status-{dept}.json, .handoff-* sentinels)","Both files: no behavioral changes, documentation-only updates"]}
{"id":"02-03-04","n":"Write protocol validation tests","f":["tests/static/protocol-file-coord-refs.bats"],"d":["02-03-01","02-03-02","02-03-03"],"ac":["tests/static/protocol-file-coord-refs.bats has minimum 8 tests","Tests: execute-protocol.md contains dept-orchestrate.sh reference","Tests: execute-protocol.md contains dept-cleanup.sh reference","Tests: execute-protocol.md contains run_in_background reference","Tests: multi-dept-protocol.md contains dept-status reference","Tests: multi-dept-protocol.md contains Coordination Files section","Tests: cross-team-protocol.md contains dept-gate.sh reference (at least 3 occurrences)","Tests: company-hierarchy.md contains background Task subagent reference","Tests: execute-protocol.md preserves existing single-dept Task tool path (grep for 'Task tool' returns match)","All tests use grep/file-content assertions on protocol files","All tests pass with bats"]}
