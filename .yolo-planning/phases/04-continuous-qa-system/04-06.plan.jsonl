{"p":"04","n":"06","t":"Post-task QA gate script","w":2,"d":[],"mh":{"tr":["Post-task QA gate runs test-summary.sh and exits non-zero on failure","Gate accepts --phase-dir and --plan and --task flags to scope test runs","Gate works identically in team_mode=task and team_mode=teammate","Gate outputs structured JSON result: {gate,level,r,tests,dt}","Gate is fail-open on missing test infrastructure (no bats = warn, not block)"],"ar":[{"p":"scripts/qa-gate-post-task.sh","pv":"file exists and is executable","c":"Contains post-task QA gate logic: runs test-summary.sh, parses TAP output, exits 0 on pass, exits 1 on fail, outputs JSON result"},{"p":"tests/unit/qa-gate-post-task.bats","pv":"file exists","c":"Tests for post-task gate: pass/fail/no-tests/timeout scenarios, JSON output validation, fail-open behavior"}],"kl":[{"fr":"scripts/qa-gate-post-task.sh","to":"scripts/test-summary.sh","vi":"Post-task gate invokes test-summary.sh for test execution"},{"fr":"scripts/qa-gate-post-task.sh","to":"references/qa-output-patterns.md","vi":"Gate output follows UX-defined output templates from 04-01"}]},"obj":"Create the post-task QA gate script that runs unit tests after each Senior-approved task batch, with structured JSON output and fail-open safety","sk":["commit"],"fm":["scripts/qa-gate-post-task.sh","tests/unit/qa-gate-post-task.bats"]}
{"id":"T1","tp":"auto","a":"Create scripts/qa-gate-post-task.sh: accepts --phase-dir, --plan, --task flags. Runs test-summary.sh, captures output and exit code. Produces JSON result {gate:pass|fail|warn,level:post-task,r:PASS|FAIL|WARN,tests:{ps:N,fl:N},dt:YYYY-MM-DD}. Exit 0 on pass, exit 1 on fail. Fail-open: if bats/test-summary.sh missing, output warn and exit 0. Use set -u, jq for JSON output. REQ-07 post-task gate.","f":["scripts/qa-gate-post-task.sh"],"v":"Script exists, is executable, accepts all three flags, produces valid JSON on stdout","done":"Post-task QA gate script committed and executable"}
{"id":"T2","tp":"auto","a":"Add --scope flag to qa-gate-post-task.sh that limits test-summary.sh to run only test suites relevant to modified files. Accept --files flag (comma-separated) or read from plan.jsonl task f field. When --scope is omitted, run full test suite. This enables fast feedback: only relevant tests after each task.","f":["scripts/qa-gate-post-task.sh"],"td":["T1"],"v":"--scope flag limits test execution, --files accepts comma-separated paths","done":"Scoped test execution committed"}
{"id":"T3","tp":"auto","a":"Add team_mode awareness to qa-gate-post-task.sh: detect team_mode from config/defaults.json or YOLO_TEAM_MODE env var. In teammate mode, output includes task_id and plan_id fields for Lead aggregation. In task mode, output is unchanged. Both paths produce identical JSON schema (extra fields are additive). REQ-07 both team modes.","f":["scripts/qa-gate-post-task.sh"],"td":["T2"],"v":"Script reads team_mode, adds task_id/plan_id in teammate mode, JSON schema valid in both modes","done":"Team mode awareness committed"}
{"id":"T4","tp":"auto","a":"Write tests/unit/qa-gate-post-task.bats: test pass scenario (test-summary returns PASS), fail scenario (test-summary returns FAIL with details), no-test-infra scenario (bats missing = warn exit 0), JSON output validation (jq parses all fields), --scope filtering, team_mode field inclusion. Minimum 8 test cases.","f":["tests/unit/qa-gate-post-task.bats"],"td":["T3"],"v":"All tests pass, minimum 8 cases covering pass/fail/warn/scope/team_mode","done":"Post-task gate tests committed"}
