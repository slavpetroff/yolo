{"ts":"2026-02-17T22:30:00Z","agent":"lead","task":"phase-4-planning","dec":"Decompose Backend scope into 5 plans (04-06 through 04-10) with post-task gate as foundation","reason":"Post-task gate is the highest-priority deliverable per REQ-07 and the foundation for post-plan and post-phase gates. 5 plans provides clean separation of concerns: scripts, protocol integration, agent updates, config/testing.","alts":["3 plans combining scripts+protocol+agents into larger plans","4 plans merging config into protocol integration"]}
{"ts":"2026-02-17T22:30:01Z","agent":"lead","task":"phase-4-planning","dec":"All Backend plans use wave 2 with internal dependency ordering rather than multi-wave","reason":"Backend is wave 2 relative to UX (wave 1). Within Backend, dependency ordering via the d field provides sequencing without needing sub-waves. 04-06 is the root (no deps), 04-07 through 04-10 depend on it.","alts":["Sub-waves within Backend (w:2a, w:2b)","Single mega-plan with all tasks"]}
{"ts":"2026-02-17T22:30:02Z","agent":"lead","task":"phase-4-planning","dec":"Separate qa-gate-post-task.sh, qa-gate-post-plan.sh, qa-gate-post-phase.sh as distinct scripts rather than a single multi-mode script","reason":"Single-responsibility: each script has one job, one exit code contract, one JSON output schema. Makes testing and debugging simpler. The existing qa-gate.sh is a hook-level gate (different scope). New scripts are workflow-level gates.","alts":["Single qa-gate-continuous.sh with --level flag","Extend existing qa-gate.sh with new modes"]}
{"ts":"2026-02-17T22:30:03Z","agent":"lead","task":"phase-4-planning","dec":"Plans 04-08 and 04-09 can run in parallel (same deps, no file overlap)","reason":"04-08 modifies execute-protocol.md and creates qa-gate-integration.md. 04-09 modifies yolo-qa.md and yolo-qa-code.md. Zero file overlap enables parallel execution when multiple Devs are available.","alts":["Sequential ordering 04-08 before 04-09","Merging 04-08 and 04-09 into one plan"]}
{"ts":"2026-02-17T23:15:00Z","agent":"architect","task":"phase-4-architecture","dec":"D1: 04-03 is sole owner of qa_gates in config/defaults.json. 04-10 reads config, does not write it. 04-03 added as dependency of 04-10.","reason":"C1 critical finding: 04-03 and 04-10 both write qa_gates with conflicting schemas (5 fields vs 3). Single ownership eliminates schema conflict. R-C1 research confirms approach.","alts":["Dual-write with runtime reconciliation","Let 04-10 merge schemas at runtime"]}
{"ts":"2026-02-17T23:15:01Z","agent":"architect","task":"phase-4-architecture","dec":"D2: Three separate gate scripts. qa-gate.sh (hook) unchanged. New: qa-gate-post-task.sh, qa-gate-post-plan.sh, qa-gate-post-phase.sh.","reason":"C2 critical finding: 04-05 contradicts decisions.jsonl D3 by adding --level dispatch to qa-gate.sh. C6: hook system cannot pass CLI args. Separate scripts align with D3 and avoid hook interface breakage. R-C2, R-C6 research confirms.","alts":["Single multi-mode script with --level flag","Extend qa-gate.sh stdin protocol"]}
{"ts":"2026-02-17T23:15:02Z","agent":"architect","task":"phase-4-architecture","dec":"D3: Gate result storage at {phase-dir}/.qa-gate-results.jsonl, append-mode, flock serialized.","reason":"C3: No plan defined storage path. C7: Concurrent writes corrupt shared files. Append-mode JSONL with flock matches git-commit-serialized.sh pattern. R-C3, R-C7 research confirms.","alts":["Per-task result files","Stdout-only with no persistence"]}
{"ts":"2026-02-17T23:15:03Z","agent":"architect","task":"phase-4-architecture","dec":"D4: Post-task gate uses --scope by default (30s timeout). Post-plan/post-phase run full suite (300s timeout).","reason":"C4: Full suite (1919 tests) after every task is prohibitively slow. --scope limits to relevant tests. 30s timeout prevents blocking. R-C4 research confirms timeout and scope strategy.","alts":["Always full suite with caching","Skip post-task tests entirely"]}
{"ts":"2026-02-17T23:15:04Z","agent":"architect","task":"phase-4-architecture","dec":"D5: flock serialization for gate result writes and test execution in teammate mode.","reason":"C7: Up to 5 parallel Devs trigger concurrent gates. flock+mkdir pattern proven in git-commit-serialized.sh. R-C7 research confirms.","alts":["Per-task result files only","Queue-based test execution"]}
{"ts":"2026-02-17T23:15:05Z","agent":"architect","task":"phase-4-architecture","dec":"D6: validate-config.sh wired into session-start.sh with fail-soft (warn-only, non-blocking).","reason":"C9: Script created with no call site = dead code. session-start.sh is the natural config validation point. Fail-soft matches existing graceful degradation pattern. R-C9 research confirms.","alts":["Wire into execute-protocol.md Pre-Execution","Wire into config.md write path"]}
{"ts":"2026-02-17T23:15:06Z","agent":"architect","task":"phase-4-architecture","dec":"D7: 04-05 rescoped -- remove T2 (post-task logic) and T3 (post-phase logic). T1 becomes config reading only. Keep T4 and T5. Add 04-05 as dependency of 04-08.","reason":"C2+C6+C8: T2/T3 duplicate 04-06/04-07. T1 --level dispatch impossible through hook system. 04-05 and 04-08 need ordering. Rescoping resolves all three findings.","alts":["Keep 04-05 as-is and remove 04-06/04-07","Merge 04-05 into 04-06"]}
{"ts":"2026-02-18T00:30:00Z","agent":"senior","task":"04-06-spec","dec":"Copy flock+mkdir lock pattern from git-commit-serialized.sh into each gate script rather than extracting a shared lock library","reason":"Three gate scripts need identical flock logic. Extracting to shared lib adds a dependency and import path complexity. Direct copy is 40 lines, proven pattern, zero dependency. Each script is self-contained and testable in isolation.","alts":["Extract scripts/flock-helper.sh shared library","Use advisory lockfile without flock"]}
{"ts":"2026-02-18T00:30:01Z","agent":"senior","task":"04-06-spec","dec":"Use set -u (not set -euo pipefail) for gate scripts because fail-open requires manual error handling","reason":"Gate scripts must never crash unexpectedly -- every external command needs explicit error handling to produce warn JSON instead of crash. set -e would cause premature exit on any command failure, violating fail-open contract. set -u catches undefined variables which is always desirable.","alts":["set -euo pipefail with trap ERR","set -u with selective set +e blocks"]}
{"ts":"2026-02-18T00:30:02Z","agent":"senior","task":"04-06-spec","dec":"Post-task scoped test discovery maps source files to test files via basename+find pattern in tests/ directory","reason":"No formal source-to-test mapping exists. basename + find is simple and handles the existing naming convention (scripts/foo.sh -> tests/*/foo.bats). More complex mapping (AST-based, import tracing) is unnecessary for the current bats-only test suite.","alts":["Maintain explicit source->test mapping file","Use directory mirroring convention"]}
{"ts":"2026-02-18T00:30:03Z","agent":"senior","task":"04-07-spec","dec":"Post-plan must_have verification is best-effort for tr (truths) since truths are human-readable strings","reason":"Truths like 'Post-task QA gate runs test-summary.sh' cannot be mechanically verified with certainty. File/grep heuristics provide partial coverage. Deep truth verification is QA Lead's job (LLM-powered). Post-plan gate provides fast automated pre-check, not exhaustive verification.","alts":["Skip truth verification entirely","Require machine-verifiable truth format"]}
{"ts":"2026-02-18T00:30:04Z","agent":"senior","task":"04-08-spec","dec":"Execute-protocol.md modifications are purely additive insertions, not rewrites of existing sections","reason":"execute-protocol.md is 797 lines and the source of truth for the 11-step workflow. Rewriting existing sections risks breaking established behavior. Additive insertion at precise locations (after Dev commit, after summary verification, before QA spawn) preserves all existing content.","alts":["Rewrite Step 7 and Step 9 sections entirely","Use include/reference pattern instead of inline content"]}
{"ts":"2026-02-18T00:30:05Z","agent":"senior","task":"04-09-spec","dec":"QA Code Phase 0 cached pass applies only to TDD compliance check, not Phase 1 full test suite","reason":"Post-task gates run scoped tests (--scope flag, subset of tests). Phase 1 must run the full suite to catch interactions between components. Cached pass for Phase 0 avoids redundant file-existence checks and individual test verification, saving time without sacrificing coverage.","alts":["Cache full test results and skip Phase 1 entirely","No caching, always re-run everything"]}
{"ts":"2026-02-18T00:30:06Z","agent":"senior","task":"04-10-spec","dec":"validate-gates.sh new entries read from .qa-gate-results.jsonl using jq select() rather than checking individual result files","reason":"Architecture D3 defines single append-mode file for all gate results. validate-gates.sh should read from the canonical storage location, not per-task files. jq select(.gl==\"post-task\") filters efficiently. Consistent with existing check_artifact_exists pattern.","alts":["Check for per-task result files","Check for gate result count instead of existence"]}
