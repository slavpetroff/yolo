{"p":"02","n":"01","t":"debug.md hierarchy rewrite","w":1,"d":[],"xd":[{"p":"01","n":"01","a":"references/execute-protocol.md","r":"Verification gate protocol pattern referenced for lightweight chain"}],"mh":{"tr":["debug.md spawns Lead agent (yolo-lead) as dispatcher, not Debugger directly","Lead scopes bug before Debugger investigates","Lead reviews Debugger results before presenting to user","Escalation path documented: Debugger->Lead->go.md","Competing hypotheses mode preserved (Lead spawns multiple Debuggers)","Owner-first: go.md acts as Owner proxy, debug.md Lead handles downstream"],"ar":[{"p":"commands/debug.md","pv":"yolo-lead","c":"grep"},{"p":"commands/debug.md","pv":"Lead.*scop","c":"grep"},{"p":"commands/debug.md","pv":"Lead.*review","c":"grep"}],"kl":[{"fr":"commands/debug.md","to":"agents/yolo-lead.md","vi":"Lead dispatches Debugger"},{"fr":"commands/debug.md","to":"agents/yolo-debugger.md","vi":"Debugger reports to Lead"}]},"obj":"Rewrite debug.md to route through Lead->Debugger hierarchy instead of spawning Debugger directly (REQ-02, REQ-03)","sk":[],"fm":["commands/debug.md"],"auto":true}
{"id":"T1","tp":"auto","a":"Rewrite debug.md Steps section: (1) Step 3 spawns yolo-lead as dispatcher instead of yolo-debugger directly. Lead receives bug description + effort level + ambiguity classification from Steps 1-2. (2) Lead scopes the bug (identifies codebase area, formulates hypothesis structure). (3) Lead spawns Debugger(s) -- Path A: 3 Debuggers for competing hypotheses, Path B: 1 Debugger for standard. (4) Debugger reports back to Lead via debugger_report schema. (5) Lead synthesizes results, decides fix action. (6) If fix needed, Lead delegates to Dev via Senior for implementation, or Debugger applies if trivial. Keep model resolution (resolve-agent-model.sh) for both Lead and Debugger. Keep YAML frontmatter unchanged. Keep Guard section unchanged. Update Present section to show Lead dispatched the investigation. (REQ-02, REQ-03)","f":["commands/debug.md"],"v":"grep -q 'yolo-lead' commands/debug.md && ! grep -q 'Spawn.*yolo-debugger.*subagent' commands/debug.md (Lead is primary spawn, Debugger spawned by Lead not by command)","done":"debug.md routes through Lead who dispatches Debugger(s), Lead reviews results, escalation documented","spec":"Open commands/debug.md. PRESERVE lines 1-7 exactly (YAML frontmatter: name, description, argument-hint, allowed-tools, disable-model-invocation). PRESERVE lines 9-24 exactly (# YOLO Debug title, ## Context section, ## Guard section). REPLACE the entire ## Steps section (lines 26-78) with the following new content. Step 1 (Parse + effort): Keep identical to current Step 1 -- parse $ARGUMENTS as bug description, map effort levels, read effort profile. Step 2 (Classify ambiguity): Keep identical to current Step 2 -- keyword detection, overrides for --competing/--parallel/--serial. Step 3 (Spawn Lead): NEW. Replace the direct Debugger spawn. (a) Resolve Lead model: LEAD_MODEL=$(bash ${CLAUDE_PLUGIN_ROOT}/scripts/resolve-agent-model.sh lead .yolo-planning/config.json ${CLAUDE_PLUGIN_ROOT}/config/model-profiles.json) with error check. (b) Resolve Debugger model: DEBUGGER_MODEL=$(bash ${CLAUDE_PLUGIN_ROOT}/scripts/resolve-agent-model.sh debugger .yolo-planning/config.json ${CLAUDE_PLUGIN_ROOT}/config/model-profiles.json) with error check. (c) Display: diamond Spawning Lead (${LEAD_MODEL}) for bug investigation... (d) Spawn yolo-lead as subagent via Task tool with model: '${LEAD_MODEL}'. Prompt must contain: Bug investigation dispatch. Effort: {effort}. Ambiguity: {ambiguous|clear}. Bug report: {description}. Working dir: {pwd}. Debugger model: ${DEBUGGER_MODEL}. Then Lead instructions in the prompt: 'You are the Lead dispatcher for a debug investigation. (1) Scope the bug: identify affected codebase area, read relevant files, formulate hypothesis structure. (2) Choose dispatch mode: if effort=high AND ambiguous, use Path A (competing hypotheses); else Path B (standard). PATH A: Generate 3 hypotheses (cause, area, confirming evidence). Spawn 3 yolo-debugger subagents via Task tool (model: DEBUGGER_MODEL each). Each gets bug report + ONE hypothesis only. Wait for debugger_report from each. Synthesize: strongest evidence + highest confidence wins. PATH B: Spawn 1 yolo-debugger subagent (model: DEBUGGER_MODEL). Give full bug report. Wait for debugger_report. (3) After Debugger(s) complete: if fix was applied by Debugger, verify commit exists. If fix needed but not applied, decide: trivial fix -> spawn yolo-dev directly with inline spec; complex fix -> report back with recommendation. (4) Report results back: root cause, fix status, files modified.' Step 4 (Present): Keep the brand-essentials box format from current Step 4 but update Mode line to show 'Lead-dispatched: Competing Hypotheses (3 parallel)' or 'Lead-dispatched: Standard (single debugger)'. Keep Issue, Root Cause, Fix, Files Modified fields. Keep the Next line: /yolo:status. ENSURE the final file is under 120 lines total. Count: 7 YAML + 1 blank + 2 title + 1 blank + 12 Context + 1 blank + 4 Guard + 1 blank + ~75 Steps + ~15 Present = ~118 lines. Do NOT add any ## Output Format or ## Escalation section in this task (T2 adds Escalation).","ts":""}
{"id":"T2","tp":"auto","a":"Add escalation documentation to debug.md: Add Escalation section after Steps documenting the chain Debugger->Lead->go.md(Owner proxy)->User. Document that Debugger NEVER presents results directly -- Lead synthesizes. Document that if Debugger recommends architectural fix, Lead escalates to Architect via escalation schema. (REQ-02)","f":["commands/debug.md"],"v":"grep -q 'Escalation' commands/debug.md && grep -q 'Debugger.*Lead' commands/debug.md","done":"Escalation chain documented in debug.md, Debugger->Lead->go.md path clear","spec":"Open commands/debug.md (after T1 has rewritten it). AFTER the Present section box (after the suggest-next.sh line), add a new ## Escalation section with exactly these rules as a compact bullet list: (1) Debugger -> Lead: Debugger reports findings via debugger_report schema. Debugger NEVER presents results to user. (2) Lead -> go.md: Lead synthesizes Debugger findings, presents results to go.md (Owner proxy). (3) Architectural fix: If Debugger recommends fix that touches >3 files or changes interfaces, Lead escalates to Architect via escalation schema before applying. (4) Fix routing: Trivial fix (1-2 lines, obvious) -> Debugger applies directly. Standard fix -> Lead spawns Dev with inline spec. Complex fix -> Lead escalates to Senior for spec -> Dev implements. Keep this section to 8-10 lines max. Use single-dash bullets, no nested lists.","ts":""}
{"id":"T3","tp":"auto","a":"Verify debug.md coherence: Ensure total line count stays under 120 lines (lightweight command, not full execute protocol). Ensure YAML frontmatter description still accurate. Ensure model resolution resolves both lead and debugger models. Ensure brand essentials reference preserved in Present section. Commit: feat(02-01): rewrite debug.md to use Lead->Debugger hierarchy","f":["commands/debug.md"],"v":"wc -l commands/debug.md shows <= 120 lines; YAML frontmatter parseable; no references to spawning debugger directly from command level","done":"debug.md committed, coherent, under 120 lines, hierarchy-routed","spec":"Open commands/debug.md (after T1 and T2). Run verification checks: (1) Line count: count total lines, must be <=120. If over, trim verbose prose in Steps -- collapse multi-line explanations into single-line instructions. Remove any blank lines between sub-steps. (2) YAML frontmatter: verify lines 1-7 unchanged from original (name: debug, description mentions Debugger agent, argument-hint, allowed-tools, disable-model-invocation: true). If description says 'Debugger agent' only, update to 'Investigate a bug using the Lead-dispatched Debugger agent hierarchy.' (3) Model resolution: verify both LEAD_MODEL and DEBUGGER_MODEL resolve-agent-model.sh calls exist in Step 3. Verify Lead spawn passes model: '${LEAD_MODEL}'. Verify Debugger model is passed to Lead in prompt. (4) Brand essentials: verify Present section references @${CLAUDE_PLUGIN_ROOT}/references/yolo-brand-essentials.toon. Verify box uses single-line border (not double). Verify suggest-next.sh call uses 'debug' argument. (5) No direct Debugger spawn: grep for 'Spawn.*yolo-debugger.*subagent' or 'Spawn yolo-debugger' at the command level (not inside the Lead prompt). Must NOT exist -- all Debugger spawns happen inside Lead's instructions. (6) If all checks pass, stage and commit: git add commands/debug.md && git commit with message 'feat(02-01): rewrite debug.md to use Lead->Debugger hierarchy'.","ts":""}
