{"p":"02","n":"03","t":"research.md hierarchy rewrite","w":1,"d":[],"xd":[],"mh":{"tr":["research.md spawns Lead agent (yolo-lead) as scoping dispatcher, not Scout directly","Lead scopes research questions before Scout dispatched","Lead synthesizes Scout findings, not the command directly","Parallel mode: Lead scopes sub-topics then dispatches multiple Scouts","Escalation: Scout->Lead->go.md documented","Owner-first: go.md acts as Owner proxy, research.md Lead handles downstream"],"ar":[{"p":"commands/research.md","pv":"yolo-lead","c":"grep"},{"p":"commands/research.md","pv":"Lead.*scop","c":"grep"},{"p":"commands/research.md","pv":"Lead.*synth","c":"grep"}],"kl":[{"fr":"commands/research.md","to":"agents/yolo-lead.md","vi":"Lead scopes research"},{"fr":"commands/research.md","to":"agents/yolo-scout.md","vi":"Scout researches per Lead scope"}]},"obj":"Rewrite research.md to route through Lead->Scout hierarchy instead of spawning Scout directly (REQ-02, REQ-03)","sk":[],"fm":["commands/research.md"],"auto":true}
{"id":"T1","tp":"auto","a":"Rewrite research.md Steps section: (1) Step 3 spawns yolo-lead as research dispatcher instead of yolo-scout directly. Lead receives topic + --parallel flag from Steps 1-2. (2) Lead scopes: breaks topic into precise research questions, identifies what is codebase-answerable vs needs web research, determines single vs parallel Scout dispatch. (3) Lead spawns Scout(s) with scoped questions (not raw topic). (4) Scout reports findings to Lead via scout_findings schema. (5) Lead synthesizes: merges parallel findings, resolves contradictions, ranks by confidence, produces final research output. (6) Lead handles persist decision (research.jsonl write). Keep model resolution for both lead and scout. Keep YAML frontmatter unchanged except description update. Keep Guard section unchanged. Keep Output Format section. (REQ-02, REQ-03)","f":["commands/research.md"],"v":"grep -q 'yolo-lead' commands/research.md && ! grep -q 'Spawn.*yolo-scout.*subagent' commands/research.md (Lead is primary spawn)","done":"research.md routes through Lead who scopes questions then dispatches Scout(s)","spec":"Open commands/research.md. PRESERVE lines 1-7 exactly (YAML frontmatter: name: research, description, argument-hint with --parallel, allowed-tools, disable-model-invocation: true). PRESERVE lines 9-10 (# YOLO Research title). PRESERVE lines 12-18 (## Context section with working dir and PROJECT.md). PRESERVE lines 20-22 (## Guard section). REPLACE the entire ## Steps section (lines 24-53) with the following new content. Step 1 (Parse): Keep identical -- Topic (required), --parallel flag detection. Step 2 (Spawn Lead): NEW. Replace direct Scout spawn. (a) Resolve 2 models: LEAD_MODEL=$(bash ${CLAUDE_PLUGIN_ROOT}/scripts/resolve-agent-model.sh lead .yolo-planning/config.json ${CLAUDE_PLUGIN_ROOT}/config/model-profiles.json) with error check. SCOUT_MODEL=$(bash ${CLAUDE_PLUGIN_ROOT}/scripts/resolve-agent-model.sh scout .yolo-planning/config.json ${CLAUDE_PLUGIN_ROOT}/config/model-profiles.json) with error check. (b) Display: diamond Spawning Lead (${LEAD_MODEL}) for research scoping... (c) Spawn yolo-lead as subagent via Task tool with model: '${LEAD_MODEL}'. Prompt: 'Research dispatch. Topic: {topic}. Parallel: {true|false}. Project context: {tech stack from PROJECT.md if relevant}. Scout model: ${SCOUT_MODEL}. Instructions: (1) Scope research: break topic into precise questions. Identify codebase-answerable (use Glob/Grep) vs web-research (needs Scout). (2) If --parallel or multi-faceted topic: generate 2-4 sub-topics, spawn up to 4 yolo-scout subagents (model: SCOUT_MODEL each) with one scoped question each. If single question: spawn 1 yolo-scout (model: SCOUT_MODEL). (3) Each Scout gets: exact research question, project context if relevant, instruction to return findings via scout_findings schema with confidence levels. (4) Synthesize: merge Scout findings, resolve contradictions, rank by confidence (high/medium/low). (5) Persist decision: ask go.md (caller) whether to save. If yes: write research.jsonl lines using jq -cn, one JSON line per finding with keys q,src,finding,conf,dt,rel. Write to .yolo-planning/phases/{phase-dir}/research.jsonl (if active phase) or .yolo-planning/research.jsonl (global). Append if file exists. (6) Return: synthesized findings with confidence levels.' Step 3 (Present): Display Lead's synthesized findings using brand essentials format. Show Next Up block: /yolo:go --plan {N} and /yolo:go --discuss {N}. PRESERVE the ## Output Format section (lines 55-58) exactly as-is. ENSURE total file is under 80 lines. Target: 7 YAML + 10 Context/Guard + ~48 Steps + ~10 Present/Output = ~75.","ts":""}
{"id":"T2","tp":"auto","a":"Add escalation documentation to research.md: Document chain Scout->Lead->go.md(Owner proxy)->User. Document that if Scout cannot find info or finds contradictions, Lead decides how to proceed. Document that Lead may recommend /yolo:go --discuss if research reveals scope concerns. (REQ-02)","f":["commands/research.md"],"v":"grep -q 'Escalation' commands/research.md && grep -q 'Scout.*Lead' commands/research.md","done":"Escalation chain documented in research.md","spec":"Open commands/research.md (after T1 rewrite). BEFORE the ## Output Format section, add a new ## Escalation section with exactly these rules as a compact bullet list: (1) Scout -> Lead: Scout reports findings or inability to find information. Scout NEVER presents results to user directly. (2) Lead -> go.md: Lead synthesizes all Scout findings, resolves contradictions, presents final output to go.md (Owner proxy). (3) Contradictions: If Scouts return conflicting findings, Lead flags contradictions with confidence levels and recommends which to trust. (4) Scope concerns: If research reveals the topic needs deeper investigation or impacts architecture, Lead recommends /yolo:go --discuss to the user. Keep to 6-8 lines max. Single-dash bullets, no nesting.","ts":""}
{"id":"T3","tp":"auto","a":"Verify research.md coherence: Ensure total line count stays under 80 lines. Ensure brand essentials reference preserved. Ensure research.jsonl persist logic preserved (Lead writes it now instead of command). Commit: feat(02-03): rewrite research.md to use Lead->Scout hierarchy","f":["commands/research.md"],"v":"wc -l commands/research.md shows <= 80 lines; research.jsonl persist flow intact; hierarchy chain clear","done":"research.md committed, coherent, under 80 lines, hierarchy-routed","spec":"Open commands/research.md (after T1 and T2). Run verification checks: (1) Line count: count total lines, must be <=80. If over, trim: collapse Lead prompt lines, remove blank lines between sub-items in Steps, tighten Escalation bullets. (2) YAML frontmatter: verify name: research unchanged. Update description from 'Run standalone research by spawning Scout agent(s) for web searches and documentation lookups.' to 'Run standalone research via Lead-scoped Scout dispatch for web searches and documentation lookups.' Keep argument-hint (<research-topic> [--parallel]), allowed-tools, disable-model-invocation unchanged. (3) Model resolution: verify LEAD_MODEL and SCOUT_MODEL both use resolve-agent-model.sh. Verify Lead spawn passes model: '${LEAD_MODEL}'. Verify Scout model passed to Lead in prompt. (4) research.jsonl persist: verify the Lead prompt includes jq -cn instruction for writing research.jsonl with q,src,finding,conf,dt,rel keys. Verify both paths: phase-dir and global fallback. (5) Brand essentials: verify ## Output Format references @${CLAUDE_PLUGIN_ROOT}/references/yolo-brand-essentials.toon. (6) No direct Scout spawn: grep for 'Spawn.*yolo-scout' or 'yolo-scout as subagent' at command level. Must NOT exist -- Scouts are spawned inside Lead's instructions only. (7) Stage and commit: git add commands/research.md && git commit 'feat(02-03): rewrite research.md to use Lead->Scout hierarchy'.","ts":""}
