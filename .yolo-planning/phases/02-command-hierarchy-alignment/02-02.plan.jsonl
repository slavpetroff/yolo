{"p":"02","n":"02","t":"fix.md hierarchy rewrite","w":1,"d":[],"xd":[{"p":"01","n":"01","a":"references/execute-protocol.md","r":"Lightweight chain pattern from execute protocol"}],"mh":{"tr":["fix.md spawns Lead agent (yolo-lead) as triage dispatcher, not Dev directly","Lead triages the fix scope before delegating","Senior writes spec for the fix before Dev implements","Dev implements per Senior spec, Senior reviews result","Escalation: Dev->Senior->Lead->go.md documented","Owner-first: go.md acts as Owner proxy, fix.md Lead handles downstream"],"ar":[{"p":"commands/fix.md","pv":"yolo-lead","c":"grep"},{"p":"commands/fix.md","pv":"Lead.*triag","c":"grep"},{"p":"commands/fix.md","pv":"Senior","c":"grep"}],"kl":[{"fr":"commands/fix.md","to":"agents/yolo-lead.md","vi":"Lead triages fix"},{"fr":"commands/fix.md","to":"agents/yolo-senior.md","vi":"Senior specs fix"},{"fr":"commands/fix.md","to":"agents/yolo-dev.md","vi":"Dev implements per spec"}]},"obj":"Rewrite fix.md to route through Lead->Senior->Dev hierarchy instead of spawning Dev directly in turbo mode (REQ-02, REQ-03)","sk":[],"fm":["commands/fix.md"],"auto":true}
{"id":"T1","tp":"auto","a":"Rewrite fix.md Steps section: (1) Step 3 spawns yolo-lead as triage dispatcher instead of yolo-dev directly. Lead receives fix description from Step 1. (2) Lead triages: determines scope (trivial vs needs-spec), identifies affected files, classifies risk. (3) If trivial (single-line, obvious fix): Lead spawns Dev directly with inline spec. If needs-spec: Lead spawns Senior to write spec, Senior spawns Dev to implement, Senior reviews Dev output. (4) Keep model resolution for lead, senior, dev via resolve-agent-model.sh. Keep YAML frontmatter unchanged. Keep Guard section unchanged. Update Verify+Present to show the hierarchy chain used. Fix should still be lightweight -- Lead triage is fast, Senior spec is brief, Dev implements. Total chain adds 2 agent hops but keeps turbo-mode spirit. (REQ-02, REQ-03)","f":["commands/fix.md"],"v":"grep -q 'yolo-lead' commands/fix.md && ! grep -q 'Spawn.*yolo-dev.*subagent' commands/fix.md (Lead is primary spawn, Dev spawned downstream not by command)","done":"fix.md routes through Lead->Senior->Dev chain, Lead triages, Senior specs, Dev implements","spec":"Open commands/fix.md. PRESERVE lines 1-7 exactly (YAML frontmatter: name: fix, description about quick fix/turbo mode, argument-hint, allowed-tools, disable-model-invocation: true). PRESERVE lines 9-10 (# YOLO Fix title). PRESERVE lines 12-15 (## Context section with working dir and config). PRESERVE lines 17-19 (## Guard section with init check and no-args check). REPLACE the entire ## Steps section (lines 21-49) with the following new content. Step 1 (Parse): Keep identical -- entire $ARGUMENTS minus flags = fix description. Step 2 (Milestone): Keep identical -- check .yolo-planning/ACTIVE for milestone-scoped STATE_PATH. Step 3 (Spawn Lead): NEW. Replace direct Dev spawn. (a) Resolve 3 models in sequence: LEAD_MODEL=$(bash ${CLAUDE_PLUGIN_ROOT}/scripts/resolve-agent-model.sh lead .yolo-planning/config.json ${CLAUDE_PLUGIN_ROOT}/config/model-profiles.json) with error check. DEV_MODEL=$(bash ${CLAUDE_PLUGIN_ROOT}/scripts/resolve-agent-model.sh dev ...) with error check. SENIOR_MODEL=$(bash ${CLAUDE_PLUGIN_ROOT}/scripts/resolve-agent-model.sh senior ...) with error check. (b) Display: diamond Spawning Lead (${LEAD_MODEL}) for fix triage... (c) Spawn yolo-lead as subagent via Task tool with model: '${LEAD_MODEL}'. Prompt: 'Quick fix triage. Fix request: {fix description}. Working dir: {pwd}. Dev model: ${DEV_MODEL}. Senior model: ${SENIOR_MODEL}. Instructions: (1) Triage scope: read relevant files, classify as trivial (single-file, <10 lines changed, obvious fix) or needs-spec (multi-file, risky, or unclear boundaries). (2) TRIVIAL path: Spawn yolo-dev subagent (model: DEV_MODEL) with inline spec: task description, exact file(s), exact change. Dev commits: fix(quick): {brief}. (3) NEEDS-SPEC path: Spawn yolo-senior subagent (model: SENIOR_MODEL) to write a brief spec (target file, function, change, edge cases). Senior spawns yolo-dev (model: DEV_MODEL) with that spec. Senior reviews Dev output. Dev commits: fix({scope}): {brief}. (4) If Dev or Senior reports ambiguity or scope too large, report back: fix cannot be applied, recommend /yolo:go --execute. (5) Report back: commit hash, files changed, path used (trivial/needs-spec).' Step 4 (Verify + Present): Check git log --oneline -1. If committed: show checkmark Fix applied, commit hash + message, files changed, path used (Trivial or Lead->Senior->Dev). Run bash ${CLAUDE_PLUGIN_ROOT}/scripts/suggest-next.sh fix and display. If Lead reported cannot-apply: show warning Fix could not be applied automatically, reason from Lead. Run bash ${CLAUDE_PLUGIN_ROOT}/scripts/suggest-next.sh debug and display. ENSURE total file is under 80 lines. Target: 7 YAML + 10 Context/Guard + ~55 Steps + ~8 Present = ~80.","ts":""}
{"id":"T2","tp":"auto","a":"Add escalation documentation to fix.md: Document chain Dev->Senior->Lead->go.md(Owner proxy)->User. Document that if Dev reports ambiguity, Senior resolves; if Senior cannot, Lead escalates. Document that Lead may reclassify a fix as needing /yolo:go --execute if scope is too large. (REQ-02)","f":["commands/fix.md"],"v":"grep -q 'Escalation' commands/fix.md && grep -q 'Dev.*Senior.*Lead' commands/fix.md","done":"Escalation chain documented in fix.md","spec":"Open commands/fix.md (after T1 rewrite). AFTER the Verify+Present section (after the suggest-next.sh lines), add a new ## Escalation section with exactly these rules as a compact bullet list: (1) Dev -> Senior: Dev reports ambiguity or blocker. Senior resolves within spec authority. (2) Senior -> Lead: Senior cannot resolve (scope unclear, multi-system impact). Lead decides: adjust scope or escalate. (3) Lead -> go.md: If fix scope exceeds quick-fix boundary (>3 files, needs architecture review, or risk is high), Lead reports back 'scope too large' and recommends /yolo:go --execute. (4) No agent contacts user directly. go.md (Owner proxy) handles all user communication. Keep to 6-8 lines max. Single-dash bullets, no nesting.","ts":""}
{"id":"T3","tp":"auto","a":"Verify fix.md coherence: Ensure total line count stays under 80 lines (fix is the lightest command). Ensure YAML frontmatter description updated to reflect hierarchy routing. Ensure suggest-next.sh references preserved. Commit: feat(02-02): rewrite fix.md to use Lead->Senior->Dev hierarchy","f":["commands/fix.md"],"v":"wc -l commands/fix.md shows <= 80 lines; YAML frontmatter parseable; hierarchy chain clear in Steps","done":"fix.md committed, coherent, under 80 lines, hierarchy-routed","spec":"Open commands/fix.md (after T1 and T2). Run verification checks: (1) Line count: count total lines, must be <=80. If over 80, trim: collapse the Lead prompt instructions into fewer lines (use semicolons to join short sentences), remove any double-blank-lines, tighten the Escalation section. (2) YAML frontmatter: verify name: fix unchanged. Update description from 'Apply a quick fix or small change with commit discipline. Turbo mode -- no planning ceremony.' to 'Apply a quick fix via Lead-triaged hierarchy. Turbo mode -- minimal ceremony.' Keep argument-hint, allowed-tools, disable-model-invocation unchanged. (3) Model resolution: verify LEAD_MODEL, DEV_MODEL, SENIOR_MODEL all use resolve-agent-model.sh with correct 3 args each. (4) suggest-next.sh: verify two calls exist -- 'suggest-next.sh fix' for success path, 'suggest-next.sh debug' for failure path. (5) No direct Dev spawn: grep for direct 'Spawn yolo-dev' or 'yolo-dev as subagent' at command level (not inside Lead prompt). Must NOT exist. (6) Stage and commit: git add commands/fix.md && git commit 'feat(02-02): rewrite fix.md to use Lead->Senior->Dev hierarchy'.","ts":""}
