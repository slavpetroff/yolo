{"p": "05", "n": "04", "t": "Escalation round-trip tests and timeout script", "w": 3, "d": ["01", "02", "03"], "mh": {"tr": ["Integration test validates full upward+downward escalation chain in agent files", "Static test validates all agents have correct escalation targets including resolution routing", "Timeout script returns structured JSON with escalation status", "Codebase mapping updated to reflect escalation system additions"], "ar": [{"f": "tests/integration/escalation-round-trip.bats", "contains": "full round-trip"}, {"f": "tests/containment/escalation-chain.bats", "contains": "escalation_resolution"}, {"f": "scripts/check-escalation-timeout.sh", "contains": "escalation_timeout"}], "kl": [{"from": "tests/integration/escalation-round-trip.bats", "to": "references/handoff-schemas.md", "rel": "Tests validate escalation_resolution schema fields"}, {"from": "tests/integration/escalation-round-trip.bats", "to": "references/execute-protocol.md", "rel": "Tests validate protocol escalation handling section exists"}, {"from": "scripts/check-escalation-timeout.sh", "to": "config/defaults.json", "rel": "Script reads escalation.timeout_seconds from config"}]}, "obj": "Create integration tests covering the full escalation round-trip and a timeout checking script that the orchestrator can call to detect stale escalations (REQ-08, REQ-09)", "sk": ["commit"]}
{"id": "T1", "a": "Create scripts/check-escalation-timeout.sh. Takes --phase-dir and --config args. Reads .execution-state.json escalations array, checks each pending escalation against escalation.timeout_seconds from config (or defaults.json fallback). Returns JSON: {timed_out: [{id, task, elapsed_seconds, recommended_action}], active: [{id, task, elapsed_seconds}], resolved: N}. Exit 0 if no timeouts, exit 1 if any timed out. Uses set -euo pipefail, jq for all JSON parsing. REQ-08.", "f": ["scripts/check-escalation-timeout.sh"], "v": "bash scripts/check-escalation-timeout.sh --help 2>&1 | grep -q 'phase-dir' || echo 'help flag not required'", "done": "check-escalation-timeout.sh exists, uses jq, reads config, returns structured JSON with timeout detection", "tp": "feat"}
{"id": "T2", "a": "Create tests/integration/escalation-round-trip.bats. Test cases: (1) All agent files in the escalation chain have the correct escalation targets (Dev->Senior, Senior->Lead, Lead->Architect, Architect->User, Owner->User), (2) escalation_resolution schema exists in handoff-schemas.md with required fields, (3) escalation_timeout_warning schema exists in handoff-schemas.md, (4) execute-protocol.md has Escalation Handling section, (5) go.md has Escalation from Agents section, (6) Lead has Escalation Receipt section, (7) Senior has Resolution Routing section, (8) Dev has Escalation Resolution section, (9) Owner has Resolution Routing section, (10) company-hierarchy.md has Escalation Round-Trip section, (11) config/defaults.json has escalation.timeout_seconds, (12) check-escalation-timeout.sh exists and is executable. REQ-08, REQ-09.", "f": ["tests/integration/escalation-round-trip.bats"], "v": "bats tests/integration/escalation-round-trip.bats --count 2>/dev/null || wc -l < tests/integration/escalation-round-trip.bats", "done": "Integration test file exists with 12+ test cases covering full escalation round-trip", "tp": "test"}
{"id": "T3", "a": "Update tests/containment/escalation-chain.bats to add new test cases: (1) yolo-lead.md has 'Escalation Receipt' section, (2) yolo-senior.md has 'Resolution Routing' section, (3) yolo-dev.md has 'Escalation Resolution' section, (4) yolo-owner.md has 'Resolution Routing' section, (5) company-hierarchy.md has 'Escalation Round-Trip' section, (6) yolo-architect.md escalation table mentions 'options array' or 'structured escalation'. These extend existing containment tests with resolution-path verification. REQ-09.", "f": ["tests/containment/escalation-chain.bats"], "v": "grep -c 'Resolution' tests/containment/escalation-chain.bats", "done": "Existing escalation-chain.bats has 6+ new test cases for downward resolution path", "tp": "test"}
{"id": "T4", "a": "Update .yolo-planning/codebase/ARCHITECTURE.md to add Escalation Round-Trip subsection under ## Hierarchical Agent Architecture. Document: (1) Full bidirectional escalation path, (2) Timeout-based auto-escalation, (3) New schemas (escalation_resolution, escalation_timeout_warning), (4) New config (escalation section in defaults.json), (5) New script (check-escalation-timeout.sh). Update .yolo-planning/codebase/INDEX.md with new file entries and cross-references. REQ-08, REQ-09.", "f": [".yolo-planning/codebase/ARCHITECTURE.md", ".yolo-planning/codebase/INDEX.md"], "v": "grep -q 'Escalation Round-Trip' .yolo-planning/codebase/ARCHITECTURE.md && grep -q 'check-escalation-timeout' .yolo-planning/codebase/INDEX.md", "done": "Codebase mapping documents reflect new escalation system with correct cross-references", "tp": "docs"}
