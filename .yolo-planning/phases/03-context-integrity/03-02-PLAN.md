---
phase: 3
plan: 2
title: "Step-ordering verification and delegation mandate reinforcement"
wave: 1
depends_on: []
must_haves:
  - execution-state.json schema includes steps_completed array
  - Each protocol step appends its ID to steps_completed
  - Step 5 validates all required steps are present before completing
  - Delegation reminders appear at Steps 3c, 3d, and 5
  - Existing delegation mandate at Step 3 is strengthened with anti-takeover language
---

## Task 1: Add steps_completed tracking to execution-state.json and step transitions

**Files:** `skills/execute-protocol/SKILL.md`

1. In Step 2 item 7 (execution-state.json schema), add `"steps_completed": []` field to the JSON template.
2. After Step 2 completes (before Step 2b), add instruction: append `"step_2"` to `steps_completed` array in `.execution-state.json` via jq.
3. After Step 2b completes, append `"step_2b"`.
4. After Step 3 team creation, append `"step_3"`.
5. After Step 3c SUMMARY gate, append `"step_3c"`.
6. After Step 3d QA gate, append `"step_3d"`.

Use jq pattern: `jq '.steps_completed += ["step_X"]' .yolo-planning/.execution-state.json > tmp && mv tmp .yolo-planning/.execution-state.json`

**Commit:** `feat(execute-protocol): add step-ordering tracking to execution state`

## Task 2: Add step-ordering validation at Step 5 and delegation mandate reinforcement

**Files:** `skills/execute-protocol/SKILL.md`

1. At Step 5 (before state updates), add validation block:
   - Read `steps_completed` from `.execution-state.json`
   - Required steps: `["step_2", "step_2b", "step_3", "step_3c", "step_3d"]`
   - If any required step is missing: HARD STOP with message listing skipped steps
   - Display: `✓ Step ordering verified: all required steps completed`

2. Strengthen delegation mandate at line 428:
   - Add: "VIOLATION: If you (the orchestrator) Write/Edit any file listed in a plan's `files_modified`, this is a protocol violation. STOP and create a Dev agent instead."

3. Add delegation reminders (1-2 lines each):
   - After Step 3c heading: "**LEAD ROLE CHECK:** You are the orchestrator. Do NOT edit SUMMARY files yourself — Dev agents write them."
   - After Step 3d heading: "**LEAD ROLE CHECK:** QA is agent-based. Do NOT self-review or skip the QA agent spawn."
   - At Step 5: "**LEAD ROLE CHECK:** State updates only. You MUST NOT implement code, write summaries, or perform QA."

**Commit:** `feat(execute-protocol): add step-ordering validation and delegation reinforcement`
