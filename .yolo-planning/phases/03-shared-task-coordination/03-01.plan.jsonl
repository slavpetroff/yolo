{"p":"03","n":"01","t":"Task coordination patterns and schemas","w":1,"d":[],"xd":[{"p":"02","n":"02","a":"references/teammate-api-patterns.md","r":"Existing patterns file to extend with TaskCreate/TaskList/TaskUpdate sections"},{"p":"02","n":"03","a":"references/handoff-schemas.md","r":"Existing schemas file to extend with task coordination message types"}],"mh":{"tr":["TaskCreate maps plan.jsonl tasks to shared task list items with dependency chains from d field","TaskList returns available unblocked tasks filtered by status and assignee","TaskUpdate supports claim (assign to self) and complete (mark done with commit hash) operations","All new schemas have type discriminator matching existing handoff-schemas.md pattern","task_claim and task_complete schemas reference plan_id and task_id fields","td (task_depends) field is optional string[] in Plan Task schema for intra-plan ordering","git-commit-serialized.sh uses flock on .git/yolo-commit.lock with 5-retry exponential backoff","compute-dev-count.sh outputs min(available, 5) with input validation","resolve-task-deps.sh reads plan.jsonl and outputs task execution order JSON, detects circular deps"],"ar":[{"p":"references/teammate-api-patterns.md","pv":"## Task Coordination","c":"new section documenting TaskCreate, TaskList, TaskUpdate patterns for shared task list"},{"p":"references/teammate-api-patterns.md","pv":"## Dynamic Dev Scaling","c":"new section documenting min(available_unblocked_tasks, 5) formula"},{"p":"references/handoff-schemas.md","pv":"task_claim","c":"new schema for Dev claiming a task from shared list"},{"p":"references/handoff-schemas.md","pv":"task_complete","c":"new schema for Dev reporting task completion to Lead"},{"p":"references/handoff-schemas.md","pv":"summary_aggregation","c":"new schema for Lead aggregating Dev results into summary.jsonl"},{"p":"references/artifact-formats.md","pv":"td","c":"Plan Task schema gains optional td (task_depends) field"},{"p":"scripts/git-commit-serialized.sh","pv":"flock","c":"flock-based serialized git commit wrapper with exponential backoff"},{"p":"scripts/compute-dev-count.sh","pv":"min(available, 5)","c":"testable Dev scaling formula script"},{"p":"scripts/resolve-task-deps.sh","pv":"resolve-task-deps","c":"testable task dependency resolution script"}],"kl":[{"fr":"references/teammate-api-patterns.md ## Task Coordination","to":"references/handoff-schemas.md ## task_claim","vi":"patterns reference schemas by type name"},{"fr":"references/teammate-api-patterns.md ## Dynamic Dev Scaling","to":"references/execute-protocol.md Step 6","vi":"scaling formula referenced by implementation step"},{"fr":"references/teammate-api-patterns.md ## Task Coordination","to":"references/artifact-formats.md td field","vi":"task coordination references td field semantics"},{"fr":"scripts/compute-dev-count.sh","to":"references/teammate-api-patterns.md ## Dynamic Dev Scaling","vi":"script is canonical implementation of scaling formula"},{"fr":"scripts/resolve-task-deps.sh","to":"references/artifact-formats.md td field","vi":"script resolves td and d field dependencies"}]},"obj":"Define TaskCreate/TaskList/TaskUpdate patterns for shared task coordination, add task_claim/task_complete/summary_aggregation schemas to handoff-schemas.md, add td field to artifact-formats.md Plan Task schema, create git-commit-serialized.sh and testable helper scripts (REQ-03)","sk":["commit"],"fm":["references/teammate-api-patterns.md","references/handoff-schemas.md","references/artifact-formats.md","scripts/git-commit-serialized.sh","scripts/compute-dev-count.sh","scripts/resolve-task-deps.sh"],"auto":true}
{"id":"T1","tp":"auto","a":"Add ## Task Coordination section to teammate-api-patterns.md documenting TaskCreate for mapping plan.jsonl tasks to shared task list items with dependency chains from plan d field, TaskList for querying available tasks, and TaskUpdate for claiming/completing tasks. Include plan-to-task mapping algorithm. Document file-overlap check algorithm: Lead maintains claimed_files set, tasks whose f field intersects claimed_files are filtered from TaskList results.","f":["references/teammate-api-patterns.md"],"v":"File contains ## Task Coordination section with TaskCreate, TaskList, TaskUpdate subsections and file-overlap algorithm","done":"Task coordination patterns documented with plan-to-task mapping and file-overlap algorithm"}
{"id":"T2","tp":"auto","a":"Add ## Dynamic Dev Scaling section to teammate-api-patterns.md documenting the formula: dev_count = min(available_unblocked_tasks, 5). Include Lead algorithm for computing available tasks, spawning Devs, and monitoring task list for newly unblocked tasks as dependencies complete. Reference scripts/compute-dev-count.sh as canonical implementation.","f":["references/teammate-api-patterns.md"],"v":"File contains ## Dynamic Dev Scaling with min(N,5) formula, Lead monitoring loop, and compute-dev-count.sh reference","done":"Dynamic Dev scaling algorithm documented with max 5 cap and script reference"}
{"id":"T3","tp":"auto","a":"Add ## Task-Level Blocking section to teammate-api-patterns.md documenting how cross-plan task dependencies (from xd field) map to TaskCreate blockedBy parameters at task granularity, not plan granularity. Include td (task_depends) field mapping for intra-plan ordering. Include example: task T2 in plan 03-02 depends on T3 in plan 03-01 completing.","f":["references/teammate-api-patterns.md"],"v":"File contains ## Task-Level Blocking with cross-plan dependency mapping, td field mapping, and example","done":"Task-level blocking documented with cross-plan and intra-plan dependency examples"}
{"id":"T4","tp":"auto","a":"Add task_claim, task_complete, and summary_aggregation schemas to references/handoff-schemas.md following existing pattern (type discriminator, JSON code block, usage notes). task_claim: Dev claims task from shared list. task_complete: Dev reports task done with commit hash. summary_aggregation: Lead collects all task_complete messages for a plan and writes summary.jsonl.","f":["references/handoff-schemas.md"],"v":"File contains task_claim, task_complete, and summary_aggregation schema sections","done":"Three new schemas added matching existing handoff-schemas.md pattern"}
{"id":"T5","tp":"auto","a":"Add td (task_depends) field to references/artifact-formats.md Plan Task schema table. Type: optional string[] referencing task IDs within the same plan (e.g., [\"T1\", \"T3\"]). Document semantics: intra-plan task ordering only, maps to TaskCreate blockedBy parameter. When absent, all tasks in a plan are independent (current behavior preserved). Cross-plan dependencies use the existing plan-level d field. (D4, C4)","f":["references/artifact-formats.md"],"v":"Plan Task schema table contains td row with type string[], description of intra-plan ordering","done":"td field added to Plan Task schema in artifact-formats.md"}
{"id":"T6","tp":"auto","a":"Create scripts/git-commit-serialized.sh: flock-based serialized git commit wrapper. Uses flock(1) on .git/yolo-commit.lock for exclusive locking. Accepts same arguments as git commit (staged files must be pre-staged by caller). 5 retries with exponential backoff starting at 200ms (200, 400, 800, 1600, 3200ms). Returns commit hash on stdout on success, exits non-zero after all retries exhausted. Detect flock availability at start; fall back to mkdir-based advisory lock if flock missing. Include inline usage documentation and set -euo pipefail. (D5, C5)","f":["scripts/git-commit-serialized.sh"],"v":"Script exists, is executable, uses flock or mkdir fallback, has 5-retry backoff logic, outputs commit hash","done":"git-commit-serialized.sh created with flock serialization and exponential backoff"}
{"id":"T7","tp":"auto","a":"Create scripts/compute-dev-count.sh: accepts --available N argument, outputs min(N, 5) as integer. Validate input (non-negative integer, error on negative or non-numeric). Exit 0 on success. Create scripts/resolve-task-deps.sh: accepts --plan path/to/plan.jsonl and optional --all-plans dir/, reads plan.jsonl tasks, resolves td (intra-plan) and d (cross-plan) dependencies, outputs JSON task execution order on stdout. Detects circular dependencies and exits 1 with error message. Both scripts use set -euo pipefail. (D9, C9)","f":["scripts/compute-dev-count.sh","scripts/resolve-task-deps.sh"],"v":"Both scripts exist, are executable. compute-dev-count.sh: --available 3 outputs 3, --available 10 outputs 5. resolve-task-deps.sh: reads plan.jsonl and outputs ordered JSON","done":"compute-dev-count.sh and resolve-task-deps.sh created as testable helper scripts"}
