{"p":"03","n":"05","t":"Tests for parallel execution patterns","w":4,"d":["03-01","03-02","03-03","03-04"],"xd":[],"mh":{"tr":["Static tests verify all modified agent files (including FE/UX Dev and Lead) contain new sections with correct guards","Unit tests verify task coordination pattern documentation completeness","Unit tests verify execute-protocol parallel dispatch documentation for both Step 4 and Step 7","Behavioral tests verify compute-dev-count.sh edge cases (0, 1, 5, 10, negative)","Behavioral tests verify resolve-task-deps.sh (chain, parallel, mixed, circular detection)","Behavioral tests verify file-overlap detection logic and git-commit-serialized.sh lock behavior","All existing 988+ tests pass unchanged","New test files follow existing BATS patterns from tests/ directory"],"ar":[{"p":"tests/static/agent-task-coordination.bats","pv":"@test.*Task Self-Claiming","c":"static test verifying Dev agent has task self-claiming section"},{"p":"tests/static/agent-task-coordination.bats","pv":"@test.*Summary Aggregation","c":"static test verifying Lead agent has summary aggregation section"},{"p":"tests/static/agent-task-coordination.bats","pv":"@test.*FE.*Task Self-Claiming","c":"static test verifying FE Dev agent has task self-claiming section"},{"p":"tests/static/agent-task-coordination.bats","pv":"@test.*UX.*Task Self-Claiming","c":"static test verifying UX Dev agent has task self-claiming section"},{"p":"tests/static/agent-task-coordination.bats","pv":"@test.*FE.*Summary Aggregation","c":"static test verifying FE Lead agent has summary aggregation section"},{"p":"tests/static/agent-task-coordination.bats","pv":"@test.*UX.*Summary Aggregation","c":"static test verifying UX Lead agent has summary aggregation section"},{"p":"tests/unit/task-coordination-patterns.bats","pv":"@test.*TaskCreate","c":"unit test verifying teammate-api-patterns.md has TaskCreate documentation"},{"p":"tests/unit/execute-protocol-parallel.bats","pv":"@test.*parallel.*Senior","c":"unit test verifying execute-protocol Step 4 has parallel Senior dispatch"},{"p":"tests/unit/execute-protocol-parallel.bats","pv":"@test.*Step 7.*parallel","c":"unit test verifying execute-protocol Step 7 has parallel Senior dispatch"},{"p":"tests/unit/execute-protocol-parallel.bats","pv":"@test.*parallel.*Dev","c":"unit test verifying execute-protocol Step 6 has parallel Dev dispatch"},{"p":"tests/behavioral/compute-dev-count.bats","pv":"@test.*0 tasks","c":"behavioral test for compute-dev-count.sh with 0 input"},{"p":"tests/behavioral/resolve-task-deps.bats","pv":"@test.*circular","c":"behavioral test for resolve-task-deps.sh circular dep detection"},{"p":"tests/behavioral/file-overlap-serialized-commit.bats","pv":"@test.*file.overlap","c":"behavioral test for file-overlap detection logic"}],"kl":[{"fr":"tests/static/agent-task-coordination.bats","to":"agents/yolo-dev.md","vi":"test checks for Task Self-Claiming section"},{"fr":"tests/static/agent-task-coordination.bats","to":"agents/yolo-fe-dev.md","vi":"test checks FE Dev Task Self-Claiming section"},{"fr":"tests/static/agent-task-coordination.bats","to":"agents/yolo-fe-lead.md","vi":"test checks FE Lead Summary Aggregation section"},{"fr":"tests/unit/execute-protocol-parallel.bats","to":"references/execute-protocol.md","vi":"test checks for parallel dispatch documentation in Step 4, 6, and 7"},{"fr":"tests/behavioral/compute-dev-count.bats","to":"scripts/compute-dev-count.sh","vi":"behavioral test exercises script directly"},{"fr":"tests/behavioral/resolve-task-deps.bats","to":"scripts/resolve-task-deps.sh","vi":"behavioral test exercises script directly"},{"fr":"tests/behavioral/file-overlap-serialized-commit.bats","to":"scripts/git-commit-serialized.sh","vi":"behavioral test verifies lock file and retry behavior"}]},"obj":"Write BATS tests validating all Phase 3 artifacts: agent task coordination sections (including FE/UX), teammate-api-patterns documentation, execute-protocol parallel dispatch for Steps 4/6/7, and behavioral tests for compute-dev-count.sh, resolve-task-deps.sh, file-overlap detection, and git-commit-serialized.sh (REQ-03)","sk":["commit"],"fm":["tests/static/agent-task-coordination.bats","tests/unit/task-coordination-patterns.bats","tests/unit/execute-protocol-parallel.bats","tests/behavioral/compute-dev-count.bats","tests/behavioral/resolve-task-deps.bats","tests/behavioral/file-overlap-serialized-commit.bats"],"auto":true}
{"id":"T1","tp":"auto","a":"Create tests/static/agent-task-coordination.bats with static validation tests: (1) yolo-dev.md contains Task Self-Claiming section with team_mode=teammate guard, (2) yolo-lead.md contains Summary Aggregation section with team_mode=teammate guard, (3) yolo-senior.md contains Parallel Review section covering Step 4 and Step 7, (4) yolo-fe-senior.md and yolo-ux-senior.md contain Parallel Review sections, (5) yolo-fe-dev.md contains Task Self-Claiming with team_mode guard (C1), (6) yolo-ux-dev.md contains Task Self-Claiming with team_mode guard (C1), (7) yolo-fe-lead.md contains Summary Aggregation with team_mode guard (C1), (8) yolo-ux-lead.md contains Summary Aggregation with team_mode guard (C1), (9) all new sections reference teammate-api-patterns.md. Follow pattern from tests/static/agent-teammate-sections.bats.","f":["tests/static/agent-task-coordination.bats"],"v":"bats tests/static/agent-task-coordination.bats passes with all assertions including FE/UX checks","done":"Static agent task coordination tests created covering all departments","spec":"Create new file: tests/static/agent-task-coordination.bats. Follow the exact pattern from tests/static/agent-teammate-sections.bats (lines 1-87). Structure: (1) Shebang: #!/usr/bin/env bats. (2) Comment: '# agent-task-coordination.bats -- Static validation: Phase 3 task coordination sections in agent files'. (3) setup() function: load '../test_helper/common' (same as agent-teammate-sections.bats line 6). No fixtures needed -- reads real agent files via $AGENTS_DIR. (4) Tests using @test annotation and grep pattern matching against $AGENTS_DIR/{agent}.md files: Test 1: '@test \"yolo-dev.md contains ## Task Self-Claiming section\"' -- run grep -c '## Task Self-Claiming' \"$AGENTS_DIR/yolo-dev.md\" and assert match >= 1. Test 2: '@test \"yolo-dev.md Task Self-Claiming has team_mode=teammate guard\"' -- run grep 'team_mode=teammate' after grep '## Task Self-Claiming' or just grep -A5 'Task Self-Claiming' and verify team_mode=teammate appears. Test 3: '@test \"yolo-dev.md references git-commit-serialized.sh\"' -- grep 'git-commit-serialized.sh' in yolo-dev.md. Test 4: '@test \"yolo-dev.md Stage 3 Override skips summary.jsonl in teammate mode\"' -- grep -E 'SKIP.*Stage 3|Stage 3.*Override|skip.*summary.jsonl' in yolo-dev.md (use grep -E for extended regex alternation instead of backslash-pipe). Test 5: '@test \"yolo-lead.md contains ## Summary Aggregation section\"' -- grep '## Summary Aggregation'. Test 6: '@test \"yolo-lead.md Summary Aggregation has team_mode=teammate guard\"' -- grep team_mode=teammate near Summary Aggregation. Test 7: '@test \"yolo-lead.md documents claimed_files for file-overlap detection\"' -- grep 'claimed_files' in yolo-lead.md. Test 8: '@test \"yolo-senior.md contains ## Parallel Review section\"' -- grep '## Parallel Review'. Test 9: '@test \"yolo-senior.md Parallel Review covers Step 4 and Step 7\"' -- grep -E -c 'Step 4|Design Review' in Parallel Review section and grep -E 'Step 7|Code Review' (use grep -E for alternation). Test 10: '@test \"yolo-fe-senior.md contains ## Parallel Review section\"'. Test 11: '@test \"yolo-ux-senior.md contains ## Parallel Review section\"'. Test 12: '@test \"yolo-fe-dev.md contains ## Task Self-Claiming section\"'. Test 13: '@test \"yolo-fe-dev.md Task Self-Claiming references FE Senior\"' -- grep 'FE Senior' near Task Self-Claiming. Test 14: '@test \"yolo-ux-dev.md contains ## Task Self-Claiming section\"'. Test 15: '@test \"yolo-ux-dev.md Task Self-Claiming references UX Senior\"' -- grep 'UX Senior' near Task Self-Claiming. Test 16: '@test \"yolo-fe-lead.md contains ## Summary Aggregation section\"'. Test 17: '@test \"yolo-ux-lead.md contains ## Summary Aggregation section\"'. Test 18: '@test \"yolo-fe-lead.md Summary Aggregation documents claimed_files\"' -- grep 'claimed_files'. Test 19: '@test \"yolo-ux-lead.md Summary Aggregation documents claimed_files\"' -- grep 'claimed_files'. Test 20: '@test \"all task coordination sections reference teammate-api-patterns.md\"' -- for each of the 9 agent files, verify grep 'teammate-api-patterns.md' finds a match. Use assert_success / assert_failure from bats-assert loaded by common.bash. Pattern: run grep -c 'PATTERN' \"$AGENTS_DIR/file.md\" followed by assert_success and [[ \"$output\" -ge 1 ]] || fail \"message\".","ts":"Tests are self-validating (static checks against real files). No mock needed. Run: bats tests/static/agent-task-coordination.bats. All 20 tests should pass if Plans 03-01 and 03-02 tasks are implemented correctly."}
{"id": "T2", "tp": "auto", "a": "Create tests/unit/task-coordination-patterns.bats with unit tests verifying teammate-api-patterns.md content: (1) Task Coordination section exists with TaskCreate, TaskList, TaskUpdate subsections, (2) Dynamic Dev Scaling section exists with min(N,5) formula, (3) Task-Level Blocking section exists with cross-plan dependency example, (4) handoff-schemas.md contains task_claim, task_complete, summary_aggregation schemas.", "f": ["tests/unit/task-coordination-patterns.bats"], "v": "bats tests/unit/task-coordination-patterns.bats passes with all assertions", "done": "Task coordination pattern documentation tests created and passing", "spec": "Create new file: tests/unit/task-coordination-patterns.bats. Structure: (1) Shebang: #!/usr/bin/env bats. (2) Comment: '# task-coordination-patterns.bats -- Unit tests for Phase 3 documentation in reference files'. (3) setup() function: load '../test_helper/common'. Define local vars: PATTERNS_FILE=\"$PROJECT_ROOT/references/teammate-api-patterns.md\" and SCHEMAS_FILE=\"$PROJECT_ROOT/references/handoff-schemas.md\" and FORMATS_FILE=\"$PROJECT_ROOT/references/artifact-formats.md\". (4) Tests: Test 1: '@test \"teammate-api-patterns.md contains ## Task Coordination section\"' -- grep '## Task Coordination' \"$PATTERNS_FILE\". Test 2: '@test \"Task Coordination contains TaskCreate subsection\"' -- grep '### TaskCreate or TaskCreate (use grep -E for alternation)' after Task Coordination heading. Test 3: '@test \"Task Coordination contains TaskList subsection\"' -- grep 'TaskList'. Test 4: '@test \"Task Coordination contains TaskUpdate subsection\"' -- grep 'TaskUpdate'. Test 5: '@test \"Task Coordination documents file-overlap algorithm\"' -- grep 'claimed_files or file.overlap (use grep -E)' \"$PATTERNS_FILE\". Test 6: '@test \"teammate-api-patterns.md contains ## Dynamic Dev Scaling section\"' -- grep '## Dynamic Dev Scaling'. Test 7: '@test \"Dynamic Dev Scaling contains min formula\"' -- grep 'min.*available.*5 or min(available (use grep -E)' \"$PATTERNS_FILE\". Test 8: '@test \"Dynamic Dev Scaling references compute-dev-count.sh\"' -- grep 'compute-dev-count.sh' \"$PATTERNS_FILE\". Test 9: '@test \"teammate-api-patterns.md contains ## Task-Level Blocking section\"' -- grep '## Task-Level Blocking'. Test 10: '@test \"Task-Level Blocking documents td field\"' -- grep 'td or task_depends (use grep -E)' in Task-Level Blocking section. Test 11: '@test \"handoff-schemas.md contains task_claim schema\"' -- grep 'task_claim' \"$SCHEMAS_FILE\". Test 12: '@test \"handoff-schemas.md contains task_complete schema\"' -- grep 'task_complete' \"$SCHEMAS_FILE\". Test 13: '@test \"handoff-schemas.md contains summary_aggregation schema\"' -- grep 'summary_aggregation' \"$SCHEMAS_FILE\". Test 14: '@test \"artifact-formats.md contains td field in Plan Task table\"' -- grep 'td.*task_depends\\|`td`' \"$FORMATS_FILE\".", "ts": "Tests are self-validating (documentation content checks). Run: bats tests/unit/task-coordination-patterns.bats. All 14 tests pass if Plan 03-01 tasks are implemented correctly."}
{"id": "T3", "tp": "auto", "a": "Create tests/unit/execute-protocol-parallel.bats with unit tests verifying execute-protocol.md parallel dispatch: (1) Step 4 contains team_mode conditional for parallel Senior dispatch, (2) Step 4 contains 2+ plan threshold note (D11), (3) Step 6 contains TaskCreate mapping for parallel Dev dispatch, (4) Step 6 contains dynamic Dev scaling formula, (5) Step 6 documents Lead summary aggregation, (6) Step 6 documents task-level blocking, (7) Step 7 contains team_mode conditional for parallel Senior dispatch (C2), (8) Step 7 contains 2+ plan threshold note (D11), (9) Step 7 exit gate references code-review.jsonl r:approve.", "f": ["tests/unit/execute-protocol-parallel.bats"], "v": "bats tests/unit/execute-protocol-parallel.bats passes with all assertions including Step 7 checks", "done": "Execute protocol parallel dispatch tests created covering Steps 4, 6, and 7", "spec": "Create new file: tests/unit/execute-protocol-parallel.bats. Structure: (1) Shebang: #!/usr/bin/env bats. (2) Comment: '# execute-protocol-parallel.bats -- Unit tests for Phase 3 parallel dispatch in execute-protocol.md'. (3) setup() function: load '../test_helper/common'. Define: PROTOCOL_FILE=\"$PROJECT_ROOT/references/execute-protocol.md\". (4) Tests -- all use grep against $PROTOCOL_FILE: Test 1: '@test \"Step 4 contains team_mode conditional for parallel Senior dispatch\"' -- grep 'team_mode.*teammate' after 'Step 4' heading, or grep across broader range. Use: run grep -c 'team_mode=teammate' \"$PROTOCOL_FILE\" and verify count is at least 3 (Step 4 + Step 6 + Step 7). Test 2: '@test \"Step 4 documents 2+ plan threshold for parallel dispatch\"' -- grep '2+.*plan or 2 or more plans or wave has 2 (use grep -E alternation)' \"$PROTOCOL_FILE\". Test 3: '@test \"Step 4 documents parallel Senior dispatch\"' -- grep 'concurrent.*Senior or parallel.*Senior or Dispatch Senior.*concurrently (use grep -E)' \"$PROTOCOL_FILE\". Test 4: '@test \"Step 6 documents TaskCreate mapping\"' -- grep 'TaskCreate.*mapping or TaskCreate.*plan (use grep -E)' \"$PROTOCOL_FILE\". Test 5: '@test \"Step 6 documents dynamic Dev scaling formula\"' -- grep 'min.*available.*5 or compute-dev-count (use grep -E)' \"$PROTOCOL_FILE\". Test 6: '@test \"Step 6 documents Lead summary aggregation\"' -- grep -E 'Lead.*aggregat|summary.*aggregat' \"$PROTOCOL_FILE\". Test 7: '@test \"Step 6 documents task-level blocking via td field\"' -- grep -E 'td.*task_depends|task.level.*block|task-level.*block' \"$PROTOCOL_FILE\". Test 8: '@test \"Step 6 documents file-overlap enforcement\"' -- grep -E 'file.overlap|claimed_files' \"$PROTOCOL_FILE\". Test 9: '@test \"Step 6 documents serialized commits\"' -- grep 'git-commit-serialized' \"$PROTOCOL_FILE\". Test 10: '@test \"Step 6 documents summary.jsonl ownership split\"' -- grep -E 'summary.jsonl.*ownership|sole writer|SOLE writer' \"$PROTOCOL_FILE\". Test 11: '@test \"Step 7 contains team_mode conditional for parallel Senior dispatch\"' -- This is trickier since we need to verify the Step 7 section specifically contains it. Use: run bash -c 'sed -n \"/### Step 7/,/### Step 8/p\" \"$PROTOCOL_FILE\" | grep -c \"team_mode\"' and verify count >= 1. Or simpler: just verify overall team_mode mentions increased. Test 12: '@test \"Step 7 documents 2+ plan threshold\"' -- grep '2+.*plan' in Step 7 section. Test 13: '@test \"Step 7 exit gate references code-review.jsonl r:approve\"' -- grep -E 'code-review.jsonl.*approve|r:.*approve' in Step 7 section.", "ts": "Tests are self-validating (documentation content checks against execute-protocol.md). Run: bats tests/unit/execute-protocol-parallel.bats. All 13 tests pass if Plans 03-03 and 03-04 are implemented correctly."}
{"id":"T4","tp":"auto","a":"Run full test suite (bats tests/) to verify all existing 988+ tests still pass unchanged alongside new tests (T1-T3 static/unit + T5-T7 behavioral). Fix any regressions found. Validate serialized commit script does not affect normal (non-parallel) git operations.","f":[],"v":"Full test suite passes with 0 failures; test count >= 988 + new tests from T1-T3 + T5-T7","done":"Full test suite green with no regressions, all new tests passing","spec":"Run command: bats tests/ (from project root /Users/slavpetroff/Projects/yolo). This runs ALL test files in tests/static/, tests/unit/, and tests/behavioral/ directories. Expected outcome: (1) All existing 988+ tests pass unchanged (no regressions from Phase 3 documentation changes). (2) New static tests from T1 (tests/static/agent-task-coordination.bats) pass -- 20 tests. (3) New unit tests from T2 (tests/unit/task-coordination-patterns.bats) pass -- 14 tests. (4) New unit tests from T3 (tests/unit/execute-protocol-parallel.bats) pass -- 13 tests. (5) New behavioral tests from T5 (tests/behavioral/compute-dev-count.bats) pass -- 8 tests. (6) New behavioral tests from T6 (tests/behavioral/resolve-task-deps.bats) pass -- 6 tests. (7) New behavioral tests from T7 (tests/behavioral/file-overlap-serialized-commit.bats) pass -- 5 tests. Total new tests: ~66. If any test fails: (a) If it is an existing test that broke due to Phase 3 changes: this is a regression -- fix the root cause (likely a doc change that shifted grep patterns). (b) If it is a new test that fails: verify the corresponding implementation task produced the expected content. Also: verify scripts/git-commit-serialized.sh does not interfere with normal git operations by checking that a simple 'git commit --allow-empty -m test' still works after the script exists (the lock file .git/yolo-commit.lock should not prevent normal git commits). The behavioral directory must be created first (mkdir -p tests/behavioral) if it does not exist.","ts":""}
{"id":"T5","tp":"auto","a":"Create tests/behavioral/compute-dev-count.bats with behavioral tests exercising scripts/compute-dev-count.sh directly: (1) --available 0 outputs 0 devs, (2) --available 1 outputs 1 dev, (3) --available 5 outputs 5 devs, (4) --available 10 outputs 5 devs (cap), (5) --available 3 outputs 3 devs, (6) negative input returns error exit code, (7) non-numeric input returns error exit code, (8) missing --available flag returns error. (D9, C9)","f":["tests/behavioral/compute-dev-count.bats"],"v":"bats tests/behavioral/compute-dev-count.bats passes with all 8 edge case assertions","done":"compute-dev-count.sh behavioral tests created covering all edge cases","spec":"Create new file: tests/behavioral/compute-dev-count.bats. Create directory tests/behavioral/ first (mkdir -p). Structure: (1) Shebang: #!/usr/bin/env bats. (2) Comment: '# compute-dev-count.bats -- Behavioral tests for scripts/compute-dev-count.sh'. (3) setup() function: load '../test_helper/common'. Define: SUT=\"$SCRIPTS_DIR/compute-dev-count.sh\". (4) Tests using 'run bash \"$SUT\" [args]' pattern (same as dept-orchestrate-teammate.bats): Test 1: '@test \"--available 0 outputs 0\"' -- run bash \"$SUT\" --available 0; assert_success; assert_output '0'. Test 2: '@test \"--available 1 outputs 1\"' -- run bash \"$SUT\" --available 1; assert_success; assert_output '1'. Test 3: '@test \"--available 5 outputs 5\"' -- run bash \"$SUT\" --available 5; assert_success; assert_output '5'. Test 4: '@test \"--available 10 outputs 5 (cap at max)\"' -- run bash \"$SUT\" --available 10; assert_success; assert_output '5'. Test 5: '@test \"--available 3 outputs 3\"' -- run bash \"$SUT\" --available 3; assert_success; assert_output '3'. Test 6: '@test \"negative input returns error\"' -- run bash \"$SUT\" --available -1; assert_failure. Test 7: '@test \"non-numeric input returns error\"' -- run bash \"$SUT\" --available abc; assert_failure. Test 8: '@test \"missing --available flag returns error\"' -- run bash \"$SUT\"; assert_failure. Use assert_success, assert_failure, assert_output from bats-assert (loaded via common.bash).","ts":"Tests exercise the script directly. No mocks needed. Run: bats tests/behavioral/compute-dev-count.bats. All 8 pass if scripts/compute-dev-count.sh from Plan 03-01 T7 is correct."}
{"id":"T6","tp":"auto","a":"Create tests/behavioral/resolve-task-deps.bats with behavioral tests exercising scripts/resolve-task-deps.sh directly: (1) linear chain T1->T2->T3 outputs correct order, (2) parallel tasks (no td) outputs all tasks as available, (3) mixed deps (some td, some independent) outputs correct partial order, (4) circular dep T1->T2->T1 exits 1 with error message, (5) plan-level d field resolution across multiple plans with --all-plans flag, (6) empty plan (header only, no tasks) outputs empty order. (D9, C9)","f":["tests/behavioral/resolve-task-deps.bats"],"v":"bats tests/behavioral/resolve-task-deps.bats passes with all 6 assertions including circular dep detection","done":"resolve-task-deps.sh behavioral tests created covering chain, parallel, mixed, and circular deps","spec":"Create new file: tests/behavioral/resolve-task-deps.bats. Structure: (1) Shebang: #!/usr/bin/env bats. (2) Comment: '# resolve-task-deps.bats -- Behavioral tests for scripts/resolve-task-deps.sh'. (3) setup() function: load '../test_helper/common'; load '../test_helper/fixtures'; mk_test_workdir. Define: SUT=\"$SCRIPTS_DIR/resolve-task-deps.sh\". (4) Helper function mk_plan_with_tasks() that creates a plan.jsonl file with a header line and specified task lines. Use jq to construct valid JSONL. Header format: {\"p\":\"01\",\"n\":\"01\",\"t\":\"test\",\"w\":1,\"d\":[],\"mh\":{\"tr\":[],\"ar\":[],\"kl\":[]},\"obj\":\"test\",\"sk\":[],\"fm\":[],\"auto\":true}. Task format: {\"id\":\"T1\",\"tp\":\"auto\",\"a\":\"test\",\"f\":[\"a.sh\"],\"v\":\"ok\",\"done\":\"ok\",\"td\":[]}. (5) Tests: Test 1: '@test \"linear chain T1->T2->T3 outputs correct order\"' -- Create plan with: T1 (no td), T2 (td:[\"T1\"]), T3 (td:[\"T2\"]). Run: run bash \"$SUT\" --plan \"$plan_file\". assert_success. Parse output with jq: group 1 should contain T1, group 2 T2, group 3 T3. Test 2: '@test \"parallel tasks (no td) outputs all as group 1\"' -- Create plan with: T1 (no td), T2 (no td), T3 (no td). All should be in group 1 (parallel). Test 3: '@test \"mixed deps outputs correct partial order\"' -- T1 (no td), T2 (td:[\"T1\"]), T3 (no td). T1 and T3 in group 1, T2 in group 2. Test 4: '@test \"circular dependency exits 1 with error\"' -- T1 (td:[\"T2\"]), T2 (td:[\"T1\"]). run bash \"$SUT\" --plan \"$plan_file\". assert_failure. Verify stderr contains 'Circular' or 'circular'. Test 5: '@test \"cross-plan deps with --all-plans flag\"' -- Create two plan files in a directory. Plan 01-01 with T1, T2. Plan 01-02 with d:[\"01-01\"] and T3, T4. Run with --plan plan2 --all-plans dir/. T3 and T4 should be blocked by T1 and T2 from plan 01-01. Test 6: '@test \"empty plan outputs empty groups\"' -- Create plan with header only, no task lines. assert_success. Output should be empty JSON array or single empty group.","ts":"Tests exercise the script against fixture plan.jsonl files created in temp dirs. Run: bats tests/behavioral/resolve-task-deps.bats. All 6 pass if scripts/resolve-task-deps.sh from Plan 03-01 T7 is correct."}
{"id":"T7","tp":"auto","a":"Create tests/behavioral/file-overlap-serialized-commit.bats with behavioral tests: (1) given plan with T1 (f: [a.sh]) and T2 (f: [a.sh, b.sh]), verify T2 is blocked while T1 executes (file overlap), (2) given T1 (f: [a.sh]) and T2 (f: [b.sh]), verify both are claimable (no overlap), (3) verify scripts/git-commit-serialized.sh creates lock file (.git/yolo-commit.lock) during commit, (4) verify git-commit-serialized.sh retries on lock contention (simulate held lock), (5) verify git-commit-serialized.sh exits non-zero after 5 failed retries. (D5, D8, D9)","f":["tests/behavioral/file-overlap-serialized-commit.bats"],"v":"bats tests/behavioral/file-overlap-serialized-commit.bats passes with all 5 assertions","done":"File-overlap detection and serialized commit behavioral tests created and passing","spec":"Create new file: tests/behavioral/file-overlap-serialized-commit.bats. Structure: (1) Shebang: #!/usr/bin/env bats. (2) Comment: '# file-overlap-serialized-commit.bats -- Behavioral tests for file-overlap detection and git-commit-serialized.sh'. (3) setup() function: load '../test_helper/common'; load '../test_helper/fixtures'; mk_test_workdir. Define: COMMIT_SCRIPT=\"$SCRIPTS_DIR/git-commit-serialized.sh\". (4) Helper function check_file_overlap() that implements the claimed_files algorithm in bash for testing: takes claimed_files array and task_files array, returns 0 if overlap detected, 1 if no overlap. Implementation: for f in task_files; do for c in claimed_files; do if [ \"$f\" = \"$c\" ]; then return 0; fi; done; done; return 1. (5) Tests: Test 1: '@test \"file overlap: T2 blocked when T1 claims shared file\"' -- claimed_files=(a.sh), task_files=(a.sh b.sh). run check_file_overlap. assert_success (overlap detected = T2 blocked). Test 2: '@test \"no file overlap: both tasks claimable with different files\"' -- claimed_files=(a.sh), task_files=(b.sh). run check_file_overlap. assert_failure (no overlap = both claimable). Test 3: '@test \"git-commit-serialized.sh creates lock file during commit\"' -- mk_git_repo. echo 'test' > test.txt && git add test.txt. Run commit script in background, check for .git/yolo-commit.lock existence. The lock file should exist during the commit (may need to check file exists or use flock -n test). Simpler approach: just verify the script runs successfully: run bash \"$COMMIT_SCRIPT\" -m 'test commit'; assert_success. Then verify a commit was made: run git log --oneline -1; assert_output --partial 'test commit'. Test 4: '@test \"git-commit-serialized.sh retries on lock contention\"' -- mk_git_repo. Create the lock by holding it: mkdir .git/yolo-commit.lock.d (simulate mkdir-based lock held). echo 'test' > test2.txt && git add test2.txt. Run commit script with very short timeout (it should retry and eventually fail since lock is held). However, the actual retry involves sleep which is slow. Alternative: run the script in background, release lock after 300ms, verify script succeeds. Simpler: just verify that when lock file directory exists AND is then removed, the script can succeed. For practical testing: hold the lock dir, run script with timeout, verify it retries (check stderr for retry message). Since the test needs to complete fast, use a modified approach: hold the mkdir lock, run the script with a 2-second timeout. Verify it exits non-zero and stderr contains 'retry' or 'lock'. Then release lock. Test 5: '@test \"git-commit-serialized.sh exits non-zero after 5 failed retries\"' -- mk_git_repo. Create and hold the lock permanently: if flock mode, create a background process holding flock; if mkdir mode, create .git/yolo-commit.lock.d and do not remove it. echo 'test3' > test3.txt && git add test3.txt. run bash \"$COMMIT_SCRIPT\" -m 'test3' with a timeout (the script will retry 5 times with backoff totaling ~6.2s). Provide timeout of 10s. assert_failure. Verify exit code is 1. Verify stderr contains 'Could not acquire commit lock' or similar error message. Note: This test will take ~6.2 seconds due to exponential backoff. Clean up the held lock in teardown. Use BATS teardown() function to clean up: teardown() { rmdir \"$TEST_WORKDIR/.git/yolo-commit.lock.d\" 2>/dev/null || true; }.","ts":"Tests exercise file-overlap logic and git-commit-serialized.sh directly. Tests 3-5 require a git repo (use mk_git_repo from fixtures.bash). Test 5 takes ~6s due to retry backoff. Run: bats tests/behavioral/file-overlap-serialized-commit.bats. All 5 pass if scripts/git-commit-serialized.sh from Plan 03-01 T6 is correct."}
