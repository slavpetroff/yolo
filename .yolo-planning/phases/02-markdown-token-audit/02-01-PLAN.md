---
phase: 2
plan: 01
title: "Agent Protocol Consolidation"
wave: 1
depends_on: []
must_haves:
  - REQ-03
  - REQ-04
---

# Plan 01: Agent Protocol Consolidation

Remove duplicated protocol sections from agent files that already exist in `references/agent-base-protocols.md`. Each agent should reference the base protocols file instead of inline copies.

## Task 1: Ensure agent-base-protocols.md covers all four patterns

**Description:** Verify `references/agent-base-protocols.md` contains canonical definitions for Circuit Breaker, Context Injection, Shutdown Handling, and Effort Footer. Currently it covers the first three. Add an Effort section if missing, so agents can reference it.

**Files:** `references/agent-base-protocols.md`

**Commit:** `refactor(2-01): ensure agent-base-protocols covers all shared patterns`

**Verification:** All four patterns (Circuit Breaker, Context Injection, Shutdown Handling, Effort) present in file with full canonical text.

## Task 2: Remove Circuit Breaker duplication from all 8 agents

**Description:** All 8 agent files (`agents/yolo-{dev,qa,debugger,reviewer,lead,architect,docs,researcher}.md`) contain inline Circuit Breaker text. Replace each inline copy with a one-line reference: `Full protocol: references/agent-base-protocols.md`. Keep the `## Circuit Breaker` heading for scanability but reduce body to the reference line.

**Files:** `agents/yolo-dev.md`, `agents/yolo-qa.md`, `agents/yolo-debugger.md`, `agents/yolo-reviewer.md`, `agents/yolo-lead.md`, `agents/yolo-architect.md`, `agents/yolo-docs.md`, `agents/yolo-researcher.md`

**Commit:** `refactor(2-01): deduplicate Circuit Breaker across 8 agent files`

**Verification:** `grep -c "Same error 3" agents/*.md` returns 0 (no inline CB text). Each agent has `## Circuit Breaker` heading with reference line.

## Task 3: Remove Shutdown Handling duplication from 4 agents

**Description:** Four agents (debugger, lead, docs, architect) have inline Shutdown Handling that duplicates `agent-base-protocols.md`. Replace each with a reference line. Note: yolo-architect has a unique override (does not participate in shutdown) -- preserve that override text, just remove the generic parts that match the base protocol.

**Files:** `agents/yolo-debugger.md`, `agents/yolo-lead.md`, `agents/yolo-docs.md`, `agents/yolo-architect.md`

**Commit:** `refactor(2-01): deduplicate Shutdown Handling in 4 agent files`

**Verification:** Generic shutdown text removed. yolo-architect retains its unique exclusion note. Other 3 agents have reference line only.

## Task 4: Remove Context Injection duplication from 3 agents

**Description:** Three agents (dev, debugger, lead) have inline Context Injection blocks that duplicate `agent-base-protocols.md`. Replace each with a reference line under the existing heading.

**Files:** `agents/yolo-dev.md`, `agents/yolo-debugger.md`, `agents/yolo-lead.md`

**Commit:** `refactor(2-01): deduplicate Context Injection in 3 agent files`

**Verification:** Inline "Codebase context prefixed to memory" text removed from all 3. Reference line present.

## Task 5: Remove Effort footer duplication from 5 agents

**Description:** Five agents (qa, reviewer, debugger, docs, architect) have inline Effort sections that follow the same pattern. If Task 1 added an Effort section to base protocols, replace inline copies with reference lines.

**Files:** `agents/yolo-qa.md`, `agents/yolo-reviewer.md`, `agents/yolo-debugger.md`, `agents/yolo-docs.md`, `agents/yolo-architect.md`

**Commit:** `refactor(2-01): deduplicate Effort footer in 5 agent files`

**Verification:** Inline effort text removed. Reference line present. No behavioral change -- agents still follow effort levels from task description.
