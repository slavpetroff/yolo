{"p":"03","n":"03","t":"Agent Tool Permission Adaptation","w":2,"d":["03-02"],"xd":[],"mh":{"tr":["Tool permissions adapt based on detected project type from detect-stack.sh","Shell-only projects disable npm/Docker-related tool patterns","Library projects restrict Bash usage for Dev agents","Default permissions preserved when project type is generic","Existing agent YAML files are not permanently modified (permissions resolved at runtime)"],"ar":[{"p":"config/tool-permissions.json","pv":"file exists and valid JSON","c":"maps project_type -> role -> {allowed_tools, disallowed_tools} overrides"},{"p":"scripts/resolve-tool-permissions.sh","pv":"file exists and is executable","c":"resolves agent tool permissions by merging base YAML permissions with project-type overrides"}],"kl":[{"fr":"config/tool-permissions.json","to":"config/project-types.json","vi":"uses same project type IDs (web-app, api-service, cli-tool, library, mobile-app, monorepo, generic)"},{"fr":"scripts/resolve-tool-permissions.sh","to":"scripts/detect-stack.sh","vi":"reads project_type from detect-stack.sh output to determine overrides"},{"fr":"scripts/resolve-tool-permissions.sh","to":"agents/yolo-dev.md","vi":"augments agent YAML tool lists at spawn time"}]},"obj":"Create project-type-aware tool permission resolution so agents get appropriate tools for the detected project type. REQ-06.","sk":["commit"],"fm":["config/tool-permissions.json","scripts/resolve-tool-permissions.sh","tests/unit/resolve-tool-permissions.bats"],"auto":true}
{"id":"T1","tp":"auto","a":"Create config/tool-permissions.json: maps project type to per-role tool permission overrides. Structure: {types:{web-app:{dev:{add_tools:[],remove_tools:[]},senior:{...}},cli-tool:{dev:{remove_tools:[\"WebSearch\"]},senior:{...}},library:{dev:{remove_tools:[\"Bash\"]}},...}}. Default (generic) has no overrides. cli-tool removes web-related tools. library restricts Bash for Dev. web-app adds no overrides (full toolset). Each role has add_tools and remove_tools arrays. REQ-06.","f":["config/tool-permissions.json"],"v":"jq empty config/tool-permissions.json succeeds; all 7 project types have entries; each entry has role-level overrides","done":"Tool permission config covers all 7 project types with role-level overrides"}
{"id":"T2","tp":"auto","a":"Create scripts/resolve-tool-permissions.sh: resolves final tool permissions for an agent. Input: --role {role} --project-dir {path} [--config {tool-permissions.json}]. Process: (1) call detect-stack.sh to get project_type, (2) read base tools from agent YAML frontmatter, (3) apply project-type overrides from tool-permissions.json (add add_tools, remove remove_tools), (4) output JSON {role:str,project_type:str,tools:[],disallowed_tools:[]}. Uses jq for all merging. REQ-06.","f":["scripts/resolve-tool-permissions.sh"],"v":"Script correctly merges base + override for each project type; generic type returns unchanged base tools","done":"Script resolves tool permissions by merging YAML base with project-type overrides"}
{"id":"T3","tp":"auto","a":"Create tests/unit/resolve-tool-permissions.bats: test suite for tool permission resolution. Tests: generic project returns base tools unchanged, cli-tool removes web tools from dev, library restricts Bash for dev, web-app keeps full toolset, unknown project type falls back to generic, role not in overrides gets base tools, add_tools adds new tools, remove_tools removes existing tools, disallowedTools always includes EnterPlanMode/ExitPlanMode regardless of project type. 9+ tests.","f":["tests/unit/resolve-tool-permissions.bats"],"v":"bats tests/unit/resolve-tool-permissions.bats passes all tests","done":"9+ BATS tests verifying tool permission resolution across project types"}
