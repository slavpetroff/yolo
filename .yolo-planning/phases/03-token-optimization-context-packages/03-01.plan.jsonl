{"p":"03","n":"01","t":"Validation & Generation Script Offloading","w":1,"d":[],"xd":[],"mh":{"tr":["All 3 new scripts exit 0 on valid input and exit 1 on invalid input","Scripts use jq for JSON parsing, never grep/sed on JSON","Scripts are bash 3.2 compatible (no associative arrays)","Existing 606 regression tests still pass"],"ar":[{"p":"scripts/validate-plan.sh","pv":"file exists and is executable","c":"validates plan.jsonl structure: header keys, task keys, wave ordering, no circular deps"},{"p":"scripts/validate-gates.sh","pv":"file exists and is executable","c":"checks entry/exit gate artifacts per execute-protocol verification gate contract"},{"p":"scripts/generate-execution-state.sh","pv":"file exists and is executable","c":"generates initial .execution-state.json from plan.jsonl files in phase dir"}],"kl":[{"fr":"scripts/validate-plan.sh","to":"references/artifact-formats.md","vi":"validates against JSONL key dictionary"},{"fr":"scripts/validate-gates.sh","to":"references/execute-protocol.md","vi":"checks gate artifacts from enforcement contract table"},{"fr":"scripts/generate-execution-state.sh","to":"references/execute-protocol.md","vi":"generates state schema from Step 3 item 7"}]},"obj":"Create 3 new shell scripts that offload validation and generation work from LLM calls to deterministic bash+jq scripts. REQ-04.","sk":["commit"],"fm":["scripts/validate-plan.sh","scripts/validate-gates.sh","scripts/generate-execution-state.sh","tests/unit/validate-plan.bats","tests/unit/validate-gates.bats","tests/unit/generate-execution-state.bats"],"auto":true}
{"id":"T1","tp":"auto","a":"Create scripts/validate-plan.sh: validates plan.jsonl structure. Checks: line 1 has required header keys (p,n,t,w,d,mh,obj), lines 2+ have required task keys (id,tp,a,f,v,done), wave ordering is valid (no task depends on same-or-higher wave), no circular dependencies in d field, all file paths in f are relative. Input: path to plan.jsonl. Output: JSON {valid:bool,errors:[]}. REQ-04.","f":["scripts/validate-plan.sh"],"v":"bash scripts/validate-plan.sh tests/fixtures/valid-plan.jsonl exits 0; bash scripts/validate-plan.sh tests/fixtures/invalid-plan.jsonl exits 1 with error details","done":"Script validates plan.jsonl structure with clear error messages"}
{"id":"T2","tp":"auto","a":"Create scripts/validate-gates.sh: validates verification gate artifacts for a given step. Input: --step {step_name} --phase-dir {path}. Checks entry artifact existence per execute-protocol.md enforcement contract table. Also checks skip status in .execution-state.json. Output: JSON {gate:pass|fail,step:str,missing:[]}. Covers all 10 steps. REQ-04.","f":["scripts/validate-gates.sh"],"v":"Script correctly identifies missing artifacts for each step; correctly handles skipped steps","done":"Script validates all 10 entry gates with correct artifact paths"}
{"id":"T3","tp":"auto","a":"Create scripts/generate-execution-state.sh: generates initial .execution-state.json from plan.jsonl files in a phase directory. Input: --phase-dir {path} --phase {N}. Scans *.plan.jsonl, extracts plan metadata (id, title, wave), builds the full state schema from execute-protocol.md Step 3 item 7. Output: writes .execution-state.json to phase dir. REQ-04.","f":["scripts/generate-execution-state.sh"],"v":"Generated state.json has correct schema with all 10 step entries, plan list matches *.plan.jsonl files","done":"Script generates valid execution state JSON from phase plan files"}
{"id":"T4","tp":"auto","a":"Create BATS test suites for all 3 scripts: tests/unit/validate-plan.bats (8+ tests: valid plan, missing header keys, missing task keys, circular deps, invalid wave ordering, empty file, non-jsonl input, multiple plans), tests/unit/validate-gates.bats (8+ tests: each step gate pass/fail, skipped step handling, missing state file), tests/unit/generate-execution-state.bats (6+ tests: single plan, multiple plans, wave ordering, resume state, empty dir, existing state).","f":["tests/unit/validate-plan.bats","tests/unit/validate-gates.bats","tests/unit/generate-execution-state.bats"],"v":"All tests pass with bats tests/unit/validate-plan.bats && bats tests/unit/validate-gates.bats && bats tests/unit/generate-execution-state.bats","done":"22+ BATS tests covering all 3 new scripts, all green"}
