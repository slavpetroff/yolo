---
phase: 4
plan: 1
title: "Agent spawn and gate enforcement integration tests"
wave: 1
depends_on: []
must_haves:
  - Tests verify reviewer agent spawn text exists in Step 2b of SKILL.md
  - Tests verify QA agent spawn text exists in Step 3d of SKILL.md
  - Tests verify feedback loop text for both review and QA gates
  - Tests verify delegation mandate reminders at Steps 3c, 3d, and 5
  - All existing tests still pass
---

### Task 1: Add agent spawn and gate enforcement tests

**Files:** `tests/workflow-integrity.bats`

Create a new bats test file `tests/workflow-integrity.bats` with static grep tests against `skills/execute-protocol/SKILL.md`:

**Reviewer agent spawn tests (Step 2b):**
- `subagent_type: "yolo:yolo-reviewer"` appears at least 2 times (initial + re-review)
- `Stage 2` reviewer section header exists
- Reviewer verdict parsing text exists

**QA agent spawn tests (Step 3d):**
- `subagent_type: "yolo:yolo-qa"` appears at least 2 times (initial + re-verification)
- `Stage 2` QA agent section header exists
- Fast-path optimization text exists (`Fast-path` or `CLI all-pass`)
- QA report parsing text exists

**Feedback loop text tests:**
- Review gate activation text exists
- QA gate activation text exists
- Review feedback loop cycle text exists
- QA feedback loop / remediation cycle text exists

**Delegation mandate tests:**
- `Role reminder:` appears at least 3 times (Steps 3c, 3d, 5)
- Anti-takeover language exists in delegation directive
- `NEVER implement tasks yourself` or equivalent exists

Use Pattern A (static grep, no setup needed). Load `test_helper`. All tests use `$PROJECT_ROOT/skills/execute-protocol/SKILL.md` as target.

**Commit:** `test(integration): add agent spawn and gate enforcement tests`
