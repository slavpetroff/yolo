{"p":"02","n":"03","t":"Protocol updates: go.md and execute-protocol teammate dispatch for multi-dept","w":2,"d":["02-01","02-02"],"xd":[{"p":"01","n":"03","a":"commands/go.md","r":"Phase 1 added team_mode context and spawn routing; Phase 2 extends multi-dept dispatch"},{"p":"01","n":"03","a":"references/execute-protocol.md","r":"Phase 1 added spawn strategy paragraph; Phase 2 updates multi-dept section"},{"p":"01","n":"03","a":"references/cross-team-protocol.md","r":"Phase 1 added transport differences table; Phase 2 refines teammate notes"}],"mh":{"tr":["go.md multi-dept execute path creates one spawnTeam per active department when team_mode=teammate","execute-protocol.md multi-dept section documents spawnTeam per department with Lead as team lead","cross-team-protocol.md teammate mode notes for all gates are consistent with Phase 2 agent roster","All protocol changes are conditional on team_mode=teammate; task mode unchanged"],"ar":[{"p":"commands/go.md","pv":"spawnTeam","c":"multi-dept execute path with spawnTeam per department when team_mode=teammate"},{"p":"references/execute-protocol.md","pv":"tester.*teammate|qa.*teammate","c":"multi-dept section includes tester/qa/qa-code/security teammate registration"},{"p":"references/cross-team-protocol.md","pv":"tester|qa.*SendMessage","c":"transport differences table updated to include tester/qa/security paths"}],"kl":[{"fr":"commands/go.md multi-dept teammate","to":"references/execute-protocol.md multi-dept teammate","vi":"go.md references execute-protocol for teammate dispatch details"},{"fr":"references/execute-protocol.md multi-dept","to":"references/teammate-api-patterns.md","vi":"execute-protocol references teammate-api-patterns for lifecycle"},{"fr":"references/cross-team-protocol.md","to":"agents/yolo-tester.md ## Teammate API","vi":"transport table paths match agent Teammate API sections"}]},"obj":"Update go.md multi-dept execute path, execute-protocol.md multi-dept section, and cross-team-protocol.md to document full Teammate API dispatch for all Phase 2 agents (REQ-03)","sk":["commit"],"fm":["commands/go.md","references/execute-protocol.md","references/cross-team-protocol.md","references/handoff-schemas.md",".yolo-planning/ROADMAP.md"],"auto":true}
{"id":"T1","tp":"auto","a":"Update go.md multi-dept execute section: when team_mode=teammate, describe spawnTeam creation per active department (up to 3 teams). Each department Lead is team lead. Lead registers all specialists as teammates: architect, senior, dev, tester, qa, qa-code (plus security for backend). Shutdown protocol: Lead sends shutdown_request to all teammates on phase completion. Reference execute-protocol.md for step-by-step details. ALSO: Update ROADMAP.md Phase 2 success criteria (C2 resolution).","f":["commands/go.md",".yolo-planning/ROADMAP.md"],"v":"go.md multi-dept section describes spawnTeam per department with full specialist roster including tester/qa/security AND ROADMAP.md Phase 2 criteria match CONTEXT decisions","done":"go.md multi-dept teammate dispatch updated + ROADMAP.md criteria fixed, committed","spec":"## File 1: commands/go.md\n\n### Section: Mode Plan > Step 6d (Multi-department planning, team mode routing)\nLocate the paragraph at line ~276 starting with '**Team mode routing:**'. Replace the ENTIRE paragraph with:\n\n```\n**Team mode routing:** When `team_mode=teammate`, replace Task tool calls with Teammate API team creation. Each department Lead is spawned as a Teammate API team lead via spawnTeam (team name: `yolo-{dept}`, description: `{Dept} engineering team for phase {N}: {phase-name}`). The Lead then registers its core specialists (architect, senior, dev) as teammates at team creation. Additional specialists are registered on-demand at workflow step boundaries: tester at step 5, qa + qa-code at step 8, security at step 9 (backend team only -- FE/UX teams have no security agent). Full team rosters:\n- **Backend (yolo-backend):** architect, senior, dev, tester, qa, qa-code, security (7 specialists)\n- **Frontend (yolo-frontend):** architect, senior, dev, tester, qa, qa-code (6 specialists)\n- **UI/UX (yolo-uiux):** architect, senior, dev, tester, qa, qa-code (6 specialists)\nShutdown protocol: on phase completion, each Lead sends `shutdown_request` to all registered teammates, waits for `shutdown_response`, then finalizes artifacts. See `references/teammate-api-patterns.md` ## Shutdown Protocol.\nWhen `team_mode=task`, spawn Leads via Task tool as currently documented (no change). Include `team_mode={value}` in every Lead's spawn context so the Lead knows which mode to operate in.\n```\n\n### Section: Mode Execute > Team mode paragraph\nLocate the paragraph at line ~315 starting with '**Team mode:**'. Replace the ENTIRE paragraph with:\n\n```\n**Team mode:** `team_mode` from resolve-team-mode.sh determines agent spawn mechanism. Pass `team_mode` value to execute-protocol.md. When `team_mode=teammate`, top-level agent spawning (go.md -> department Leads) uses Teammate API instead of Task tool. Each department gets one team: yolo-backend, yolo-frontend, yolo-uiux. Department Leads register core specialists (architect, senior, dev) at team creation and additional specialists on-demand: tester at step 5, qa + qa-code at step 8, security at step 9 (backend only). Within-team spawning (Lead -> specialists) uses SendMessage per references/teammate-api-patterns.md. When `team_mode=task`, all spawn behavior is unchanged (Task tool throughout).\n```\n\n### Section: Mode Execute > Multi-department > When team_mode=teammate block\nLocate the block at lines ~329 starting with 'When `team_mode=teammate`:'. Replace the content through 'SendMessage-based status reporting.' with:\n\n```\nWhen `team_mode=teammate`: department Leads are created as Teammate API team leads (replacing background Task subagents). Each Lead creates a team via spawnTeam, registers core specialists (architect, senior, dev) as teammates at creation, then registers additional specialists on-demand at workflow step boundaries: tester at step 5, qa + qa-code at step 8, security at step 9 (backend only). Leads coordinate with their specialists via SendMessage instead of file-based artifacts. Gate satisfaction shifts from file polling (dept-gate.sh) to SendMessage-based status reporting. Shutdown protocol: on phase completion, Lead sends shutdown_request to all teammates, waits for shutdown_response from each. When `team_mode=task`: all multi-department coordination uses file-based gates and Task tool as currently documented.\n```\n\n### Section: Multi-Department Execution > Step 3 > Team mode conditional\nLocate the block at lines ~544-557 (the 'When `team_mode=teammate`:' block inside Step 3). Replace the ENTIRE block from '- **When `team_mode=teammate`:**' through 'See `references/teammate-api-patterns.md` ## Cross-Team Communication.' with:\n\n```\n   - **When `team_mode=teammate`:** Replace Task subagent spawning with Teammate API team creation:\n     ```\n     For each dept in wave.depts:\n       Create team via spawnTeam:\n         - name: \"yolo-{dept}\" (e.g., yolo-backend, yolo-frontend, yolo-uiux)\n         - description: \"{Dept} engineering team for phase {N}: {phase-name}\"\n       Register Lead as team lead (automatic with spawnTeam)\n       Lead registers core specialists (architect, senior, dev) as teammates at creation\n       Lead registers additional specialists on-demand at workflow step boundaries:\n         - Step 5 (test authoring): register tester as teammate\n         - Step 8 (QA): register qa + qa-code as teammates\n         - Step 9 (security): register security as teammate (backend team ONLY)\n       Full team rosters:\n         - Backend (yolo-backend): architect, senior, dev, tester, qa, qa-code, security (7)\n         - Frontend (yolo-frontend): architect, senior, dev, tester, qa, qa-code (6)\n         - UI/UX (yolo-uiux): architect, senior, dev, tester, qa, qa-code (6)\n       Lead coordinates via SendMessage instead of file-based artifacts\n       On completion: Lead sends department_result via SendMessage to go.md\n       Shutdown: Lead sends shutdown_request to all teammates, waits for shutdown_response\n     ```\n     Cross-team coordination between departments still uses file-based handoff artifacts (api-contracts.jsonl, design-handoff.jsonl) because Leads are in DIFFERENT teams. SendMessage only works within a single team. Since each department is its own team, inter-department coordination cannot use SendMessage. This is by design -- it enforces the same strict context isolation that file-based gates provide. See `references/teammate-api-patterns.md` ## Cross-Team Communication.\n```\n\n### Section: Multi-Department Execution > Step 4 > Teammate mode note\nLocate the paragraph at line ~579 starting with '**Teammate mode note:**'. Replace with:\n\n```\n**Teammate mode note:** When `team_mode=teammate`, gate satisfaction shifts from file polling to SendMessage-based status reporting. Department Leads send completion signals via SendMessage to go.md instead of writing sentinel files. The polling loop above applies only to `team_mode=task`. In teammate mode, go.md receives department_result messages asynchronously via teammate message delivery. Cross-department gates (ux-complete, api-contract, all-depts) still use file-based validation via dept-gate.sh because cross-team SendMessage is not possible.\n```\n\n## File 2: .yolo-planning/ROADMAP.md (C2 resolution)\n\nLocate Phase 2 success criteria section (lines 28-35). Replace the two incorrect criteria lines:\n\nOLD (line 32):\n```\n- Inter-department communication uses SendMessage between department Lead teammates (replacing .handoff-* sentinel files and polling loops)\n```\n\nNEW:\n```\n- Inter-department gates remain file-based -- dept-gate.sh and dept-status.sh unchanged (SendMessage is intra-team only, cannot cross team boundaries)\n```\n\nOLD (line 33):\n```\n- dept-gate.sh and dept-status.sh gain --mode=teammate path that reads from Teammate API state instead of .dept-status-*.json files\n```\n\nNEW:\n```\n- All 23 agent files (4 Phase 1 + 19 Phase 2) have Teammate API conditional sections with team_mode=teammate guard\n```\n\nVerification after edits:\n- Line 32 no longer mentions inter-dept SendMessage\n- Line 33 no longer mentions dept-gate.sh --mode=teammate\n- Grep for 'Inter-department gates remain file-based' returns 1 match in ROADMAP.md\n- Grep for 'All 23 agent files' returns 1 match in ROADMAP.md\n- Total Phase 2 success criteria count is unchanged (7 bullet points)","ts":""}
{"id":"T2","tp":"auto","a":"Update execute-protocol.md multi-dept section: expand teammate mode to document tester/qa/qa-code/security registration in each department team. Step 5 (test authoring) registers Tester as teammate. Steps 8-9 (QA, security) register qa/qa-code/security as teammates. Each receives context via SendMessage from Lead. Results sent back via SendMessage instead of file-based handoff within the team.","f":["references/execute-protocol.md"],"v":"execute-protocol multi-dept section lists full teammate registration order including tester/qa/security steps","done":"execute-protocol.md multi-dept teammate steps expanded, committed","spec":"## File: references/execute-protocol.md\n\n### Change 1: Spawn strategy paragraph (line ~7)\nLocate the paragraph starting with '**Spawn strategy:**'. Replace the ENTIRE paragraph with:\n\n```\n**Spawn strategy:** Agent spawning is controlled by `team_mode` from resolve-team-mode.sh (passed by go.md). When `team_mode=task` (default): all agents are spawned via Task tool as documented below. When `team_mode=teammate`: top-level agent spawning from go.md uses Teammate API (spawnTeam for department Leads); within-team spawning (Steps 1-9) is handled by agent prompt conditionals using SendMessage. Teammate registration is on-demand at workflow step boundaries: core specialists (architect, senior, dev) at team creation, tester at step 5, qa + qa-code at step 8, security at step 9 (backend only). See `references/teammate-api-patterns.md` for Teammate API patterns and `references/teammate-api-patterns.md` ## Registering Teammates for step-to-role mapping.\n```\n\n### Change 2: Step 5 (Test Authoring) - add teammate registration note\nLocate Step 5 section (line ~228, '### Step 5: Test Authoring'). After item 2 (compile context line) and before item 3 (spawn yolo-tester), INSERT a new sub-item:\n\n```\n2.5. **Teammate registration (team_mode=teammate only):** Lead registers tester as a teammate in the department team before sending test authoring context. The tester receives the enriched plan.jsonl via SendMessage from Lead (replacing Task tool parameter passing). Tester sends `test_plan_result` back to Senior (NOT Lead) via SendMessage when complete. In task mode, this step is skipped (tester spawned via Task tool as documented below).\n```\n\n### Change 3: Step 8 (QA) - add teammate registration note\nLocate Step 8 section (line ~331, '### Step 8: QA'). After item 2 (tier resolution) and before item 3 (compile context), INSERT a new sub-item:\n\n```\n2.5. **Teammate registration (team_mode=teammate only):** Lead registers qa and qa-code as teammates in the department team. QA Lead receives plan.jsonl + summary.jsonl via SendMessage from Lead. QA Code receives summary.jsonl + test-plan.jsonl via SendMessage. QA Lead sends `qa_result` to Lead via SendMessage. QA Code sends `qa_code_result` to Lead via SendMessage. If QA Code result is PARTIAL/FAIL, QA Code also writes gaps.jsonl as a file artifact (not SendMessage -- it is a persistent artifact for remediation). In task mode, this step is skipped (qa/qa-code spawned via Task tool as documented below).\n```\n\n### Change 4: Step 9 (Security) - add teammate registration note\nLocate Step 9 section (line ~405, '### Step 9: Security Audit'). After item 2 (compile context) and before item 3 (spawn yolo-security), INSERT a new sub-item:\n\n```\n2.5. **Teammate registration (team_mode=teammate only, backend team ONLY):** Lead registers security as a teammate. Security agent exists only in the backend team (yolo-backend) -- FE/UX teams skip this step entirely. Security receives summary.jsonl file list via SendMessage from Lead. Security sends `security_audit` result to Lead via SendMessage. FAIL result is still a hard stop regardless of transport mode. In task mode, this step is skipped (security spawned via Task tool as documented below).\n```\n\n### Change 5: Multi-Department Execution > Per-Department 10-Step section\nLocate the paragraph at line ~490 starting with 'Each department runs the same 10-step workflow'. After the paragraph ending 'Same artifact schemas (plan.jsonl, summary.jsonl, etc.)', ADD a new paragraph:\n\n```\n**Teammate mode per-department 10-step:** When `team_mode=teammate`, the per-department 10-step workflow is identical in logic but uses SendMessage for intra-team coordination instead of Task tool spawning. The Lead creates the team via spawnTeam and registers specialists on-demand:\n- **Team creation:** Lead registers architect, senior, dev as teammates\n- **Step 5:** Lead registers tester as teammate. Tester sends test_plan_result to Senior (not Lead) via SendMessage.\n- **Step 8:** Lead registers qa + qa-code as teammates. Both send results to Lead via SendMessage. QA Code writes gaps.jsonl as file artifact if PARTIAL/FAIL.\n- **Step 9 (backend only):** Lead registers security as teammate. Security sends security_audit to Lead via SendMessage. FE/UX teams skip this step.\n- **Shutdown:** On department completion, Lead sends shutdown_request to all registered teammates. Each teammate commits pending artifacts and sends shutdown_response. Lead then writes .dept-status-{dept}.json (file-based, for cross-department gate) and sends department_result.\nSee `references/teammate-api-patterns.md` ## Team Lifecycle for spawnTeam and shutdown patterns. See ## Registering Teammates for the full step-to-role mapping.\n```\n\n### Change 6: Context Scoping Protocol table - add teammate note\nLocate the table at line ~43 ('| Step | Agent | Receives'). After the table's closing row (Step 9 Security), ADD a note row or paragraph:\n\n```\n**Teammate mode context delivery:** When `team_mode=teammate`, the Receives column content is delivered via SendMessage instead of Task tool parameters. The NEVER pass column restrictions are identical -- SendMessage does not change what context an agent should receive, only how it is delivered. Lead constructs the SendMessage payload with exactly the artifacts listed in Receives for each step.\n```\n\nVerification after edits:\n- Grep for 'Teammate registration.*team_mode=teammate' returns 3 matches (steps 5, 8, 9)\n- Grep for 'tester at step 5.*qa.*step 8.*security.*step 9' returns at least 1 match in the spawn strategy paragraph\n- Grep for 'backend only' appears in Step 9 teammate registration note\n- The document still reads coherently with task mode as the primary flow and teammate mode as additive notes","ts":""}
{"id":"T3","tp":"auto","a":"Update cross-team-protocol.md: expand transport differences table to include all communication paths (Tester->Senior, QA->Lead, QA-Code->Lead, Security->Lead). Add teammate mode notes to Gate 3 (Integration QA) and Gate 4 (Owner Sign-off) confirming file-based gates unchanged. Update Key insight section to mention all agents. ALSO: Fix references/handoff-schemas.md test_plan_result header from 'Tester -> Lead' to 'Tester -> Senior' (C3 resolution).","f":["references/cross-team-protocol.md","references/handoff-schemas.md"],"v":"Transport differences table has rows for Tester->Senior, QA->Lead, Security->Lead paths AND handoff-schemas.md header says 'Tester -> Senior'","done":"cross-team-protocol.md refined with full agent transport paths + handoff-schemas.md fixed, committed","spec":"## File 1: references/cross-team-protocol.md\n\n### Change 1: Transport differences table expansion\nLocate the table at line ~76 ('### Team Mode Transport Differences'). Replace the ENTIRE table (from the header row through the last data row) with this expanded version:\n\n```markdown\n| Communication Path | team_mode=task | team_mode=teammate |\n|---|---|---|\n| Within department: Dev->Senior | Task tool result return | SendMessage within team |\n| Within department: Senior->Lead | Task tool result return | SendMessage within team |\n| Within department: Architect->Lead | Task tool result return | SendMessage within team |\n| Within department: Tester->Senior | Task tool result return | SendMessage (test_plan_result to Senior, NOT Lead) |\n| Within department: QA->Lead | Task tool result return | SendMessage (qa_result to Lead) |\n| Within department: QA-Code->Lead | Task tool result return | SendMessage (qa_code_result to Lead) |\n| Within department: Security->Lead | Task tool result return | SendMessage (security_audit to Lead, backend team ONLY) |\n| Within department: Senior->Dev (review changes) | New Task tool spawn | SendMessage (code_review_changes to Dev) |\n| Cross department: Lead->Lead | File-based artifacts (api-contracts.jsonl, design-handoff.jsonl) | File-based artifacts (UNCHANGED -- different teams) |\n| Lead->Owner | File-based (.dept-status-{dept}.json) | File-based (UNCHANGED -- Owner is not in any department team) |\n| Owner->User | go.md proxy (AskUserQuestion) | go.md proxy (UNCHANGED) |\n```\n\n### Change 2: Key insight paragraph update\nLocate the paragraph at line ~83 starting with '**Key insight:**'. Replace the ENTIRE paragraph with:\n\n```\n**Key insight:** Cross-team communication is ALWAYS file-based regardless of team_mode. The Teammate API SendMessage only works within a single team. Since each department is its own team (yolo-backend, yolo-frontend, yolo-uiux), inter-department coordination cannot use SendMessage. Within each team, all 19 Phase 2 agents (tester x3, qa x3, qa-code x3, security x1, plus the 4 Phase 1 agents and 8 FE/UX core agents from plan 02-05) use SendMessage for intra-team coordination when team_mode=teammate. This is by design -- it enforces the same strict context isolation that file-based gates provide.\n```\n\n### Change 3: Gate 3 (Integration QA) - add teammate mode note\nLocate Gate 3 section (line ~137, '### Gate 3: Integration QA'). After the '**Timeout:**' paragraph (line ~155) and before '### Gate 4: Owner Sign-off', ADD a new paragraph:\n\n```\n**Teammate mode:** When `team_mode=teammate`, each department Lead signals completion by writing .dept-status-{dept}.json (same as task mode) AND by sending department_result via SendMessage to go.md. The integration gate check via dept-gate.sh is identical in both modes. Within each department, agents used SendMessage for coordination (Tester->Senior, QA->Lead, QA-Code->Lead, Security->Lead for backend), but the cross-department gate remains file-based. dept-gate.sh does not need modification for teammate mode.\n```\n\n### Change 4: Gate 4 (Owner Sign-off) - add teammate mode note\nLocate Gate 4 section (line ~159, '### Gate 4: Owner Sign-off'). After the '**Decision:**' line (line ~169, 'SHIP (all departments approved) or HOLD (remediation needed).'), ADD a new paragraph:\n\n```\n**Teammate mode:** When `team_mode=teammate`, Owner receives department_result reports via file-based .dept-status-{dept}.json (same as task mode). Owner is not a member of any department team, so SendMessage cannot be used for Owner communication. The sign-off process, decision matrix, and owner_signoff schema are identical regardless of team_mode. The only difference is that within each department, the 10-step workflow used SendMessage for specialist coordination instead of Task tool spawning.\n```\n\n## File 2: references/handoff-schemas.md (C3 resolution)\n\n### Change: Fix test_plan_result header\nLocate line 25 containing:\n```\n## `test_plan_result` (Tester -> Lead)\n```\n\nReplace with:\n```\n## `test_plan_result` (Tester -> Senior)\n```\n\nThis is a one-line change. The schema body is correct (no references to Lead as recipient). Only the section header parenthetical is wrong.\n\nVerification after edits:\n- cross-team-protocol.md transport table has 11 rows (was 4)\n- Grep for 'Tester->Senior' or 'Tester.*Senior' in transport table returns 1 match\n- Grep for 'QA->Lead' or 'QA.*Lead' in transport table returns 1 match (qa_result)\n- Grep for 'QA-Code->Lead' or 'QA-Code.*Lead' in transport table returns 1 match (qa_code_result)\n- Grep for 'Security->Lead' or 'Security.*Lead' in transport table returns 1 match (security_audit, backend only)\n- Gate 3 has a 'Teammate mode:' paragraph mentioning file-based gates\n- Gate 4 has a 'Teammate mode:' paragraph mentioning Owner not in any team\n- handoff-schemas.md line 25 reads 'Tester -> Senior' (not 'Tester -> Lead')\n- Grep for 'Tester -> Lead' returns 0 matches across entire repo (was 1 in handoff-schemas.md)","ts":""}
